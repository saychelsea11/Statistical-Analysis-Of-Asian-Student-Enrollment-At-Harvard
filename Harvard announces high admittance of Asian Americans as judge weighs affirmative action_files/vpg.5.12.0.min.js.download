!function(e){var t={};function i(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(o,r,function(t){return e[t]}.bind(null,r));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=21)}([function(e,t,i){"use strict";i.d(t,"a",function(){return r});var o=i(1),r=new(function(){function e(){this._publickey="",this._ongalleryload="",this._debug=!1,this._nomobile=!1,this._notablet=!1,this._aggressivelazy=!1,this._nocache=!1,this._idattribute="",this._scandivwbgattr="",this._bgimageselector="div, button",this._ignorepicture=!1,this._imgignore=null,this._directurl=!1,this._divignore=!1,this._divignorelevels="",this._ignoreparentelement="",this._ignorehref=!1,this._optimizely=!1,this._optimizelyoff=!1,this._passivetracking=!1,this._summaryplaytimeout=500,this._redirect=!1,this._redirecttext="Video Will Begin In...",this._ctatext="See The Full Clip",this._redirectwithclick=!0,this._redirectwithclicktarget=!1,this._redirectwithvid=!1,this._redirectafter=null,this._redirectautoplay=!1,this._socialtext="",this._autoplay=!1,this._autoplayonce=!1,this._fadeinadvance=700,this._stopnoimage=!1,this._pauseonhover=!1,this._pausehoveronce=!1,this._noimage=!1,this._audio=!1,this._audioonce=!1,this._audiohover=!1,this._resizeonscroll=!1,this._proactiveload=!1,this._urlregexp="",this._disableall=!1,this._ignorecurrenturl=!1,this._audiopolicycta=!1,this._preloadoffset=300,this._disablestorage=!1,this._iemaxelements=20,this._reduceresolution=!1,this._mobilepreload=!0,this._maxpreloadedvideos=5,this._allautoplay=!1,this._followscroll=!1,this._pulltochange=!1,this._initmobilequeue=!1,this._customimgsrc="",this._smallgif=!1,this._ingnoreelementheight=!0,this._topviewportoffset=0,this._bottomviewportoffset=0,this._minscrolldistance=50,this._mobilecta=!1,this._mobilectaloopcount=1,this._previewdelay=0,this._forcesmallvideo=!1,this._taptoplay=!1,this._hidectaicon=!1,this._horizontalthreshold=80,this._analytics=!1,this._viziodevice=null,this._abtestingpercentage=0,this._noposterimage=null,this._downloadfrequency=null,this._scrollrenderdelay=0,this._verticalpreviews=!1,this._personalizedpreviews=!1}return Object.defineProperty(e.prototype,"horizontalthreshold",{get:function(){return parseInt(this._horizontalthreshold,10)},set:function(e){this._horizontalthreshold=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidectaicon",{get:function(){return this._hidectaicon},set:function(e){this._hidectaicon=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"taptoplay",{get:function(){return this._taptoplay},set:function(e){this._taptoplay=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"forcesmallvideo",{get:function(){return this._forcesmallvideo},set:function(e){this._forcesmallvideo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previewdelay",{get:function(){return this._previewdelay},set:function(e){"number"!=typeof e&&(e=parseFloat(e)),this._previewdelay=isNaN(e)?0:e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mobilectaloopcount",{get:function(){return parseInt(this._mobilectaloopcount,10)},set:function(e){this._mobilectaloopcount=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mobilecta",{get:function(){return this._mobilecta},set:function(e){this._mobilecta=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minscrolldistance",{get:function(){return parseInt(this._minscrolldistance,10)},set:function(e){this._minscrolldistance=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomviewportoffset",{get:function(){return parseInt(this._bottomviewportoffset,10)},set:function(e){this._bottomviewportoffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topviewportoffset",{get:function(){return parseInt(this._topviewportoffset,10)},set:function(e){this._topviewportoffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ingnoreelementheight",{get:function(){return this._ingnoreelementheight},set:function(e){this._ingnoreelementheight=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smallgif",{get:function(){return this._smallgif},set:function(e){this._smallgif=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"customimgsrc",{get:function(){return this._customimgsrc},set:function(e){this._customimgsrc=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initmobilequeue",{get:function(){return this._initmobilequeue},set:function(e){this._initmobilequeue=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pulltochange",{get:function(){return this._pulltochange},set:function(e){this._pulltochange=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"followscroll",{get:function(){return this._followscroll},set:function(e){this._followscroll=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allautoplay",{get:function(){return this._allautoplay},set:function(e){this._allautoplay=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxpreloadedvideos",{get:function(){return parseInt(this._maxpreloadedvideos,10)},set:function(e){this._maxpreloadedvideos=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mobilepreload",{get:function(){return this._mobilepreload},set:function(e){this._mobilepreload=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reduceresolution",{get:function(){return this._reduceresolution},set:function(e){this._reduceresolution=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"iemaxelements",{get:function(){return o.a.isMsie?this._iemaxelements:1/0},set:function(e){this._iemaxelements=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disablestorage",{get:function(){return this._disablestorage},set:function(e){this._disablestorage=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"preloadoffset",{get:function(){return this._preloadoffset},set:function(e){this._preloadoffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audiopolicycta",{get:function(){return this._audiopolicycta},set:function(e){this._audiopolicycta=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignorecurrenturl",{get:function(){return this._ignorecurrenturl},set:function(e){this._ignorecurrenturl=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disableall",{get:function(){return this._disableall},set:function(e){this._disableall=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"urlregexp",{get:function(){return this._urlregexp},set:function(e){this._urlregexp=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"proactiveload",{get:function(){return this._proactiveload},set:function(e){this._proactiveload=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resizeonscroll",{get:function(){return this._resizeonscroll},set:function(e){this._resizeonscroll=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audiohover",{get:function(){return this._audiohover},set:function(e){this._audiohover=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioonce",{get:function(){return this._audioonce},set:function(e){this._audioonce=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audio",{get:function(){return this._audio},set:function(e){this._audio=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"noimage",{get:function(){return this._noimage},set:function(e){this._noimage=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pausehoveronce",{get:function(){return this._pausehoveronce},set:function(e){this._pausehoveronce=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pauseonhover",{get:function(){return this._pauseonhover},set:function(e){this._pauseonhover=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stopnoimage",{get:function(){return this._stopnoimage},set:function(e){this._stopnoimage=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fadeinadvance",{get:function(){return parseInt(this._fadeinadvance,10)},set:function(e){this._fadeinadvance=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoplayonce",{get:function(){return this._autoplayonce},set:function(e){this._autoplayonce=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoplay",{get:function(){return this._autoplay},set:function(e){this._autoplay=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"socialtext",{get:function(){return this._socialtext},set:function(e){this._socialtext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redirectautoplay",{get:function(){return this._redirectautoplay},set:function(e){this._redirectautoplay=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redirectafter",{get:function(){return parseInt(this._redirectafter,10)},set:function(e){this._redirectafter=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redirectwithvid",{get:function(){return this._redirectwithvid},set:function(e){this._redirectwithvid=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redirectwithclicktarget",{get:function(){return this._redirectwithclicktarget},set:function(e){this._redirectwithclicktarget=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redirectwithclick",{get:function(){return this._redirectwithclick},set:function(e){this._redirectwithclick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ctatext",{get:function(){return this._ctatext},set:function(e){this._ctatext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redirecttext",{get:function(){return this._redirecttext},set:function(e){this._redirecttext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redirect",{get:function(){return this._redirect},set:function(e){this._redirect=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"summaryplaytimeout",{get:function(){return parseInt(this._summaryplaytimeout,10)},set:function(e){this._summaryplaytimeout=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"passivetracking",{get:function(){return this._passivetracking},set:function(e){this._passivetracking=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"optimizelyoff",{get:function(){return this._optimizelyoff},set:function(e){this._optimizelyoff=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"optimizely",{get:function(){return this._optimizely},set:function(e){this._optimizely=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignorehref",{get:function(){return this._ignorehref},set:function(e){this._ignorehref=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignoreparentelement",{get:function(){return this._ignoreparentelement},set:function(e){this._ignoreparentelement=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"divignorelevels",{get:function(){return this._divignorelevels},set:function(e){this._divignorelevels=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"divignore",{get:function(){return this._divignore},set:function(e){this._divignore=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"directurl",{get:function(){return this._directurl},set:function(e){this._directurl=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imgignore",{get:function(){return this._imgignore},set:function(e){this._imgignore=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignorepicture",{get:function(){return this._ignorepicture},set:function(e){this._ignorepicture=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bgimageselector",{get:function(){return this._bgimageselector},set:function(e){this._bgimageselector=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scandivwbgattr",{get:function(){return this._scandivwbgattr},set:function(e){this._scandivwbgattr=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idattribute",{get:function(){return this._idattribute},set:function(e){this._idattribute=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nocache",{get:function(){return this._nocache},set:function(e){this._nocache=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aggressivelazy",{get:function(){return this._aggressivelazy},set:function(e){this._aggressivelazy=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"notablet",{get:function(){return this._notablet},set:function(e){this._notablet=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nomobile",{get:function(){return this._nomobile},set:function(e){this._nomobile=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ongalleryload",{get:function(){return this._ongalleryload},set:function(e){this._ongalleryload=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"publickey",{get:function(){return this._publickey},set:function(e){this._publickey=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollListenerAdded",{get:function(){return this._scrollListenerAdded},set:function(e){this._scrollListenerAdded=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"analytics",{get:function(){return this._analytics},set:function(e){this._analytics=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viziodevice",{get:function(){return this._viziodevice},set:function(e){this._viziodevice=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"abtestingpercentage",{get:function(){return parseInt(this._abtestingpercentage,10)},set:function(e){this._abtestingpercentage=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"noposterimage",{get:function(){return!o.a.isIe&&this._noposterimage},set:function(e){this._noposterimage=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"downloadfrequency",{get:function(){return(null===this._downloadfrequency||this._downloadfrequency<0)&&(o.a.isChrome||o.a.isSafari?this._downloadfrequency=50:o.a.isMsie?this._downloadfrequency=100:this._downloadfrequency=0),this._downloadfrequency},set:function(e){"number"!=typeof e&&(e=parseInt(e,10)),this._downloadfrequency=isNaN(e)?null:e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollrenderdelay",{get:function(){return this._scrollrenderdelay},set:function(e){this._scrollrenderdelay=e>=100?e:100},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verticalpreviews",{get:function(){return this._verticalpreviews},set:function(e){this._verticalpreviews=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"personalizedpreviews",{get:function(){return this._personalizedpreviews},set:function(e){this._personalizedpreviews=e},enumerable:!0,configurable:!0}),e}())},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var o=new(function(){function e(){this.ua=navigator.userAgent.toLowerCase(),this.isMozilla=this.dr("firefox"),this.isWebkit=this.dr("webkit"),this.isOpera=this.dr("opera"),this.isMsie=this.dr("msie|trident|edge"),this.isIe=this.dr("trident"),this.isEdge=this.dr("edge"),this.isIe10=this.dr("msie"),this.isChrome=this._checkIsChrome(),this.isAndroid=this.dr("android"),this.isIos=this.dr("iphone|ipad|ipod"),this.isIpad=this.dr("ipad"),this.isAndroidTablet=this.isAndroid&&this.dr("^mobile"),this.isTablet=this.isIpad||this.isAndroidTablet,this.isIphone=this.dr("iphone"),this.isOperaMini=this.dr("opera mini"),this.isWindowsMobile=this.dr("iemobile"),this.isKindle=this.dr("kindle|silk|kftt|kfot|kfjwa|kfjwi"),this.isMobile=this.isAndroid||this.isIos||this.isIphone||this.isOperaMini||this.isWindowsMobile||this.isKindle,this.isOldIphone=this.isIphone&&window.screen.height/window.screen.width==1.5&&window.devicePixelRatio<=2,this.isSafari=this._checkIsSafari(),this.isVizio=window.VIZIO&&window.VIZIO.isSmartCastDevice}return e.prototype.dr=function(e){return new RegExp(e).test(this.ua)},e.prototype._checkIsSafari=function(){var e;return!!this.dr("^((?!chrome).)*safari")&&(e=this.ua.search("version/"),parseInt(this.ua.substr(e+8,3),10))},e.prototype._checkIsChrome=function(){var e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return!!e&&parseInt(e[2],10)},e}())},function(e,t,i){"use strict";var o=i(9),r=i(12),n=function(){return function(e){switch(void 0===e&&(e="[_VLX_] "),this._prefix="[_VLX_] ",this._prefix=e,this.info=this.debug=this.warn=this.error=function(){},this.critical=Function.prototype.bind.call(console.error,console,"!!CRITICAL ERROR!!",this._prefix),o.a.logLevel){case r.a.info:this.info=Function.prototype.bind.call(console.info,console,this._prefix);break;case r.a.develop:this.info=Function.prototype.bind.call(console.info,console,this._prefix),this.debug=Function.prototype.bind.call(console.info,console,this._prefix),this.warn=Function.prototype.bind.call(console.warn,console,this._prefix),this.error=Function.prototype.bind.call(console.error,console,this._prefix)}}}();t.a=n},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var o=new(function(){function e(){this._isRedirecting=!1,this._galleryVersion="5.12.0",this._iframeUrl="https://static.vilynx.com/gallery/vtrk.html",this._serverUrl="www.vilynx.com",this._bgImageRegex=/^url\("?.*$/}return Object.defineProperty(e.prototype,"bgImageRegex",{get:function(){return this._bgImageRegex},set:function(e){this._bgImageRegex=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serverUrl",{get:function(){return this._serverUrl},set:function(e){this._serverUrl=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"iframeUrl",{get:function(){return this._iframeUrl},set:function(e){this._iframeUrl=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"galleryVersion",{get:function(){return this._galleryVersion},set:function(e){this._galleryVersion=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scriptTag",{get:function(){return this._scriptTag},set:function(e){this._scriptTag=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRedirecting",{get:function(){return this._isRedirecting},set:function(e){this._isRedirecting=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"retryTime",{get:function(){return this._retryTime},set:function(e){this._retryTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollDirection",{get:function(){return this._scrollDirection},set:function(e){this._scrollDirection=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"savedEventsSended",{get:function(){return this._savedEventsSended},set:function(e){this._savedEventsSended=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loaded",{get:function(){return this._loaded},set:function(e){this._loaded=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vilynxUID",{get:function(){return this._vilynxUID},set:function(e){this._vilynxUID=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tapToPlay",{get:function(){return this._tapToPlay},set:function(e){this._tapToPlay=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxRetries",{get:function(){return this._maxRetries},set:function(e){this._maxRetries=e},enumerable:!0,configurable:!0}),e}())},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var o=i(9),r=new(function(){function e(){this._device="desktop",this._godMode=!1,this._groupByActionIdThreshold=1e3,this._groupSameEventsThreshold=300,this._onLoad="(function(){})()",this._passiveTracking=!1,this._publickey="",this._sendDebounce=5e3,this._sendDelay=1e3,this._spaNavigation=!0,this._spaNavigationInterval=5e3}return Object.defineProperty(e.prototype,"publickey",{get:function(){return this._publickey},set:function(e){this._publickey=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"device",{get:function(){return this._device},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onLoad",{get:function(){return this._onLoad},set:function(e){this._onLoad=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"godMode",{get:function(){return this._godMode},set:function(e){this._godMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sendDelay",{get:function(){return Math.max(parseInt(this._sendDelay,10),50)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sendDebounce",{get:function(){return this._sendDebounce},set:function(e){this._sendDebounce=e},enumerable:!0,configurable:!0}),e.prototype.setValue=function(e,t){return void 0!==this["_"+e]?("true"===t.toLowerCase()?t=!0:"false"===t.toLowerCase()&&(t=!1),this["_"+e]=t,!0):0===e.indexOf("core")&&(e=(e=e.replace("core","")).charAt(0).toLowerCase()+e.slice(1),o.a.setValue(e,t))},Object.defineProperty(e.prototype,"passiveTracking",{get:function(){return this._passiveTracking},set:function(e){this._passiveTracking=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupSameEventsThreshold",{get:function(){return this._groupSameEventsThreshold},set:function(e){this._groupSameEventsThreshold=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupByActionIdThreshold",{get:function(){return this._groupByActionIdThreshold},set:function(e){this._groupByActionIdThreshold=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spaNavigation",{get:function(){return this._spaNavigation},set:function(e){this._spaNavigation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spaNavigationInterval",{get:function(){return this._spaNavigationInterval},set:function(e){this._spaNavigationInterval=e},enumerable:!0,configurable:!0}),e}())},function(e,t,i){"use strict";var o,r;i.d(t,"a",function(){return o}),function(e){e.base64="base64",e.json="json",e.plain="plain"}(o||(o={})),function(e){e[e.sessionStorage=0]="sessionStorage",e[e.localStorage=1]="localStorage"}(r||(r={}))},function(e,t,i){"use strict";var o=i(0),r=i(2),n=i(3),a=function(){return function(){}}();i.d(t,"a",function(){return s});var s=new(function(){function e(){this._logger=new r.a("[vlx_dbg]"),this._logger.info("Viewport Queue initialized"),this._windowChange=!1,this._queue=[],this._loadedQueue=[],this._playingVideo=null,this._isPlaying=-1,this._lastToken=null,this._lastTokenTop=0,this._passTokenNow=!0,this._timeOuts=[]}return e.prototype.clearQueues=function(){var e=this;this._timeOuts.forEach(function(e){clearTimeout(e)}),this._timeOuts=[],clearTimeout(this._passTokenTimer),this._passTokenTimer=null,this._logger.info("Empty both loaded and viewport queues"),this._windowChange=!0,this._loadedQueue.forEach(function(t){e.removeFromLoadedQueue(t)}),this._queue.forEach(function(t){e.removeFromViewportQueue(t.gallery),t.gallery=null}),this._queue=[],this._loadedQueue=[],this._playingVideo=null,this._isPlaying=-1,this._lastToken=null,this._lastTokenTop=0,this._passTokenNow=!0},e.prototype.addToViewportQueue=function(e,t){var i=this;if(-1===this.findElement(e,this._queue)){var o=new a,r=this.getTokenized(),n=!0;o.gallery=e,o.priority=e.config.playpriority,o.token=!1,o.hadToken=!1,this._queue.push(o),r&&e.watcher.isThresholdInViewport&&(r.gallery.watcher.isThresholdInViewport&&r.priority>=o.priority?n=!1:(this.passToken(),r.gallery.stopOrCleanVideoNode())),n&&e.config.autoplay?t?this._timeOuts.push(window.setTimeout(function(){i.playNextInQueue(!0,null,!1)},280)):this.playNextInQueue(!0,null,!1):this._logger.info("Elem "+e.logger.debugId+" is waiting to play")}},e.prototype.removeFromViewportQueue=function(e){var t=this.findElement(e,this._queue);if(-1!==t){if(-1!==t){var i=this._queue.splice(t,1)[0];i.gallery.logMessage("Removing from viewport queue..."),i.gallery.stopOrCleanVideoNode()}this.playNextInQueue(e.watcher.isAboveViewport,e.watcher.isBelowViewport,!1)}},e.prototype.addToLoadedQueue=function(e,t){var i=this,r=-1;e.scrollPosition=e.galleryData.domObject.getBoundingClientRect().top,this._timeOuts.push(window.setTimeout(function(){if(Math.abs(e.scrollPosition-e.galleryData.domObject.getBoundingClientRect().top)<=200){if(e.logMessage("adding video to the load queue!"),-1!==i._loadedQueue.indexOf(e))return void e.logMessage("Elem already in loaded queue, exit");if(i._loadedQueue.length<o.a.maxpreloadedvideos)e.logMessage("Loaded queue isn't filled!"),i._loadedQueue.push(e),e.initOrReattachGallery(!0);else{var n=e.watcher.isInViewport;i._loadedQueue.forEach(function(e,t){!e.watcher.isCanUnload&&e.videoNode||-1!==r||(r=t)}),-1===r&&n&&(i._loadedQueue.forEach(function(t,i){t.watcher.isInViewport||-1!==r||(e.logMessage("Video with preference removes another which is not in the viewport!"),r=i)}),(t||e.watcher.isFullyInViewport)&&-1===r&&i._loadedQueue.forEach(function(i,o){i.watcher.isThresholdInViewport&&!t||-1!==r||(e.logMessage("Video with preference removes another which is not in the viewport!"),e.logMessage("Video in "),i.logMessage("Video out"),r=o)})),-1!==r&&(i._loadedQueue[r].videoNode&&i._loadedQueue[r].cleanVideoNode(!1),i._loadedQueue[r]=e,e.videoNode||e.initOrReattachGallery(i._playingVideo===e))}}},100))},e.prototype.removeFromLoadedQueue=function(e){var t=-1;this._loadedQueue.forEach(function(i,o){i.logMessage("Im in the load queue"),i===e&&(e.logMessage("Remove from the load queue"),t=o,e.cleanVideoNode(!1))}),-1!==t?this._loadedQueue.splice(t,1):e.videoNode&&(this._logger.warn("Elem "+e.logger.debugId+" not found in loaded queue, not possible to remove it.\n             Removing video node!"),e.cleanVideoNode(!1))},e.prototype.passToken=function(){var e=this;this._queue.forEach(function(t){!0===t.token&&(t.token=!1,t.hadToken=!0,e._lastTokenTop=t.gallery.watcher.top,e._lastToken=t.gallery,e._logger.info("Token is free"))})},e.prototype.forceToken=function(e){if(this.elementHasToken(e))return!0;var t,i=!1;return this._queue.forEach(function(o){i||o.gallery!==e?!0===o.token&&(t=o):(i=!0,o.token=!0)}),i?(t&&(t.gallery.stopOrCleanVideoNode(),t.token=!1,t.hadToken=!0,this._lastTokenTop=t.gallery.watcher.top,this._lastToken=t.gallery,t.gallery.logMessage("Element forced to stop, and token deleted")),e.videoNode?e.videoNode.paused&&this.playVideo(e):(e.initOrReattachGallery(!0),o.a.mobilepreload&&!o.a.passivetracking&&this.addToLoadedQueue(e,!0))):(e.watcher.isFullyInViewport||e.watcher.isThresholdInViewport)&&(e.logMessage("Element in Viewport not in queue. Adding..."),this.addToViewportQueue(e)),i},e.prototype.elementHasToken=function(e){return this._queue.some(function(t){return t.gallery===e&&t.token})},e.prototype.resetHadToken=function(){this._queue.forEach(function(e){e.hadToken=!1})},e.prototype.isTokenFree=function(){var e=!0;return this._queue.forEach(function(t){!0===t.token&&(t.gallery.logMessage("Playing token is taken"),e=!1)}),e},e.prototype.getTokenized=function(){var e=null;return this._queue.forEach(function(t){!0===t.token&&(t.gallery.logMessage("Playing token is taken"),e=t)}),e},e.prototype.updatePriority=function(e,t){var i=this.findElement(e,this._queue),o=this.getTokenized();if(-1!==i){var r=this._queue[i];r.priority=t,r.gallery.watcher.isThresholdInViewport&&(!o||o.gallery===e||o.priority<t)&&this.playNextInQueue(!0,null,!1)}},e.prototype.playNextInQueue=function(e,t,i){var r,n,a,s,l=this,c=this.getAllAutoplay(this._queue),d=this.getTopPriority(c),u=this.getTokenized(),h=0;if(d.length){if(u){if(u.priority>=d[0].priority)return;u.gallery.logMessage("New element added in the queue with more priority than me. I give up"),this.passToken(),u.gallery.stopOrCleanVideoNode()}if(s=a=this.getAllFullInViewport(d),a.length||(s=d),n=d[0].gallery.watcher.top,i){this._logger.info("Playing next one due to scroll");var p=1e5,g=-1e5;e?s.forEach(function(e,t){e.gallery.watcher.top>l._lastTokenTop&&e.gallery.watcher.top<p&&!1===e.hadToken&&(p=e.gallery.watcher.top,h=t)}):t&&(this._logger.info("Scrolling to top"),s.forEach(function(e,t){e.gallery.watcher.top<l._lastTokenTop&&e.gallery.watcher.top>g&&!1===e.hadToken&&(g=e.gallery.watcher.top,h=t)}))}else e?s.forEach(function(e,t){e.gallery.watcher.top<n&&(h=t)}):t&&(this._logger.info("Scrolling to top"),s.forEach(function(e,t){e.gallery.watcher.top>n&&(h=t)}));s[h].token=!0,r=s[h],this._logger.info("Elem "+r.gallery.logger.debugId+" have the token now"),r.gallery.watcher.isFullyInViewport||r.gallery.watcher.isThresholdInViewport?(o.a.followscroll&&this.setPassTokenTimer(),o.a.mobilepreload&&!o.a.passivetracking?(r.gallery.logMessage("playing video!"),this.playVideo(r.gallery)):r.gallery.initOrReattachGallery(!0)):(this._logger.info("Element in queue but not visible any more"),o.a.mobilepreload&&!o.a.passivetracking?this.removeFromViewportQueue(r.gallery):s.splice(h,1),this.playNextInQueue(e,t,!1))}},e.prototype.getAllFullInViewport=function(e){var t=[];return e.forEach(function(e){e.gallery.watcher.isFullyInViewport&&t.push(e)}),t},e.prototype.getAllAutoplay=function(e){var t=[];return e.forEach(function(e){e.gallery.config.autoplay&&t.push(e)}),t},e.prototype.getTopPriority=function(e){var t=[],i=-1/0;return e.forEach(function(e){e.priority>i&&(t=[],i=e.priority),e.priority===i&&t.push(e)}),t},e.prototype.findElement=function(e,t){for(var i=0;i<t.length;++i)if(t[i].gallery===e)return e.logMessage("Element already in the queue. Abort"),i;return-1},e.prototype.playVideo=function(e){var t=this;e.videoNode?e.showVideoNode():(e.logMessage("no videoNode, readding"),this._timeOuts.push(window.setTimeout(function(){e.videoNode?(e.logMessage("video found 150ms later"),e.showVideoNode()):(t._playingVideo=e,t.addToLoadedQueue(e,!0))},150)))},e.prototype.playNextWithToken=function(e){this.playNextInQueue(e,!e,!0),this.resetHadToken()},e.prototype.setPassTokenTimer=function(){var e=this;this._passTokenNow=!1,clearTimeout(this._passTokenTimer),this._passTokenTimer=window.setTimeout(function(){e._passTokenNow=!0,e._logger.info("passTokenTimer free"),e.isTokenFree()&&e._queue.length>0&&e.playNextWithToken(n.a.scrollDirection)},1e3)},e.prototype.followScrollListener=function(){var e,t,i,r=this,a=pageYOffset||document.documentElement.scrollTop;this._logger.info("Follow scroll listener init"),window.addEventListener("scroll",function(){clearTimeout(e),e=window.setTimeout(function(){if(window.innerHeight+window.scrollY>=document.body.offsetHeight&&o.a.pulltochange)r._logger.info("Scrolling beyond bottom: change video"),r._queue.length>1&&r.anyVideoOnBottom()&&(r.passToken(),r._lastToken.cleanVideoNode(!0)),a=t;else if(o.a.followscroll){if(t=pageYOffset||document.documentElement.scrollTop,i=Math.abs(t-a),t>a?(r._logger.info("Scrolling to bottom with distance: "+i),n.a.scrollDirection=!0):(r._logger.info("Scrolling to top with distance: "+i),n.a.scrollDirection=!1),a=t,i<o.a.minscrolldistance)return void r._logger.info("Scroll distance to short");if(!1===r._passTokenNow)return void r._logger.info("Token was recently passed");r._queue.length>1?(r.passToken(),r._lastToken.cleanVideoNode(!0)):r._logger.info("No other elements on queue")}},200),r._timeOuts.push(e)})},e.prototype.anyVideoOnBottom=function(){var e=this,t=0,i=!1;return this._queue.forEach(function(e){!0===e.token&&(t=e.gallery.watcher.top)}),this._queue.forEach(function(o){o.gallery.watcher.top>t&&(i=!0,e._logger.info("More video/s on bottom to play"))}),i},e}())},function(e,t,i){"use strict";i.d(t,"a",function(){return s});var o=i(2),r=i(6),n=i(15),a=i(17),s=new(function(){function e(){this._logger=new o.a("[vlx_dbg]"),this.onPlay=[],this.onPreviewStop=[],this.onTrackSummaryPlay=[],this.onTrackVideoPlay=[],this.onTrackThumbnailShown=[],this.onPreviewEnd=[],this.onPreviewRedirect=[],this.onPreviewClick=[],this.onPreviewLoop=[],this.hooks=[],this.galleryItems=[],this.checkAudioPolicy=n.a.doTestSound.bind(n.a)}return e.prototype.reObserve=function(){this.observer=new a.a},e.prototype.addOnPlay=function(e){return this._logger.debug("Pushed new function to OnPlay"),this.onPlay.push(e),this.onPlay},e.prototype.getOnPlay=function(){return this.onPlay},e.prototype.addOnPreviewStop=function(e){return this._logger.debug("Pushed new function to OnStop"),this.onPreviewStop.push(e),this.onPreviewStop},e.prototype.getOnPreviewStop=function(){return this.onPreviewStop},e.prototype.addOnStop=function(e){return this.addOnPreviewStop(e)},e.prototype.getOnStop=function(){return this.getOnPreviewStop()},e.prototype.addOnTrackSummaryPlay=function(e){return this._logger.debug("Pushed new function to onTrackSummaryPlay"),this.onTrackSummaryPlay.push(e),this.onTrackSummaryPlay},e.prototype.getOnTrackSummaryPlay=function(){return this.onTrackSummaryPlay},e.prototype.addOnTrackVideoPlay=function(e){return this._logger.debug("Pushed new function to OnTrackVideoPlay"),this.onTrackVideoPlay.push(e),this.onTrackVideoPlay},e.prototype.getOnTrackVideoPlay=function(){return this.onTrackVideoPlay},e.prototype.addOnTrackThumbnailShown=function(e){return this._logger.debug("Pushed new function to onTrackThumbnailShown"),this.onTrackThumbnailShown.push(e),this.onTrackThumbnailShown},e.prototype.getOnTrackThumbnailShown=function(){return this.onTrackThumbnailShown},e.prototype.addOnPreviewEnd=function(e){return this._logger.debug("Pushed new function to onPreviewEnd"),this.onPreviewEnd.push(e),this.onTrackThumbnailShown},e.prototype.getOnPreviewEnd=function(){return this.onPreviewEnd},e.prototype.addOnPreviewRedirect=function(e){return this._logger.debug("Pushed new function to onPreviewRedirect"),this.onPreviewRedirect.push(e),this.onPreviewRedirect},e.prototype.getOnPreviewRedirect=function(){return this.onPreviewRedirect},e.prototype.addOnPreviewClick=function(e){return this._logger.debug("Pushed new function to onPreviewRedirect"),this.onPreviewClick.push(e),this.onPreviewClick},e.prototype.getOnPreviewClick=function(){return this.onPreviewClick},e.prototype.addOnPreviewLoop=function(e){return this._logger.debug("Pushed new function to onPreviewRedirect"),this.onPreviewLoop.push(e),this.onPreviewLoop},e.prototype.getOnPreviewLoop=function(){return this.onPreviewLoop},e.prototype.cleanQueues=function(){return this._logger.debug("Forced a play/preload queue clean."),r.a.clearQueues(),!0},e.prototype.addOnLoadGalleryItem=function(e){return this._logger.debug("Pushed new function to onLoadGalleryItem"),this.hooks.push(e),this.hooks},e.prototype.getOnLoadGalleryItem=function(){return this.hooks},e}())},function(e,t,i){"use strict";var o,r;i.d(t,"a",function(){return o}),i.d(t,"b",function(){return r}),function(e){e.summaryShow="summaryShow",e.summaryStart="summaryStart",e.summaryEnd="summaryEnd",e.summaryLoop="summaryLoop",e.summaryClick="summaryClick"}(o||(o={})),function(e){e.pro69high="pro69high",e.pro69="pro69",e.galleryPro69="galleryPro69",e.pro="pro",e.galleryShort="galleryShort",e.pro23high="pro23high",e.pro23="pro23",e.galleryPro23="galleryPro23"}(r||(r={}))},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var o=i(12),r=new(function(){function e(){this._logLevel=o.a.nope,this._xhrMaxRetry=5,this._xhrRetryTime=1e3,this._xhrTimeout=1e3}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xhrMaxRetry",{get:function(){return this._xhrMaxRetry},set:function(e){this._xhrMaxRetry=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xhrTimeout",{get:function(){return this._xhrTimeout},set:function(e){this._xhrTimeout=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xhrRetryTime",{get:function(){return this._xhrRetryTime},set:function(e){this._xhrRetryTime=e},enumerable:!0,configurable:!0}),e.prototype.setValue=function(e,t){return void 0!==this["_"+e]&&("true"===t.toLowerCase()?t=!0:"false"===t.toLowerCase()&&(t=!1),this["_"+e]=t,!0)},e}())},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var o=i(5),r=i(2),n=i(13),a=new(function(){function e(){this._isLocalStorageAvailable=!0,this._logger=new r.a("[LS]");try{var e="__storage_test__";localStorage.setItem(e,e),localStorage.removeItem(e)}catch(e){this._isLocalStorageAvailable=!1,this._logger.warn("localStorage is not available")}}return e.prototype.get=function(e,t){if(!this._isLocalStorageAvailable)return this._logger.warn("localStorage is not available"),!1;this._logger.info("Getting "+e+" from local storage");var i=localStorage.getItem(e);if(i)switch(t){case o.a.base64:try{i=atob(i)||!1}catch(e){i=!1}break;case o.a.json:try{i=JSON.parse(i)||!1}catch(e){i=!1}break;case o.a.plain:}return i},e.prototype.set=function(e,t,i){if(this._isLocalStorageAvailable){var r;switch(this._logger.info("Saving "+e+" to local storage"),i){case o.a.base64:try{r=btoa(t.toString())}catch(o){throw this._logger.error("Failed to convert to BASE64 (name, element, format)",e,t,i),new n.a("Can't convert from "+typeof t+" to base64")}break;case o.a.json:try{r=JSON.stringify(t)}catch(o){throw this._logger.error("Failed to convert to JSON (name, element, format)",e,t,i),new n.a("Can't convert from "+typeof t+" to base64")}break;case o.a.plain:r=t.toString()}try{localStorage.setItem(e,r)}catch(e){throw this._logger.error("Can't save to local storage. Maybe it's full",e),new n.b("Can't save to local storage. Maybe it's full")}return e}this._logger.warn("localStorage is not available")},e.prototype.remove=function(e){this._isLocalStorageAvailable?(this._logger.info("Removing "+e+" from local storage"),localStorage.removeItem(e)):this._logger.warn("localStorage is not available")},e}())},function(e,t,i){"use strict";function o(e){void 0===e&&(e=4);for(var t=Math.pow(16,Math.min(e,8)-1),i=Math.pow(16,Math.min(e,8))-1,r=(Math.floor(Math.random()*(i-t+1))+t).toString(16);r.length<e;)r+=o(e-8);return r}function r(){var e=o;return e(8)+"-"+e()+"-"+e()+"-"+e()+"-"+e(12)}function n(e){if(e.dataset)return e.dataset;for(var t=e.attributes,i=t.length,o=function(e){return e.charAt(1).toUpperCase()},r={},n=0;n<i;n++){var a=t[n];if(a&&a.name&&/^data-\w[\w\-]*$/.test(a.name)){var s=a.value;r[a.name.substr(5).replace(/-./g,o)]=s}}return r}i.d(t,"a",function(){return o}),i.d(t,"b",function(){return r}),i.d(t,"c",function(){return n})},function(e,t,i){"use strict";var o;i.d(t,"a",function(){return o}),function(e){e.nope="nope",e.info="info",e.develop="develop"}(o||(o={}))},function(e,t,i){"use strict";i.d(t,"a",function(){return o}),i.d(t,"b",function(){return r});var o=function(){return function(e){this.message=e}}(),r=function(){return function(e){this.message=e}}()},function(e,t,i){"use strict";var o;i.d(t,"a",function(){return o}),function(e){e[e.outOfAB=0]="outOfAB",e[e.galleryActive=1]="galleryActive",e[e.galleryPassive=2]="galleryPassive"}(o||(o={}))},function(e,t,i){"use strict";i.d(t,"a",function(){return n});var o=i(1),r=i(2),n=new(function(){function e(){this._logger=new r.a("[vlx_dbg]"),this._audioPolicyActive=o.a.isWebkit||o.a.isMozilla,this._audioSrcBase64="SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU2LjM2LjEwMAAAAAAAAAAAAAAA//OEAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAEAAABIADAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV6urq6urq6urq6urq6urq6urq6urq6urq6v////////////////////////////////8AAAAATGF2YzU2LjQxAAAAAAAAAAAAAAAAJAAAAAAAAAAAASDs90hvAAAAAAAAAAAAAAAAAAAA//MUZAAAAAGkAAAAAAAAA0gAAAAATEFN//MUZAMAAAGkAAAAAAAAA0gAAAAARTMu//MUZAYAAAGkAAAAAAAAA0gAAAAAOTku//MUZAkAAAGkAAAAAAAAA0gAAAAANVVV"}return e.prototype.doTestSound=function(e,t){var i=this;if(this._audioPolicyActive){var o=document.createElement("audio");o.src="data:audio/mp3;base64,"+this._audioSrcBase64,o.play().then(function(){i._audioPolicyActive=!1,t()}).catch(function(){i._logger.warn("Audio policy is still active. Avoiding some redirect functions."),e()})}else t()},e}())},function(e,t,i){"use strict";var o=function(){function e(){}return e.prototype.chance=function(e){if(e>100||e<0)throw new Error("number must be between 0 and 100");return Math.random()<.01*e},e.prototype.randomInt=function(e,t){return Math.floor(Math.random()*(t+1)+e)},e.prototype.generateRandomHex=function(e){void 0===e&&(e=4);for(var t=Math.pow(16,Math.min(e,8)-1),i=Math.pow(16,Math.min(e,8))-1,o=(Math.floor(Math.random()*(i-t+1))+t).toString(16);o.length<e;)o+=this.generateRandomHex(e-8);return o},e.prototype.generateRandomUUID=function(){var e=this.generateRandomHex;return e(8)+"-"+e()+"-"+e()+"-"+e()+"-"+e(12)},e}();t.a=new o},function(e,t,i){"use strict";var o,r=i(0),n=i(7),a=i(9),s=i(2),l=(i(19),function(){function e(e,t){this._LOGGER=new s.a("[XHR]"),void 0!==e&&(a.a.xhrMaxRetry=e,this._LOGGER.debug("Maximum number of retry set to "+e)),void 0!==t&&(a.a.xhrTimeout=t,this._LOGGER.debug("Timeout set to "+t))}return e.prototype.get=function(e,t,i){return this._call("GET",e,t,null,i)},e.prototype.post=function(e,t,i,o){return this._call("POST",e,t,i,o)},e.prototype._call=function(t,i,o,r,n){var s=this;return new Promise(function(l,c){s._LOGGER.info("Making Xhr "+t+" to "+i);var d=new XMLHttpRequest,u=s._stringifyQueryObject(o)||"",h=0;d.open(t,i+"?"+u,!0),n=Object.assign({Accept:"application/json, text/javascript, */*","Content-type":"application/x-www-form-urlencoded"},n),Object.keys(n).forEach(function(e){d.setRequestHeader(e,n[e])}),d.onreadystatechange=function(){4===d.readyState&&(e._isOk(d.status)?(s._LOGGER.info("Xhr "+t+" to "+i+" successful with code "+d.status),l(d.response)):e._isTimeout(d.status)?(s._LOGGER.info("Xhr "+t+" to "+i+" timed out with code "+d.status),h<a.a.xhrMaxRetry?(h+=1,setTimeout(function(){d.open("${method}",i+"?"+u,!0),d.send(null)},a.a.xhrRetryTime*h)):(s._LOGGER.warn("Xhr "+t+" to "+i+" failed with code "+d.status),c(d.status))):(s._LOGGER.warn("Xhr "+t+" to "+i+" failed with code "+d.status),c(d.status)))},d.send(s._stringifyQueryObject(r))})},e._isOk=function(e){return e>0&&e<299},e._isTimeout=function(e){return 408===e||503===e||504===e},e.prototype._stringifyQueryObject=function(e){void 0===e&&(e={});var t=null;return e&&Object.keys(e).length&&(t=Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")),t},e}()),c=i(3),d=new(function(){function e(){this._logger=new s.a("[vlx_dbg]")}return e.prototype.validateQuery=function(e){try{return document.querySelector(e),!0}catch(t){this._logger.warn("Invalid selector query found! "+e)}return this._logger.warn("Invalid selector query found! "+e),!1},e.prototype.exctractIdAttribute=function(e){var t;return e.dataset&&e.dataset.vilynxId?t=e.dataset.vilynxId:e.attributes.getNamedItem("vilynx-id")?t=e.attributes.getNamedItem("vilynx-id").value:r.a.idattribute&&e.attributes.getNamedItem(r.a.idattribute)&&(t=e.attributes.getNamedItem(r.a.idattribute).value),t},e.prototype.findElementWithBg=function(e){var t,i=r.a.bgimageselector,o=!1;return(t=Array.prototype.slice.call(e.querySelectorAll(i))).push(e),t.length>0&&t.forEach(function(e){(""!==e.style.backgroundImage&&c.a.bgImageRegex.test(e.style.backgroundImage)||e.getAttribute(r.a.scandivwbgattr))&&(r.a.imgignore&&e.matches(r.a.imgignore)||(o=!0,e.classList.add("vilynx_img")))}),o},e.prototype.vectorAddition=function(e,t){if(e.length!==t.length)throw new RangeError;return e.map(function(e,i){return e+t[i]})},e.prototype.cosineSimilarity=function(e,t){if(e.length!==t.length)throw new RangeError;for(var i=0,o=0,r=0,n=0;n<e.length;++n)i+=e[n]*t[n],o+=Math.pow(e[n],2),r+=Math.pow(t[n],2);return i/(Math.sqrt(o)*Math.sqrt(r))},e}()),u=i(1),h=i(5),p=i(13),g=i(11),f=new(function(){function e(){this._isSessionStorageAvailable=!0,this._logger=new s.a("[SS]");try{var e="__storage_test__";Object(g.b)(),sessionStorage.setItem(e,e),sessionStorage.removeItem(e)}catch(e){this._isSessionStorageAvailable=!1,this._logger.warn("sessionStorage is not available")}}return e.prototype.get=function(e,t){if(!this._isSessionStorageAvailable)return this._logger.warn("sessionStorage is not available"),!1;this._logger.info("Getting "+e+" from session storage");var i=sessionStorage.getItem(e);if(i)switch(t){case h.a.base64:try{i=atob(i)||!1}catch(e){i=!1}break;case h.a.json:try{i=JSON.parse(i)||!1}catch(e){i=!1}break;case h.a.plain:}return i},e.prototype.set=function(e,t,i){if(this._isSessionStorageAvailable){var o;switch(this._logger.info("Saving "+e+" to session storage"),i){case h.a.base64:try{o=btoa(t.toString())}catch(o){throw this._logger.error("Failed to convert to BASE64 (name, element, format)",e,t,i),new p.a("Can't convert from "+typeof t+" to base64")}break;case h.a.json:try{o=JSON.stringify(t)}catch(o){throw this._logger.error("Failed to convert to JSON (name, element, format)",e,t,i),new p.a("Can't convert from "+typeof t+" to base64")}break;case h.a.plain:o=t.toString()}try{sessionStorage.setItem(e,o)}catch(e){throw this._logger.error("Can't save to session storage. Maybe it's full",e),new p.b("Can't save to session storage. Maybe it's full")}return e}this._logger.warn("sessionStorage is not available")},e.prototype.remove=function(e){this._isSessionStorageAvailable?(this._logger.info("Removing "+e+" from session storage"),sessionStorage.removeItem(e)):this._logger.warn("sessionStorage is not available")},e}()),y=i(8),v=i(18),m=function(){function e(){this._logger=new s.a("[gallery_Analytics]"),this._dagda=v.a.instance(),this.summaryPlayTimeOut=r.a.summaryplaytimeout,r.a.optimizely&&this.initOptimizely()}return e.prototype.trackLoop=function(e){r.a.analytics&&this._dagdaTrackSummaryLoop(e)},e.prototype.trackSummaryPlay=function(e){this._summaryPlays+=1,r.a.optimizely&&window.optimizely&&window.optimizely.push(["trackEvent","summary_play"]),n.a.getOnTrackSummaryPlay().forEach(function(t){t(e.galleryData.domObject)}),r.a.analytics&&this._dagdaTrackSummaryStart(e)},e.prototype.trackVideoPlay=function(e,t){void 0!==e&&r.a.analytics&&this._dagdaTrackSummaryClick(e,t),r.a.optimizely&&window.optimizely&&window.optimizely.push(["trackEvent","summary_click"]),n.a.getOnTrackVideoPlay().forEach(function(t){t(e.galleryData.domObject)})},e.prototype.trackThumbnailShown=function(e){r.a.optimizely&&window.optimizely&&window.optimizely.push(["trackEvent","thumbnail_shown"]),n.a.getOnTrackThumbnailShown().forEach(function(t){t(e.galleryData.domObject)})},e.prototype.trackSummaryEnd=function(e){r.a.analytics&&this._dagdaTrackSummaryEnd(e),n.a.getOnPreviewStop().forEach(function(t){t(e.galleryData.domObject)})},e.prototype.saveEvent=function(e,t,i){this._saved=f.get("vilynx_gallery_mpSavedEvents",h.a.json)||{},this._saved[e+t]={eventName:t,options:i},f.set("vilynx_gallery_mpSavedEvents",this._saved,h.a.json)},e.prototype.removeEvent=function(e){this._saved=f.get("vilynx_gallery_mpSavedEvents",h.a.json)||{},void 0!==this._saved[e]&&delete this._saved[e],f.set("vilynx_gallery_mpSavedEvents",this._saved,h.a.json)},e.prototype.sendSaved=function(){var e=f.get("vilynx_gallery_mpSavedEvents",h.a.json)||{};c.a.savedEventsSended=!0,Object.keys(e).forEach(function(t){window.mixpanel.vilynx.track(e[t]).eventName.replace("-"," "),e[t].options}),f.set("vilynx_gallery_mpSavedEvents",this._saved,h.a.json)},e.prototype.trackCb=function(e,t){this.removeEvent(e+t)},e.prototype.getCookie=function(e){var t=("; "+document.cookie).split("; "+e+"=");if(2===t.length)return t.pop().split(";").shift()},e.prototype.initOptimizely=function(){window.optimizely=window.optimizely||[]},e.prototype._dagdaTrackSummaryLoop=function(e){this._logger.info("dagda summary loop"),this._dagda.galleryTrack({currentTime:this._getCurrentTime(e),eventType:y.a.summaryLoop,isRedirect:!1,passiveTracking:r.a.passivetracking,previewHash:e.galleryData.vilynxData.hash,resolution:this._getResolution(e)})},e.prototype._dagdaTrackSummaryEnd=function(e){this._logger.info("dagda summary end"),this._dagda.galleryTrack({currentTime:this._getTotalTime(e),eventType:y.a.summaryEnd,isRedirect:!1,passiveTracking:r.a.passivetracking,previewHash:e.galleryData.vilynxData.hash,resolution:this._getResolution(e)})},e.prototype._dagdaTrackSummaryStart=function(e){this._logger.info("dagda summary start"),this._dagda.galleryTrack({currentTime:this._getCurrentTime(e),eventType:y.a.summaryStart,isRedirect:!1,passiveTracking:r.a.passivetracking,previewHash:e.galleryData.vilynxData.hash,resolution:this._getResolution(e)})},e.prototype._dagdaTrackSummaryClick=function(e,t){this._logger.info("dagda summary click"),this._dagda.galleryTrack({currentTime:this._getCurrentTime(e),eventType:y.a.summaryClick,isRedirect:t,passiveTracking:r.a.passivetracking,previewHash:e.galleryData.vilynxData.hash,resolution:this._getResolution(e)})},e.prototype._dagdaThumbnailShown=function(e){this._logger.info("dagda ThumbnailShown"),this._dagda.galleryTrack({currentTime:0,eventType:y.a.summaryShow,isRedirect:!0,passiveTracking:r.a.passivetracking,previewHash:e.galleryData.vilynxData.hash,resolution:this._getResolution(e)})},e.prototype._getCurrentTime=function(e){return e.videoNode&&Math.round(e.videoNode.currentTime)||0},e.prototype._getTotalTime=function(e){return e.videoNode&&void 0!==e.videoNode.currentTime&&void 0!==e.videoNode.countLoops&&void 0!==e.config.duration?Math.round(e.videoNode.currentTime+e.videoNode.countLoops*e.config.duration):0},e.prototype._getResolution=function(e){return e.videoNode&&e.videoNode.resolution||y.b.galleryPro69},e}(),_=function(){return function(){}}(),b=new(function(){function e(){var e=this;this.logger=new s.a("[vlx_dbg]");var t=setInterval(function(){c.a.loaded&&(e.logger.info("ScrollMonitor initialized"),window.scrollMonitor=e.factory(),clearInterval(t))},20)}return e.prototype.factory=function(){this.version=1.2;var e,t,i,o,n,a,s,l=!1,c="undefined"==typeof window,d=!c,u=function(){return c?0:window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop},h=function(){return c?0:window.pageXOffset>=0?0:window.pageXOffset||document.documentElement&&document.documentElement.scrollWidth||document.body.scrollWidth},p=new _,g=[],f="visibilityChange",y="enterViewport",v="fullyEnterViewport",m="exitViewport",b="partiallyExitViewport",w="locationChange",O="stateChange",E="canPreload",x="canUnload",T="thresholdEnterViewport",I="thresholdExitViewport",N=[f,y,v,m,b,w,O,E,x,T,I],S={top:0,bottom:0},P=function(){return c?0:window.innerHeight||document.documentElement.clientHeight},D=function(){return c?0:window.innerWidth||document.documentElement.clientWidth},A=function(){return c?0:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)},L=function(){return c?0:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)};function k(){if(p.viewportTop=u(),p.viewportBottom=p.viewportTop+p.viewportHeight,p.documentHeight=A(),p.viewportLeft=h(),p.viewportRight=p.viewportLeft+p.viewportWidth,p.documentWidth=L(),p.documentHeight!==t||p.documentWidth!==i){for(n=g.length;n--;)g[n].recalculateLocation();t=p.documentHeight,i=p.documentWidth}}function j(){p.viewportHeight=P(),p.viewportWidth=D(),k(),C()}function V(){clearTimeout(a),a=window.setTimeout(j,100)}function C(){for(s=g.length;s--;)g[s].recalculateLocation(),g[s].update();for(s=g.length;s--;)g[s].triggerCallbacks()}function M(e,t,i){var r=this;this.watchItem=e,this.overFlowParent=i,this.isInDocument=!0,this.offsets=t?t===+t?{top:t,bottom:t}:{bottom:t.bottom||S.bottom,top:t.top||S.top}:S,this.callbacks={};for(var n=0,a=N.length;n<a;n++)r.callbacks[N[n]]=[];this.locked=!1;var s,l,c,d,u,h,g,_,P=!0;function D(e){if(0!==e.length)for(g=e.length;g--;)(_=e[g]).callback.call(r,o),_.isOne&&e.splice(g,1)}this.triggerCallbacks=function(){switch(this.isInViewport&&!s&&D(this.callbacks[y]),this.isFullyInViewport&&!l&&D(this.callbacks[v]),this.isCanPreload&&!u&&D(this.callbacks[E]),this.isCanUnload&&!P&&D(this.callbacks[x]),this.isThresholdInViewport&&!h&&D(this.callbacks[T]),!this.isThresholdInViewport&&h&&D(this.callbacks[I]),this.isAboveViewport!==c&&this.isBelowViewport!==d&&(D(this.callbacks[f]),l||this.isFullyInViewport||(D(this.callbacks[v]),D(this.callbacks[b])),s||this.isInViewport||(D(this.callbacks[y]),D(this.callbacks[m]))),!this.isFullyInViewport&&l&&D(this.callbacks[b]),!this.isInViewport&&s&&D(this.callbacks[m]),this.isInViewport!==s&&D(this.callbacks[f]),!0){case s!==this.isInViewport:case l!==this.isFullyInViewport:case c!==this.isAboveViewport:case d!==this.isBelowViewport:D(this.callbacks[O])}s=this.isInViewport,l=this.isFullyInViewport,c=this.isAboveViewport,d=this.isBelowViewport,u=this.isCanPreload,P=this.isCanUnload,h=this.isThresholdInViewport},this.recalculateLocation=function(){if(!this.locked&&this.watchItem){this.isInDocument=!(this.watchItem.ownerDocument===document&&!document.body.contains(this.watchItem));var e=this.top,t=this.bottom;if(this.watchItem.nodeName){var i=this.watchItem.style.display;"none"===i&&(this.watchItem.style.display="");var o=this.watchItem.getBoundingClientRect(),r=void 0;this.parentTop=0,this.parentBottom=1/0,this.parentLeft=0,this.parentRight=1/0,this.overFlowParent&&(r=this.overFlowParent.getBoundingClientRect(),this.parentTop=Math.ceil(r.top)+p.viewportTop,this.parentBottom=Math.floor(r.bottom)+p.viewportTop,this.parentLeft=Math.ceil(r.left)+p.viewportLeft,this.parentRight=Math.floor(r.right)+p.viewportLeft),this.top=Math.ceil(o.top)+p.viewportTop,this.bottom=Math.floor(o.bottom)+p.viewportTop,this.left=Math.ceil(o.left)+p.viewportLeft,this.right=Math.floor(o.right)+p.viewportLeft,"none"===i&&(this.watchItem.style.display=i)}else this.watchItem===+this.watchItem?this.watchItem>0?this.top=this.bottom=this.watchItem:this.top=this.bottom=p.documentHeight-this.watchItem:(this.top=this.watchItem.top,this.bottom=this.watchItem.bottom,this.left=this.watchItem.left,this.right=this.watchItem.right,this.overFlowParent&&(this.parentTop=this.overFlowParent.top,this.parentBottom=this.overFlowParent.bottom,this.parentLeft=this.overFlowParent.left,this.parentRight=this.overFlowParent.right));var n=1-(this.bottom-this.top);this.top-=Math.max(n,this.offsets.top),this.bottom+=Math.max(n,this.offsets.bottom),this.height=this.bottom-this.top,this.width=this.right-this.left,void 0===e&&void 0===t||this.top===e&&this.bottom===t||D(this.callbacks[w])}},this.recalculateLocation(),this.update(),s=this.isInViewport,l=this.isFullyInViewport,c=this.isAboveViewport,d=this.isBelowViewport}p.viewportTop=null,p.viewportBottom=null,p.documentHeight=null,p.viewportHeight=P(),p.viewportWidth=D(),M.prototype={on:function(e,t,i){switch(!0){case e===f&&!this.isInViewport&&this.isAboveViewport:case e===y&&this.isInViewport:case e===v&&this.isFullyInViewport:case e===m&&this.isAboveViewport&&!this.isInViewport:case e===b&&this.isAboveViewport:case e===E&&this.isCanPreload:case e===x&&this.isCanUnload:if(t.call(this,o),i)return}if(!this.callbacks[e])throw new Error("Tried to add a scroll monitor listener of type "+e+". Your options are: "+N.join(", "));this.callbacks[e].push({callback:t,isOne:i||!1})},off:function(e,t){if(!this.callbacks[e])throw new Error("Tried to remove a scroll monitor listener of type "+e+". Your options are: "+N.join(", "));for(var i=0;i<this.callbacks[e].length;i++)if(this.callbacks[e][i]===t){this.callbacks[e].splice(i,1);break}},one:function(e,t){this.on(e,t,!0)},recalculateSize:function(){this.height=this.watchItem.offsetHeight+this.offsets.top+this.offsets.bottom,this.bottom=this.top+this.height,this.width=this.right-this.left},update:function(){var e=Math.max(this.parentTop,p.viewportTop),t=Math.min(this.parentBottom,p.viewportBottom),i=Math.max(this.parentLeft,p.viewportLeft),o=Math.min(this.parentRight,p.viewportRight);this.isAboveViewport=this.top<e,this.isBelowViewport=this.bottom>t,this.overLeftDistance=this.isOverLeftViewport?i-this.left:0,this.overRightDistance=this.isOverRightViewport?this.right-o:0,this.horizontalInViewport=Math.max((this.width-(this.overLeftDistance+this.overRightDistance))/this.width,0),this.isOverLeftViewport=this.left<i,this.isOverRightViewport=this.right>o,this.isValid=this.isInDocument&&this.bottom!==p.viewportTop+this.offsets.top||this.top!==p.viewportTop-this.offsets.top,this.isInViewport=this.isValid&&this.top<=t&&this.bottom>=e&&this.left<=o&&this.right>=i,this.isFullyInViewport=this.isValid&&(!this.isAboveViewport&&!this.isBelowViewport&&!this.isOverLeftViewport&&!this.isOverRightViewport||!this.isAboveViewport&&!this.isBelowViewport&&this.isOverLeftViewport&&this.isOverRightViewport||this.isAboveViewport&&this.isBelowViewport),this.isThresholdInViewport=this.isValid&&(!this.isAboveViewport&&!this.isBelowViewport||this.isAboveViewport&&this.isBelowViewport)&&100*this.horizontalInViewport>r.a.horizontalthreshold,this.isCanPreload=this.top-r.a.preloadoffset<=t&&this.bottom+r.a.preloadoffset>=e,this.isCanUnload=!this.isCanPreload},destroy:function(){var e=g.indexOf(this);g.splice(e,1);for(var t=0,i=N.length;t<i;t++)this.callbacks[N[t]].length=0},lock:function(){this.locked=!0},unlock:function(){this.locked=!1}};for(var R=function(e){return function(t,i){this.on.call(this,e,t,i)}},q=0,U=N.length;q<U;q++){var z=N[q];M.prototype[z]=R(z)}if(d)try{k()}catch(e){try{window.$(k)}catch(e){throw new Error("If you must put scrollMonitor in the <head>, you must use jQuery.")}}function B(e){o=e,k(),C()}return d&&(window.addEventListener?(window.addEventListener("scroll",function(t){l=!0,clearTimeout(e),e=window.setTimeout(function(){window.requestAnimationFrame(function(){B(t),l=!1})},r.a.scrollrenderdelay)},!0),window.addEventListener("resize",V)):(window.attachEvent("onscroll",B),window.attachEvent("onresize",V)),r.a.proactiveload&&setInterval(function(){l||B()},200)),p.beget=p.create=function(e,t,i){"string"==typeof e?e=document.querySelector(e):e&&e.length>0&&(e=e[0]);var o=new M(e,t,i);return g.push(o),o.update(),o},p.update=function(){o=null,k(),C()},p.recalculateLocations=function(){p.documentHeight=0,p.update()},p.version=this.version,p},e.prototype.reFactory=function(){this.logger.warn("ScrollMonitor create error, reFactory method called"),window.scrollMonitor=this.factory()},e}()),w=i(6),O=function(){function e(){}return Object.defineProperty(e.prototype,"webm",{get:function(){return this._webm},set:function(e){this._webm=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mp4",{get:function(){return this._mp4},set:function(e){this._mp4=e},enumerable:!0,configurable:!0}),e}(),E=function(){function e(e,t,i){this._is169=e,this._isVertical=t,this._posterUrl=i,this._sources=new O}return Object.defineProperty(e.prototype,"sources",{get:function(){return this._sources},set:function(e){this._sources=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is169",{get:function(){return this._is169},set:function(e){this._is169=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"posterUrl",{get:function(){return this._posterUrl},set:function(e){this._posterUrl=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVertical",{get:function(){return this._isVertical},set:function(e){this._isVertical=e},enumerable:!0,configurable:!0}),e}(),x=function(){function e(e,t,i){this._url=e,this._mime=t,this._resolution=i}return Object.defineProperty(e.prototype,"mime",{get:function(){return this._mime},set:function(e){this._mime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},set:function(e){this._url=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(e){this._resolution=e},enumerable:!0,configurable:!0}),e}(),T=function(){function e(){}return Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e},enumerable:!0,configurable:!0}),e}(),I=new(function(){function e(){this._logger=new s.a("[vlx_dbg]")}return e.prototype.getVideoUrl=function(e,t,i,o,n){var a,s,l,d,h,p,g,f=e.timestamp||0,v=c.a.serverUrl.slice(4),m=r.a.publickey,_=i>=1.5,b=i<1&&o,w=this._getPersonalizedPreviewIndex(e.embeddings,e.modelHash,n);return e.embeddingIndex=w,g=r.a.directurl?"direct/"+m+"/"+e.externalId:e.hash,r.a.reduceresolution&&(t>640?t=639:t>360&&(t=359)),_?u.a.isMobile&&r.a.forcesmallvideo?(a="//public."+v+"/"+g+"/gallery.pro69.$PP$viwindow",h="//public."+v+"/"+g+"/gallery.pro69.viwindow0.jpg",s=y.b.galleryPro69):t>640?(a="//public."+v+"/"+g+"/pro69high.$PP$viwindow",h="//public."+v+"/"+g+"/pro69high.viwindow0.jpg",s=y.b.pro69high):t>360?(a="//public."+v+"/"+g+"/pro69.$PP$viwindow",h="//public."+v+"/"+g+"/pro69.viwindow0.jpg",s=y.b.pro69):(a="//public."+v+"/"+g+"/gallery.pro69.$PP$viwindow",h="//public."+v+"/"+g+"/gallery.pro69.viwindow0.jpg",s=y.b.galleryPro69):b?u.a.isMobile&&r.a.forcesmallvideo||t<=135?(a="//public."+v+"/"+g+"/gallery.pro23.$PP$viwindow",h="//public."+v+"/"+g+"/gallery.pro23.viwindow0.jpg",s=y.b.galleryPro23):t<=240?(a="//public."+v+"/"+g+"/pro23.$PP$viwindow",h="//public."+v+"/"+g+"/pro23.viwindow0.jpg",s=y.b.pro23):(a="//public."+v+"/"+g+"/pro23high.$PP$viwindow",h="//public."+v+"/"+g+"/pro23high.viwindow0.jpg",s=y.b.pro23high):u.a.isMobile&&r.a.forcesmallvideo?(a="//public."+v+"/"+g+"/gallery.short.$PP$viwindow",h="//public."+v+"/"+g+"/gallery.short.viwindow0.jpg",s=y.b.galleryShort):t>360?(a="//public."+v+"/"+g+"/pro.$PP$viwindow",h="//public."+v+"/"+g+"/short.viwindow0.jpg",s=y.b.pro):(a="//public."+v+"/"+g+"/gallery.short.$PP$viwindow",h="//public."+v+"/"+g+"/gallery.short.viwindow0.jpg",s=y.b.galleryShort),l=(a=w?a.replace("$PP$",w+"_"):a.replace("$PP$",""))+".mp4",d=a+".webm",r.a.directurl||(l+="?t="+f+"&owner="+m,d+="?t="+f+"&owner="+m),(p=new E(_,b,h)).sources.mp4=new x(l,"video/mp4",s),p.sources.webm=new x(d,"video/webm",s),p},e.prototype.extractBGImageFromNode=function(e){return e.style.backgroundImage.slice(4,-1).replace(/["|']/g,"")},e.prototype.createCopyImage=function(e){var t=document.createElement("img");return t.className="vilynx_wrapperImg",r.a.scandivwbgattr&&e.getAttribute(r.a.scandivwbgattr)?t.src=e.getAttribute(r.a.scandivwbgattr):""!==e.style.backgroundImage?t.src=this.extractBGImageFromNode(e):e instanceof HTMLImageElement&&e.src&&e.src.length>0&&(t.src=e.currentSrc||e.src),t},e.prototype.findActiveImage=function(e){var t=null;return[].forEach.call(e,function(e){0!==e.offsetWidth&&0!==e.offsetHeight&&(!t||t.offsetWidth<e.offsetWidth)&&(t=e)}),t},e.prototype.getTargetImgSize=function(e){var t=e.parentNode.getBoundingClientRect(),i=t.height,o=t.width,r=e.getBoundingClientRect(),n=new T;return n.width=r.width,n.height=r.height,0!==i&&0!==o&&("inline"!==window.getComputedStyle(e.parentNode).display&&i<n.height&&(n.height=i),o<n.width&&(n.width=o)),n},e.prototype.showNodes=function(e){var t=this,i=0;if(e.constructor!==Array)throw new Error("nodes must be an array of dom nodes!");return e.forEach(function(e){e&&(e.classList?(i++,e.classList.remove("vilynx_fading")):(t._logger.error(e),t._logger.error("Node is not a valid dom node, does not have classList")))}),i},e.prototype.hideNodes=function(e){var t=this,i=0;if(e.constructor!==Array)throw new Error("nodes must be an array of dom nodes!");return e.forEach(function(e){e&&(e.classList?(i++,e.classList.add("vilynx_fading")):(t._logger.error(e),t._logger.error("Node is not a valid dom node, does not have classList")))}),i},e.prototype.isNodeVilynxHidden=function(e){return e.classList.contains("vilynx_fading")},e.prototype.addLeftCssToNode=function(e,t){var i=parseFloat(window.getComputedStyle(e).left),o=t;return i&&(o+=i),e.style.left=0===o?"":o+"px",o},e.prototype.elementNeedsRelative=function(e){if("static"===window.getComputedStyle(e).position){var t=this.querySelectorInclusive(e,".vilynx_mainImg"),i=e.parentNode;if(i){var o=i.getBoundingClientRect(),r=window.getComputedStyle(i),n=e.getBoundingClientRect();if(n.top!==o.top||n.left!==o.left){var a=t.getBoundingClientRect();if(a.top!==o.top||a.left!==o.left||"relative"!==r.position||-1!==r.overflow.indexOf("scroll")||-1!==r.overflow.indexOf("auto"))return!0}}}return!1},e.prototype.getImageCandidates=function(e,t){var i=Array.prototype.slice.call(e.querySelectorAll(t)),o=[];return e.classList.contains("vilynx_img")&&i.push(e),r.a.imgignore?i.forEach(function(e){e.matches(r.a.imgignore)||o.push(e)}):o=i,o},e.prototype.querySelectorInclusive=function(e,t){return e.matches(t)?e:e.querySelector(t)},e.prototype.extractAttributeChanges=function(e,t){var i;return i={additions:[],changes:{},removals:[]},t.forEach(function(t){if("attributes"===t.type){var o=t.attributeName,r=t.oldValue,n=e.getAttribute(o),a=o.replace("data-",""),s=!1,l=!1;0===a.indexOf("vilynx-")&&(a=a.replace("vilynx-","vilynx_"),r&&"false"!==r&&(s=!0),n&&"false"!==n&&(l=!0),r!==n&&(i.changes[a.replace("vilynx_","")]={newValue:n,prevValue:r}),s!==l&&(l?i.additions.push(a):i.removals.push(a)))}}),i},e.prototype.getArrayChanges=function(e,t){return{additions:t.slice().filter(function(t){return-1===e.indexOf(t)}),removals:e.slice().filter(function(e){return-1===t.indexOf(e)})}},e.prototype._getPersonalizedPreviewIndex=function(e,t,i){if(!(e&&i&&i[t]))return 0;try{var o=i[t].embeddings.reduce(d.vectorAddition),r=e.map(function(e){return Math.abs(d.cosineSimilarity(e,o))});return r.indexOf(Math.min.apply(Math,r))}catch(e){return 0}},e}()),N=i(15),S=function(){return function(){}}(),P=new(function(){function e(){this.queue=[],this.elementsDownloaded=0,this.logger=new s.a("[vlx_dbg]")}return e.prototype.addElement=function(e){-1===this.queue.indexOf(e)&&this.queue.push(e)},e.prototype.removeElement=function(e){var t=this.queue.indexOf(e);-1!==t&&this.queue.splice(t,1)},e.prototype.markElementRemoved=function(){this.elementsDownloaded--,this.elementsDownloaded===r.a.iemaxelements-1&&(this.logger.info("Elements have been removed. There is space enough in download queue to keep downloading."),this.start())},e.prototype.start=function(){var e=this;this.downloadInterval||(this.downloadElement(),this.downloadInterval=window.setInterval(function(){e.elementsDownloaded>=r.a.iemaxelements?(clearInterval(e.downloadInterval),e.downloadInterval=null,e.logger.warn("Download queue filled. Stop downloading.")):e.downloadElement()},r.a.downloadfrequency))},e.prototype.downloadElement=function(){if(this.queue.length){var e=this.queue.shift();e.watcher.isInViewport?(e.attachVideoNode(),this.elementsDownloaded++):this.downloadElement()}else this.downloadInterval&&(clearInterval(this.downloadInterval),this.downloadInterval=null)},e}()),D=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),A=function(e){function t(t,i){var o=e.call(this,"["+i+":"+t+"]")||this;return o._debugId=t,o}return D(t,e),Object.defineProperty(t.prototype,"debugId",{get:function(){return this._debugId},set:function(e){this._debugId=e},enumerable:!0,configurable:!0}),t}(s.a),L=function(){function e(){this._browser=u.a,this._externalfading=!1,this._browser=u.a,this._verticalpreviews=r.a.verticalpreviews,this._redirect=r.a.redirect&&!this._browser.isMobile,this._redirecttext=r.a.redirecttext,this._redirectafter=r.a.redirectafter,this._redirectautoplay=r.a.redirectautoplay,this._ctatext=r.a.ctatext,this._hidectaicon=r.a.hidectaicon,this._redirectwithclick=r.a.redirectwithclick,this._redirectwithvid=r.a.redirectwithvid,this._fadeinadvance=r.a.fadeinadvance,this._mobilecta=r.a.mobilecta,this._mobilectaloopcount=r.a.mobilectaloopcount,this._audiopolicycta=r.a.audiopolicycta,this._autoplay=this._browser.isMobile&&!r.a.taptoplay||!this._browser.isMobile&&r.a.autoplay,this._autoplayonce=r.a.autoplayonce,this._stopnoimage=r.a.stopnoimage,this._pauseonhover=r.a.pauseonhover,this._pausehoveronce=r.a.pausehoveronce,this._previewdelay=r.a.previewdelay,this._audio=r.a.audio,this._audioonce=r.a.audioonce,this._audiohover=r.a.audiohover,this._taptoplay=r.a.taptoplay,this._topviewportoffset=r.a.topviewportoffset,this._bottomviewportoffset=r.a.bottomviewportoffset,this._playpriority=0,this._noimage=r.a.noimage,this.noposterimage=r.a.noposterimage,this._externalfading=!1,this._isDisabled=!1,this._duration=0,this._isVertical=!1,this._videoRatio=0}return Object.defineProperty(e.prototype,"videoRatio",{get:function(){return this._videoRatio},set:function(e){this._videoRatio=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVertical",{get:function(){return this._isVertical},set:function(e){this._isVertical=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},set:function(e){this._duration=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDisabled",{get:function(){return this._isDisabled},set:function(e){this._isDisabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"externalfading",{get:function(){return this._externalfading},set:function(e){this._externalfading=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"noimage",{get:function(){return this._noimage},set:function(e){this._noimage=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"taptoplay",{get:function(){return this._taptoplay},set:function(e){this._taptoplay=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audiohover",{get:function(){return this._audiohover},set:function(e){this._audiohover=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioonce",{get:function(){return this._audioonce},set:function(e){this._audioonce=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audio",{get:function(){return this._audio},set:function(e){this._audio=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pausehoveronce",{get:function(){return this._pausehoveronce},set:function(e){this._pausehoveronce=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pauseonhover",{get:function(){return this._pauseonhover},set:function(e){this._pauseonhover=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stopnoimage",{get:function(){return this._stopnoimage},set:function(e){this._stopnoimage=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoplayonce",{get:function(){return this._autoplayonce},set:function(e){this._autoplayonce=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoplay",{get:function(){return this._autoplay},set:function(e){this._autoplay=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audiopolicycta",{get:function(){return this._audiopolicycta},set:function(e){this._audiopolicycta=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mobilectaloopcount",{get:function(){return this._mobilectaloopcount},set:function(e){this._mobilectaloopcount=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mobilecta",{get:function(){return this._mobilecta},set:function(e){this._mobilecta=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fadeinadvance",{get:function(){return this._fadeinadvance},set:function(e){this._fadeinadvance=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redirectwithvid",{get:function(){return this._redirectwithvid},set:function(e){this._redirectwithvid=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redirectwithclick",{get:function(){return this._redirectwithclick},set:function(e){this._redirectwithclick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidectaicon",{get:function(){return this._hidectaicon},set:function(e){this._hidectaicon=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ctatext",{get:function(){return this._ctatext},set:function(e){this._ctatext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redirectautoplay",{get:function(){return this._redirectautoplay},set:function(e){this._redirectautoplay=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redirectafter",{get:function(){return this._redirectafter},set:function(e){this._redirectafter=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redirecttext",{get:function(){return this._redirecttext},set:function(e){this._redirecttext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redirect",{get:function(){return this._redirect},set:function(e){this._redirect=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStopped",{get:function(){return this._isStopped},set:function(e){this._isStopped=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topviewportoffset",{get:function(){return this._topviewportoffset},set:function(e){this._topviewportoffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomviewportoffset",{get:function(){return this._bottomviewportoffset},set:function(e){this._bottomviewportoffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playpriority",{get:function(){return this._playpriority},set:function(e){this._playpriority=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"noposterimage",{get:function(){return this._noposterimage},set:function(e){this._noposterimage=null===e?!!this._browser.isChrome&&this._browser.isChrome>=75:r.a.noposterimage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previewdelay",{get:function(){return this._previewdelay},set:function(e){"number"!=typeof e&&(e=parseFloat(e)),this._previewdelay=isNaN(e)?0:e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verticalpreviews",{get:function(){return this._verticalpreviews},set:function(e){this._verticalpreviews=e},enumerable:!0,configurable:!0}),e}(),k=L,j=(new L,i(16)),V=i(10),C=function(){function e(e){var t=this;this._onVideoEnd=[],this._onVideoLoop=[],this._onVideoCancel=[],this._redirect=null,this._deleted=!1,this._hasSentPlayEvent=!1,this.config=new k,this._debugId=e.vilynxData.hash.substr(0,7)+"-"+j.a.generateRandomHex(4),this.logger=new A(this._debugId,"gallery_item"),e.domObject.classList.add("vilynx"),this.galleryData=e,r.a.debug&&e.domObject.setAttribute("vlx_dbg",String(this._debugId)),r.a.ongalleryload&&n.a.getOnLoadGalleryItem().length>0&&n.a.getOnLoadGalleryItem().forEach(function(e){e(t.galleryData.domObject)});try{this.loadConfig()}catch(e){this.logger.error("Exception raised while loading the item config. Aborting item execution. Stack trace: "),this.logger.error(e)}}return e.prototype.dealloc=function(){var e=this;this._redirect&&this._redirect.dealloc(),this._redirect=void 0,this.watcher.destroy(),this.logger=void 0,this.config=void 0,this._analytics=void 0,this._debugId=void 0,this.videoNode=void 0,Object.keys(this.watcher).forEach(function(t){e.watcher[t]=void 0}),this.watcher=void 0},e.prototype.loadConfig=function(){var e=this,t=this.galleryData.domObject;return t?([].forEach.call(t.classList,function(t){var i=t.substr(7);void 0===e.config[i]?e.logger.warn("Gallery item Config register not found: "+i):(e.config[i]=!0,e.logger.debug("Gallery item Config element loaded: "+i))}),Object.keys(t.attributes).forEach(function(i){var o=t.attributes[i];if(o){var r=o.name.replace("data-","");if(0===r.indexOf("vilynx-")){var n=r.replace("vilynx-","");void 0!==e.config[n]?("boolean"==typeof e.config[n]?e.config[n]=!("false"===o.value||""===o.value):"number"==typeof e.config[n]?isNaN(parseInt(o.value,10))?e.logger.error('Attribute "'+n+'" must be a number'):e.config[n]=parseInt(o.value,10):e.config[n]=o.value,e.logger.debug("Gallery item Config element loaded: "+n+"; value: "+o.value)):e.logger.warn("Gallery item Config attribute not found: "+n+";")}}}),!0):(this.logger.warn("Element not detected"),!1)},e.prototype.generateVideoUrl=function(){var e,t,i=I.getImageCandidates(this.galleryData.domObject,this._imgSelectorQuery),o=I.findActiveImage(i)||i[0];return o?(t=(e=o.clientWidth)/o.clientHeight,this.videoData=I.getVideoUrl(this.galleryData.vilynxData,e,t,this.config.verticalpreviews,this.userEmbeddings),this.logger.debug("Video url "+this.videoData.sources.mp4.url),!0):(this.logger.error("Cant generate video url. No valid image found"),!1)},e.prototype.getCountLoops=function(){var e=this.videoNode.countLoops;return 1e3*this.videoNode.currentTime<300&&this.videoNode.throttle&&(e=this.videoNode.countLoops+1,this.logger.info("getCountLoops function fired before 'timeupdate' event. Adding 1 to countLoops")),e},e.prototype.playAndCatch=function(){try{this.videoNode.play()}catch(e){this.watcher.destroy(),this.logger.warn("This element had a huge issue trying to do the play. Destroying watcher listeners ")}},e.prototype.isOneLoopAutoplayVideoFinished=function(){return!this.videoNode||1e3*this.videoNode.currentTime>=1e3*this.videoNode.duration-this.config.fadeinadvance},e.prototype.storeEmbeddingsInLocalStorage=function(){var e=this.userEmbeddings,t=this.galleryData.vilynxData;if(!(e[t.modelHash]&&e[t.modelHash].embeddings.some(function(e){var i=JSON.stringify(t.embeddings),o=JSON.stringify(e);return-1!==i.indexOf(o)}))){if(e[t.modelHash])e[t.modelHash].embeddings.length>=3&&e[t.modelHash].embeddings.shift(),e[t.modelHash].embeddings.push(t.embeddings[t.embeddingIndex]);else{if(2===Object.keys(e).length){var i=Object.keys(e),o=i[0],r=i[1];delete e[e[o].modelCreationTimestamp>e[r].modelCreationTimestamp?r:o]}e[t.modelHash]={embeddings:[t.embeddings[t.embeddingIndex]],modelCreationTimestamp:(new Date).getTime()}}V.a.set("vlx_embeddings",e,h.a.json)}},Object.defineProperty(e.prototype,"userEmbeddings",{get:function(){return V.a.get("vlx_embeddings",h.a.json)||{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasSentPlayEvent",{get:function(){return this._hasSentPlayEvent},set:function(e){this._hasSentPlayEvent=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"analytics",{get:function(){return this._analytics},set:function(e){this._analytics=e},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e}(),M=function(){return function(){}}(),R=function(){return function(){}}(),q=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),U=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return q(t,e),t}(R),z=function(){return function(){}}(),B=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),F=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return B(t,e),t}(z),W=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),G=function(e){function t(t){var i=e.call(this,t)||this;return i._elementWasClicked=!1,i._mousePressed=0,i}return W(t,e),t.prototype.init=function(){this.initializeParameters(),this.initializeListeners()},t.prototype.initializeParameters=function(){this._msIeUtils=new M,this._msIeUtils.avoidIeFalseError=!1,this._msIeUtils.prevMsieLeftVariation=0,this._observers=new F,this._timeouts=new U,this._analytics=new m,I.querySelectorInclusive(this.galleryData.domObject,".vilynx_img")?this._imgSelectorQuery=".vilynx_img":this._imgSelectorQuery="img:not(.vilynx_wrapperImg)",this._wrapperNode=null},t.prototype.initializeListeners=function(){r.a.optimizely&&r.a.optimizelyoff||r.a.passivetracking?(this.mouseClickListeners(),this.mouseMoveListeners()):this.monitorizeDesktop(),this.observeVilynxId()},t.prototype.monitorizeDesktop=function(){var e=this;this._externalFadeNode=null,this.config.externalfading&&(this._externalFadeNode=document.querySelector('[data-vilynx-fadingid="'+this.galleryData.extractedUrl+'"], [vilynx-fadingid="'+this.galleryData.extractedUrl+'"]'),this._externalFadeNode||this.logger.warn("No node found on document with the attr [data-]vilynx-fadingid="+this.galleryData.extractedUrl));var t=200;r.a.aggressivelazy&&(t=1e3),(void 0===window.scrollMonitor||!window.scrollMonitor.version||window.scrollMonitor.version<b.version)&&b.reFactory(),this.watcher=window.scrollMonitor.create(this.galleryData.domObject,t),this.watcher.enterViewport(function(){e.config.isDisabled||(u.a.isEdge||u.a.isMsie?e._timeouts.waitToLoadTimeout=window.setTimeout(function(){e.watcher.isInViewport&&(e.logger.info("Item has been more than 350ms in viewport. Loading video!"),u.a.isEdge?e.attachVideoNode():(P.addElement(e),P.start()))},350):r.a.downloadfrequency?(P.addElement(e),P.start()):e.attachVideoNode())}),this.watcher.exitViewport(function(){e.config.isDisabled||(clearTimeout(e._timeouts.waitToLoadTimeout),e._wrapperNode&&e.videoNode?(e.logger.info("Exiting Viewport"),e.doExitViewport()):r.a.downloadfrequency&&P.removeElement(e))})},t.prototype.attachVideoNode=function(){var e=this;try{var t=this.galleryData.domObject.classList.contains("vilynx_registered");if(this.config.isDisabled)return void this.logger.warn("This element is disabled. Ignore enterViewport event");t?!t||this.videoNode&&!this.videoNode.paused||(this.logger.info("autoplayOrAttachVideoNode again"),this.autoplayOrAttachVideoNode()):(this.logger.info("Entering viewport for first time"),this.initGallery(),this._analytics.trackThumbnailShown(this)),this.config.autoplay&&(clearTimeout(this._timeouts.trackSummaryPlayTimeout),this._timeouts.trackSummaryPlayTimeout=window.setTimeout(function(){!e.videoNode||e.videoNode.paused||e._hasSentPlayEvent||(e._analytics.trackSummaryPlay(e),e._hasSentPlayEvent=!0)},this._analytics.summaryPlayTimeOut))}catch(e){this.logger.error("Exception raised while processing the gallery attachVideoNode. Aborting item execution. Stack trace:",e)}},t.prototype.initGallery=function(){var e=this;if(this.generateVideoUrl()){if(this.galleryData.domObject.classList.add("vilynx_registered"),this._elementsToIgnore=[],r.a.divignore&&!this.config.autoplay){var t=this.galleryData.domObject;if(r.a.divignorelevels)for(var i=0;i<parseInt(r.a.divignorelevels,10);i++)t=t.parentNode;this._elementsToIgnore=t.querySelectorAll(r.a.divignore),[].forEach.call(this._elementsToIgnore,function(t){e.ignoreElementListeners(t)})}this.videoNode=this.createVideoDom(),this._wrapperNode=this.createWrapperDom(),this.setWrapperResize(),u.a.isSafari&&this.videoData.sources.mp4.url.includes("short")&&!this.config.noposterimage&&this.coverBackgroundWithPoster(),this._wrapperNode.appendChild(this.videoNode),this.setWrapperResize(),I.elementNeedsRelative(this.galleryData.domObject)&&(this.galleryData.domObject.style.position="relative"),this.config.autoplay&&this.setVideoAutoplay(),this.wrapperImageListeners(),this.mouseMoveListeners(),this.mouseClickListeners(),this.videoListeners(),!this.config.redirect||this.config.autoplay&&!this.config.redirectautoplay||(this._redirect=new Q(this,this._analytics),this._wrapperNode.appendChild(this._redirect.createRedirectDom()),this._onVideoEnd.push(this._redirect.checkAudioPolicy.bind(this._redirect)),this._onVideoCancel.push(this._redirect.hideRedirectWrapper.bind(this._redirect))),I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg").classList.contains("vilynx_img")?this.observeBackgroundImage():this.observeOriginalImage(),this.addConfigListener(),this.resizeVideoNode(),this.responsiveListeners()}else this.logger.error("Video url couldn't be generated. Gallery item won't be registered")},t.prototype.doExitViewport=function(){var e=this,t=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");this.config.autoplay&&!this.config.isDisabled?(this.videoNode.readyState>0?this.doPause():setTimeout(function(){e.logger.info("Video ready state is 0. Pause can't be done. Retrying 10ms later"),e.doPause()},10),(this.config.previewdelay||u.a.isMsie)&&(I.showNodes([t,this._externalFadeNode]),this.cleanVideoNode())):this.config.isStopped||this.cleanVideoNode()},t.prototype.cleanVideoNode=function(){this._wrapperNode&&this.videoNode&&this.videoNode.parentElement===this._wrapperNode&&(this._wrapperNode.removeChild(this.videoNode),this.videoNode=null,r.a.downloadfrequency&&P.markElementRemoved())},t.prototype.autoplayOrAttachVideoNode=function(){this.videoNode&&this.config.autoplay&&!u.a.isMsie&&!this.config.previewdelay?this.config.autoplayonce&&this.isOneLoopAutoplayVideoFinished()||this.playAndCatch():this.reAttachVideoNode()},t.prototype.reAttachVideoNode=function(){this._wrapperNode&&(this.generateVideoUrl(),this.videoNode=this.createVideoDom(),this._wrapperNode.appendChild(this.videoNode),u.a.isSafari&&this.videoData.sources.mp4.url.includes("short")&&this.coverBackgroundWithPoster(),this.resizeVideoNode(),this.videoListeners(),this.config.autoplay&&this.setVideoAutoplay())},t.prototype.coverBackgroundWithPoster=function(){this._wrapperNode&&(this._wrapperNode.style.backgroundImage="url( "+this.videoData.posterUrl+" )",this._wrapperNode.style.backgroundSize="cover",this._wrapperNode.style.backgroundPosition="center")},t.prototype.createVideoDom=function(){var e=document.createElement("video"),t=document.createElement("source");return t.src=this.videoData.sources.mp4.url,t.type=this.videoData.sources.mp4.mime,e.appendChild(t),this.config.noposterimage||(e.poster=this.videoData.posterUrl),e.resolution=this.videoData.sources.mp4.resolution,e.preload="none",e.muted=!this.config.audio,e.countLoops=0,e.throttle=!1,e},t.prototype.resizeVideoNode=function(){if(!this.config.isDisabled){try{this.videoNode.childNodes[0]}catch(e){return void this.logger.info("Cant resize video node. The video node seems to not be created")}var e=I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg");if(e){var t,i=e.clientWidth,o=e.clientHeight,r=this.galleryData.domObject.querySelector(".vilynx_wrapperImg"),n="";if(0!==i&&0!==o){if(e.classList.contains("vilynx_img"))""!==e.style.backgroundImage&&(n=I.extractBGImageFromNode(e));else{if(e.naturalWidth<2&&!this.config.autoplay)return;n=e.currentSrc||e.src}n&&r.src!==n&&(r.src=n),this.setWrapperResize(),u.a.isMsie&&(i/(t=this.videoData.is169&&!1===this.config.isVertical?16/9:4/3)<o&&!1===this.config.isVertical||this.videoData.isVertical?(this.videoNode.style.height=o+"px",this.videoNode.style.width=o*t+"px",this.videoNode.style.left=(i-o*t)/2+"px",this.videoNode.style.top="0"):(this.videoNode.style.height=i/t+"px",this.videoNode.style.width=i+"px",this.videoNode.style.left="0",this.videoNode.style.top=(o-i/t)/2+"px",this.config.isVertical&&this.config.videoRatio&&(this.videoNode.style.height=i/this.config.videoRatio+"px",this.videoNode.style.top=Math.round((o-i/this.config.videoRatio)/2)+"px")),this._redirect&&this._redirect.setRedirectFontSize(e))}}else this.logger.error("Cant resize video node. No valid image found")}},t.prototype.createWrapperDom=function(){var e,t;return e=document.createElement("div"),t=I.createCopyImage(this.findMainImg()),e.appendChild(t),this.galleryData.domObject.insertBefore(e,this.galleryData.domObject.childNodes[0]),e.classList.add("supra-wrapper"),this.checkOtherElementszIndex(),u.a.isSafari&&(t.style.transform="translateZ(0)"),e},t.prototype.findMainImg=function(){var e,t=I.getImageCandidates(this.galleryData.domObject,this._imgSelectorQuery);return(e=I.findActiveImage(t)||t[0])?(e.classList.add("vilynx_mainImg"),this.config.noimage&&e.classList.add("vilynx-hide"),this.imageListeners(e),e):null},t.prototype.observeBackgroundImage=function(){var e=this,t=I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg");new MutationObserver(function(){if(""!==t.style.backgroundImage){var i=I.extractBGImageFromNode(t),o=e.galleryData.domObject.querySelector(".vilynx_wrapperImg").src;e.logger.info("Div with background now have url, proceed to assign src in wrapperImg"),i!==o&&(e.galleryData.domObject.querySelector(".vilynx_wrapperImg").src=i,e.resizeVideoNode())}}).observe(t,{attributes:!0,characterData:!0})},t.prototype.observeOriginalImage=function(){var e=this,t=I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg");t.addEventListener("load",function(){var i=t.currentSrc||t.src;i!==e.galleryData.domObject.querySelector(".vilynx_wrapperImg").src&&(e.galleryData.domObject.querySelector(".vilynx_wrapperImg").src=i,e.resizeVideoNode())})},t.prototype.observeVilynxId=function(){var e=this,t=this.galleryData.domObject,i=["vilynx-id","data-vilynx-id","href"];this._observers.idObserve=new MutationObserver(function(t){t.forEach(function(t){try{var i=t.target.getAttribute(t.attributeName),o=t.oldValue;if(null!==i&&i!==o){e.disableNow();var r=[e.galleryData.domObject];ne.privateScan(null,r,e,null)}}catch(t){e.logger.error("Exception raised on vilynx-id attribute observation. Aborting item  mutation. Stack trace:",t)}})}),r.a.idattribute&&i.push(r.a.idattribute),this._observers.idObserve.observe(t,{attributeFilter:i,attributeOldValue:!0,attributes:!0})},t.prototype.refreshVideoNode=function(){this.enableNow(),this.videoNode&&this.cleanVideoNode(),r.a.downloadfrequency?(P.addElement(this),P.start()):this.autoplayOrAttachVideoNode()},t.prototype.checkOtherElementszIndex=function(){var e=this,t=this.galleryData.domObject.getElementsByTagName("*");[].forEach.call(t,function(t){var i=window.getComputedStyle(t);1!==t.nodeType||"absolute"!==i.position&&"relative"!==i.position||!t.classList||t.classList.contains("vilynx_registered")||t.classList.contains("supra-wrapper")||t.classList.contains("vilynx_mainImg")||""!==i.zIndex&&"1"!==i.zIndex&&"auto"!==i.zIndex||0===t.querySelectorAll(".vilynx_mainImg").length&&(e.logger.info("Absolute positioned element found, setting zIndex: 2"),t.style.zIndex="2")})},t.prototype.mouseMoveListeners=function(){var e,t=this,i=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");(e=this.galleryData.domObject).addEventListener("mouseenter",function(){if(i=t.galleryData.domObject.querySelector(".vilynx_wrapperImg"),!t.config.isDisabled)if(t._mousedOver=!0,r.a.passivetracking)t._timeouts.passiveTrackingPlayTimeout=window.setTimeout(function(){t._mousedOver&&(t._analytics.trackSummaryPlay(t),t._hasSentPlayEvent=!0)},500);else{if(t.config.autoplay){if(t.videoNode&&t.config.audiohover&&(t.videoNode.muted=!t.config.audiohover,t.videoNode.paused&&(t.logger.error("Video stopped by audio policy. Removing audio and replaying"),t.config.audiohover=!1,t.playVideo(i))),t.videoNode&&!t.videoNode.paused&&t.config.pauseonhover){t.resizeVideoNode();try{t.videoNode.pause(),t._hasSentPlayEvent&&(t._analytics.trackSummaryEnd(t),t._hasSentPlayEvent=!1)}catch(e){t.logger.info("Pause action failed.")}t.videoNode.currentTime=0,I.showNodes([i,t._externalFadeNode]),t.config.pausehoveronce&&(t.galleryData.domObject.classList.remove("vilynx_autoplay"),t.galleryData.domObject.classList.remove("vilynx_pauseonhover"),t.config.pauseonhover=!1,t.disableAutoplay())}}else t.videoNode&&t.videoNode.paused&&t.playVideo(i);t._redirect&&t.config.redirectafter&&t.doRedirectIn(t.config.redirectafter)}}),e.addEventListener("mouseleave",function(e){clearTimeout(t._timeouts.passiveTrackingPlayTimeout);var i=!1;r.a.passivetracking&&t._hasSentPlayEvent&&(t._analytics.trackSummaryEnd(t),t._hasSentPlayEvent=!1),t.config.isDisabled||(t._mousedOver=!1,r.a.passivetracking||[].forEach.call(t._elementsToIgnore,function(t){(e.relatedTarget===t||t.contains(e.relatedTarget))&&(i=!0)}),i||u.a.isSafari&&t.galleryData.domObject.matches(":hover")||t.doMouseLeave(!1))})},t.prototype.playVideo=function(e){var t=this;e.parentElement.classList&&e.parentElement.classList.contains("vilynx-hide")&&this.setWrapperResize(),this.resizeVideoNode(),this.videoNode.muted=!this.config.audio,u.a.isSafari&&u.a.isSafari<=9?this._timeouts.fadeInterval||(this._timeouts.fadeInterval=window.setInterval(function(){!t.videoNode.paused&&t.videoNode.currentTime>.01&&(I.hideNodes([e,t._externalFadeNode]),clearInterval(t._timeouts.fadeInterval),t._timeouts.fadeInterval=null)},50)):this.config.noposterimage||I.hideNodes([e,this._externalFadeNode]),clearTimeout(this._timeouts.restartTimeout),this.logger.info("Video play");try{var i=this.videoNode.play();i&&i.then(function(){t.config.noposterimage&&t._mousedOver&&I.hideNodes([e,t._externalFadeNode])}).catch(function(i){t.logger.info("An error has been captured while playing video. "+i.name+":"+i.message),t.config.audio&&t.videoNode&&(0===i.code?(t.config.audio=!1,t.playVideo(e)):t._mousedOver&&t.playVideo(e))})}catch(e){this.logger.info("Play action failed.")}n.a.getOnPlay().forEach(function(e){e(t.galleryData.domObject)}),clearTimeout(this._timeouts.trackSummaryPlayTimeout),this._timeouts.trackSummaryPlayTimeout=window.setTimeout(function(){!t.videoNode||t.videoNode.paused||t._hasSentPlayEvent||(t._analytics.trackSummaryPlay(t),t._hasSentPlayEvent=!0)},this._analytics.summaryPlayTimeOut)},t.prototype.doMouseLeave=function(e){var t=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");if(clearTimeout(this._timeouts.waitForDurationTimeout),this.config.autoplay)this.config.pauseonhover&&I.hideNodes([t,this._externalFadeNode]),this.config.audiohover&&this.videoNode&&(this.videoNode.muted=this.config.audiohover),this._redirect&&this._redirect.redirecting&&this.config.redirectautoplay&&this._onVideoCancel.forEach(function(e){e()});else if(!this.config.autoplay){clearInterval(this._timeouts.fadeInterval),this._timeouts.fadeInterval=null,this.videoNode&&!e&&this._hasSentPlayEvent&&(this._analytics.trackSummaryEnd(this),this._hasSentPlayEvent=!1),clearTimeout(this._timeouts.trackSummaryPlayTimeout),this._onVideoCancel.forEach(function(e){e()});try{this.videoNode.pause()}catch(e){this.logger.info("Pause action failed.")}clearTimeout(this._timeouts.restartTimeout),this.resetFallback()}this._redirect&&this.config.redirectafter&&this._redirect.timeToRedirect&&(this._redirect.timeToRedirect=null,this.logger.info("Mouseleave fired. Avoiding redirect."))},t.prototype.resetFallback=function(){var e=this,t=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");this._timeouts.restartTimeout=window.setTimeout(function(){e.logger.info("Transition end has not been fired. Doing video reset via timeout!"),e.doReset(),e._timeouts.restartTimeout=null},400),I.showNodes([t,this._externalFadeNode])},t.prototype.doReset=function(){this.videoNode&&this.videoNode.readyState>0&&(this.videoNode.countLoops=0,this.videoNode.throttle=!1,this._hasSentPlayEvent&&(this._analytics.trackSummaryEnd(this),this._hasSentPlayEvent=!1),this.config.autoplay&&this.config.autoplayonce?this.videoNode.pause():this.videoNode.currentTime>0&&(this.videoNode.currentTime=0))},t.prototype.doPlay=function(){var e=this,t=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");try{var i=this.videoNode.play();i?i.then(function(){I.hideNodes([t,e._externalFadeNode])}):I.hideNodes([t,this._externalFadeNode]),this._hasSentPlayEvent||(this._analytics.trackSummaryPlay(this),this._hasSentPlayEvent=!0)}catch(e){return this.logger.info("Play action failed."),!1}return this.config.noposterimage||I.hideNodes([t,this._externalFadeNode]),this.logger.info("Autoplay video starts to play"),!0},t.prototype.doPause=function(){try{this.videoNode.pause(),this._hasSentPlayEvent&&(this._analytics.trackSummaryEnd(this),this._hasSentPlayEvent=!1)}catch(e){return this.logger.info("Pause action failed."),!1}return!0},t.prototype.setVideoAutoplay=function(){var e=this;!this.videoNode||this.config.autoplayonce&&this.isOneLoopAutoplayVideoFinished()||(this.resizeVideoNode(),this.videoNode.loop=!this.config.autoplayonce,this.config.redirectautoplay&&this.videoNode.duration&&!this.config.redirectafter&&(this.config.redirectafter=1e3*this.videoNode.duration),this.videoNode.muted=!0,this.config.previewdelay?(this.videoNode.readyState<4&&this.videoNode.load(),setTimeout(function(){e.watcher.isInViewport&&e.config.autoplay&&e.doPlay()},1e3*this.config.previewdelay)):0===this.videoNode.readyState?setTimeout(function(){e.config.autoplay&&e.doPlay()},50):this.doPlay())},t.prototype.doRedirectIn=function(e){var t=this;if(this.videoNode&&this.videoNode.duration){if(!this._redirect.timeToRedirect&&!this._redirect.redirecting){var i=1e3*this.videoNode.currentTime+e,o=Math.floor(i/(1e3*(this.config.duration||this.videoNode.duration)));this._redirect.timeToRedirect=i%(1e3*(this.config.duration||this.videoNode.duration)),0===this._redirect.timeToRedirect&&++this._redirect.timeToRedirect,this._redirect.loopToRedirect=this.getCountLoops()+o,this.logger.info("Mouse over at: "+1e3*this.videoNode.currentTime+".\n                        Redirect wrapper will fire at "+this._redirect.timeToRedirect+".\n                        In the "+this._redirect.loopToRedirect+"th loop")}}else this._timeouts.waitForDurationTimeout=window.setTimeout(function(){t.doRedirectIn(e)},100)},t.prototype.responsiveListeners=function(){var e=this,t=I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg");window.addEventListener("resize",function(){e._deleted||e.requestPreviewResize()}),u.a.isSafari&&this._redirect&&window.addEventListener("beforeunload",function(){e._redirect.hideRedirectWrapper()}),this.imageListeners(t),this._observers.imgRemovedObserver=new MutationObserver(function(){if(!(t=I.querySelectorInclusive(e.galleryData.domObject,".vilynx_mainImg"))){e.reassignTargetImage()&&(e.setWrapperResize(),e.resizeVideoNode())}}),this._observers.imgRemovedObserver.observe(t.parentNode,{childList:!0}),this._observers.supraWrapperRemoved=new MutationObserver(function(){e.galleryData.domObject&&e.galleryData.domObject.querySelector(".supra-wrapper")||(e.logger.error("Supra-wrapper has been removed. Removing Gallery Item"),e.removeItem())}),this._observers.supraWrapperRemoved.observe(this.galleryData.domObject,{childList:!0}),r.a.resizeonscroll&&window.addEventListener("scroll",function(){e._deleted||e.requestPreviewResize()})},t.prototype.wrapperImageListeners=function(){var e=this,t=this._wrapperNode.querySelector(".vilynx_wrapperImg");(this.videoNode&&u.a.isChrome&&u.a.isChrome>=75||u.a.isEdge)&&(this.videoNode.style.visibility="hidden",t.addEventListener("load",function(){e.videoNode&&(e.videoNode.style.visibility="visible")},!1)),t.addEventListener("transitionend",function(){clearTimeout(e._timeouts.restartTimeout),t.classList.contains("vilynx_fading")||e.doReset()},!1)},t.prototype.imageListeners=function(e){var t=this;if(!this._observedImage||this._observedImage!==e){var i=new MutationObserver(function(){t.videoNode&&(t.setWrapperResize(),t.resizeVideoNode())});i.observe(e,{attributes:!0,characterData:!0}),this.logger.info("Vilynx_mainImg has changed, observing new image"),this._observers.imageObserver&&this._observers.imageObserver.disconnect(),this._observedImage&&this._observedImage.removeEventListener("transitionend",this.endTransition),e.addEventListener("transitionend",function(e){t._deleted||t.endTransition(e)}),this._observers.imageObserver=i,this._observedImage=e,e.addEventListener("load",function(){t._deleted||(t.logger.info("Image load event fired. Doing resize."),t.setWrapperResize())})}},t.prototype.endTransition=function(e){var t=e.propertyName;["all","top","right","bottom","left","margin-right","margin-left","width","height","size","weight","transform"].some(function(e){return t===e})&&(this.logger.info("transition of type "+t+" has ended. Resizing"),this.requestPreviewResize())},t.prototype.requestPreviewResize=function(){var e=this;this._timeouts.resizeTimeout&&window.cancelAnimationFrame(this._timeouts.resizeTimeout),this._timeouts.resizeTimeout=window.requestAnimationFrame(function(){e.setWrapperResize(),e.resizeVideoNode()})},t.prototype.setWrapperResize=function(){var e=this.reassignTargetImage();if(!e)return this.logger.error("No valid image found. Hiding supra-wrapper"),this.galleryData.domObject&&this.galleryData.domObject.querySelector&&this.galleryData.domObject.querySelector(".supra-wrapper")&&this.galleryData.domObject.querySelector(".supra-wrapper").classList.add("vilynx-hide"),void(this.videoNode&&!this.videoNode.paused&&(this.logger.warn("Supra-wrapper is hidden but video still playing. Pausing"),this.videoNode.pause(),this._hasSentPlayEvent&&(this._analytics.trackSummaryEnd(this),this._hasSentPlayEvent=!1)));this.setWrapperStyles();var t=I.getTargetImgSize(e);this._wrapperNode.style.width=t.width+"px",this._wrapperNode.style.height=t.height+"px",this._redirect&&(this._redirect.setHeight(t.height),this._redirect.setRedirectFontSize(e))},t.prototype.reassignTargetImage=function(){var e,t,i,o=I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg"),r=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");if(!o){if(!(o=this.findMainImg())||!r)return null;r.src=o.currentSrc||o.src}if(e=o.clientWidth,t=o.clientHeight,i=o.naturalWidth,0===e||0===t||i<2&&!this.config.autoplay){this.logger.warn("vilynx_mainImg is too small '"+e+"x"+t+"' searching a new image");var n=I.getImageCandidates(this.galleryData.domObject,this._imgSelectorQuery),a=void 0;if(!(a=I.findActiveImage(n))||a.naturalWidth<2&&!this.config.autoplay)return null;o.classList.remove("vilynx_mainImg"),a.classList.add("vilynx_mainImg"),r.src=a.currentSrc||a.src,o=a,this.imageListeners(o),this.logger.warn("Found new valid image updated vilynx_mainImg & src")}return o},t.prototype.setWrapperStyles=function(){if(this.galleryData.domObject.querySelector(".supra-wrapper")&&(this.galleryData.domObject.querySelector(".supra-wrapper").classList.contains("vilynx-hide")&&(this.logger.warn("Supra-wrapper was hidden but now is shown again"),this.galleryData.domObject.querySelector(".supra-wrapper").classList.remove("vilynx-hide"),this.config.autoplay&&this.setVideoAutoplay()),!this.galleryData.domObject.classList.contains("vilynx_mainImg"))){var e=I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg"),t=window.getComputedStyle(e);if(t.cssFloat&&(this._wrapperNode.style.cssFloat=t.cssFloat),t.marginLeft||t.marginRight||t.marginTop||t.marginBottom?(this._wrapperNode.style.marginLeft=t.marginLeft,this._wrapperNode.style.marginRight=t.marginRight,this._wrapperNode.style.marginTop=t.marginTop,this._wrapperNode.style.marginBottom=t.marginBottom):t.margin&&(this._wrapperNode.style.margin=t.margin.replace(",",".")),this._wrapperNode.style.maxHeight=window.getComputedStyle(e.parentElement).maxHeight,u.a.isMsie){var i=this.galleryData.domObject.getBoundingClientRect().left-this._msIeUtils.prevMsieLeftVariation,o=parseFloat((i%1).toFixed(2)),r=void 0;0!==o&&.5!==o&&(this.logger.info("Fixing wrapper node is placed in "+i+". Normalizing decimals with left."),r=o<.5?o<.25?0-o:.5-o:o>=.75?1-o:.5-o,I.addLeftCssToNode(this.galleryData.domObject,r-this._msIeUtils.prevMsieLeftVariation),this._msIeUtils.prevMsieLeftVariation=r)}}},t.prototype.mouseClickListeners=function(){var e=this,t=this.galleryData.domObject;t.addEventListener("click",function(t){e.onMouseClick(t.which)}),u.a.isSafari||u.a.isIe||(t.addEventListener("mousedown",function(t){e._mousePressed=t.which}),t.addEventListener("mouseout",function(){e._mousePressed=0,e._elementWasClicked=!1}),t.addEventListener("mouseup",function(t){2===e._mousePressed&&2===t.which&&(e.onMouseClick(t.which),e._mousePressed=0,e.logger.info("Middle button pressed. Calling onMouseClick() function."))}))},t.prototype.onMouseClick=function(e){var t=this;if(!this.config.isDisabled){if(c.a.isRedirecting||this._elementWasClicked||(clearTimeout(this._timeouts.passiveTrackingPlayTimeout),this._hasSentPlayEvent||this._analytics.trackSummaryPlay(this),this._analytics.trackVideoPlay(this,!1),this._analytics.trackSummaryEnd(this),this._hasSentPlayEvent=!1,this._elementWasClicked=2!==e,n.a.getOnPreviewClick().forEach(function(e){e(t.galleryData.domObject)})),this.videoNode&&this.videoNode.currentTime>.5){var i=this.getCountLoops(),o=i*this.config.duration+this.videoNode.currentTime;this.logger.info("EngagementTime: "+o+"\n            countLoops: "+i)}this._hasSentPlayEvent=!1,this.galleryData.vilynxData.embeddings&&this.storeEmbeddingsInLocalStorage(),this.doMouseLeave(!0)}},t.prototype.videoListeners=function(){var e=this,t=this.galleryData.domObject.querySelector(".vilynx_wrapperImg"),i=this.videoNode.querySelector("source"),o=this.videoNode;u.a.isMsie||(o=i),o.addEventListener("error",function(t){if(e.logger.error("Loading video node has produced an error"),e.videoData.isVertical)return e.logger.info("Vertical preview does not exist. Generating non vertical preview again"),e.config.verticalpreviews=!1,e.config.isVertical=!1,e.generateVideoUrl(),i.src=e.videoData.sources.mp4.url,i.type=e.videoData.sources.mp4.mime,e.config.noposterimage||(e.videoNode.poster=e.videoData.posterUrl),void e.videoNode.load();e.logger.error("Stopping Gallery execution."),t.error&&e.logger.info("Error code: "+t.error.toString()),e._deleted||e._msIeUtils.avoidIeFalseError||e.removeItem()}),0===this.config.duration&&this.videoNode.addEventListener("loadedmetadata",function(){e.videoNode&&(r.a.summaryplaytimeout>1e3*e.videoNode.duration&&(e._analytics.summaryPlayTimeOut=500,e._timeouts.trackSummaryPlayTimeout&&(clearTimeout(e._timeouts.trackSummaryPlayTimeout),e._timeouts.trackSummaryPlayTimeout=window.setTimeout(function(){!e.videoNode||e.videoNode.paused||e._hasSentPlayEvent||(e._analytics.trackSummaryPlay(e),e._hasSentPlayEvent=!0)},e._analytics.summaryPlayTimeOut))),u.a.isMsie&&(e._msIeUtils.avoidIeFalseError=!0),e.logger.info("Video metadata ready, duration is: "+e.videoNode.duration),e.config.duration=e.videoNode.duration,e.config.autoplay&&!e.config.redirectafter&&(e.config.redirectafter=1e3*e.videoNode.duration),e.config.videoRatio=e.videoNode.videoWidth/e.videoNode.videoHeight,e.config.videoRatio<1&&(e.logger.info("Video vertical found!"),e.config.isVertical=!0,e.setWrapperResize(),e.resizeVideoNode()),e.config.autoplay?e.watcher.isInViewport&&e.playAndCatch():e._mousedOver&&e.playVideo(t))}),this.videoNode.addEventListener("timeupdate",function(){if(e.videoNode){var i=1e3*e.videoNode.currentTime;i>10&&(i<100*e.config.duration?e.videoNode.throttle&&(e.videoNode.throttle=!1,e.videoNode.countLoops+=1,e.logger.info("Loop count: "+e.videoNode.countLoops),n.a.getOnPreviewLoop().forEach(function(t){t(e.galleryData.domObject,e.getCountLoops())})):e.videoNode.throttle=!0),e.config.autoplayonce&&e.config.fadeinadvance&&I.isNodeVilynxHidden(t)&&i+e.config.fadeinadvance>=1e3*e.videoNode.duration&&(e.logger.info("autoplayonce and fadeinadvance ("+e.config.fadeinadvance+"ms) set, hiding video node."),n.a.getOnPreviewEnd().forEach(function(t){t(e.galleryData.domObject)}),e.resetFallback()),e._redirect&&e._redirect.timeToRedirect&&!e._redirect.redirecting&&(e.videoNode.countLoops===e._redirect.loopToRedirect&&i>=e._redirect.timeToRedirect||e.videoNode.countLoops>e._redirect.loopToRedirect)&&(e.logger.info("Redirect after fired at "+1e3*e.videoNode.currentTime+"ms,\n                            Showing redirect wrapper"),e._redirect.timeToRedirect=null,e._onVideoEnd.forEach(function(e){e()}))}}),this.videoNode.addEventListener("ended",function(){if(e.videoNode.muted=e.config.audioonce||!e.config.audio,!e.config.autoplay){e.videoNode.currentTime=0;try{e.videoNode.play()}catch(t){e.logger.info("Play action failed.")}e.config.redirectafter||e.galleryData.domObject.classList.contains("vilynx_no-redirect")||(e.logger.info("Video Ended, calling onEnd function stack"),e._onVideoEnd.forEach(function(e){e()}))}})},t.prototype.videoErrorHandler=function(e){this.logger.error("Loading video node has produced an error. Stopping Gallery execution on this element."),this.logger.error(e),this._deleted||this.removeItem()},t.prototype.removeItem=function(){var e=this;this.logger.info("Removing Gallery Item..."),this.disableNow(),this._deleted=!0,[].forEach.call(Object.keys(this._observers),function(t){e._observers[t].disconnect()}),[].forEach.call(Object.keys(this._timeouts),function(t){clearTimeout(e._timeouts[t])}),this.galleryData.domObject.querySelector(".supra-wrapper")&&this.galleryData.domObject.querySelector(".supra-wrapper").classList.add("vilynx-hide"),this.dealloc()},t.prototype.ignoreElementListeners=function(e){var t,i,o=this;e.addEventListener("mouseenter",function(){t=o.galleryData.domObject.querySelector(".vilynx_wrapperImg"),o.config.autoplay||o.config.isDisabled||o.videoNode.paused&&o.playVideo(t)}),e.addEventListener("mouseleave",function(e){if(!o.config.autoplay&&!o.config.isDisabled){i=o.galleryData.domObject;var t=!1;[].forEach.call(o._elementsToIgnore,function(i){(e.relatedTarget===i||i.contains(e.relatedTarget))&&(t=!0)}),e.relatedTarget===i||i.contains(e.relatedTarget)||t||o.videoNode.paused||o.doMouseLeave(!1)}})},t.prototype.addConfigListener=function(){var e,t,i,o=this;e=u.a.isIe?this.galleryData.domObject.getAttribute("class"):this.galleryData.domObject.classList.value,this._oldClasses=e?e.split(" "):null,t=this.galleryData.domObject,i={attributeOldValue:!0,attributes:!0,characterData:!1,childList:!1,subtree:!1},this._observers.configListener=new MutationObserver(function(e){var t=o.extractClassChanges(),i=I.extractAttributeChanges(o.galleryData.domObject,e),r={additions:t.additions.concat(i.additions),removals:t.removals.concat(i.removals)};o.manageConfigChanges(r)}),this._observers.configListener.observe(t,i)},t.prototype.extractClassChanges=function(){var e,t,i;return t=(e=u.a.isIe?this.galleryData.domObject.getAttribute("class"):this.galleryData.domObject.classList.value)?e.split(" "):"",i=I.getArrayChanges(this._oldClasses,t),this._oldClasses=t,i},t.prototype.manageConfigChanges=function(e){(e.additions.length||e.removals.length)&&(this.logger.info("Configuration changed:\n                        Additions: "+e.additions+"\n                        Removals: "+e.removals),this.config.autoplay&&-1!==e.removals.indexOf("vilynx_autoplay")?(this.logger.info("vilynx_autoplay class removed: Disable autoplay"),this.disableAutoplay()):this.config.autoplay||-1===e.additions.indexOf("vilynx_autoplay")||(this.logger.info("vilynx_autoplay class added: Enable autoplay"),this.enableAutoplay()),this.config.autoplay&&(!this.config.autoplayonce||this.config.autoplayonce&&!this.isOneLoopAutoplayVideoFinished())&&(this.config.isDisabled&&-1!==e.removals.indexOf("vilynx_stop")?(this.logger.info("vilynx_stop class removed: Replaying video"),this.unStopVideo()):this.config.isDisabled||-1===e.additions.indexOf("vilynx_stop")||(this.logger.info("vilynx_stop class added: Stops video"),this.stopVideo())),this.config.audiohover&&-1!==e.removals.indexOf("vilynx_audiohover")?(this.logger.info("vilynx_audiohover class removed"),this.config.audiohover=!1):this.config.audiohover||-1===e.additions.indexOf("vilynx_audiohover")||(this.logger.info("vilynx_audiohover class added"),this.config.audiohover=!0),r.a.disableall?this.config.isDisabled?-1===e.additions.indexOf("vilynx_enabled")&&-1===e.additions.indexOf("teaser_enabled")||(this.logger.info("vilynx_enabled/teaser_enabled class added: Enable Gallery item"),this.enableNow()):-1===e.removals.indexOf("vilynx_enabled")&&-1===e.removals.indexOf("teaser_enabled")||(this.logger.info("vilynx_enabled/teaser_enabled class removed: Disable Gallery item"),this.disableNow()):this.config.isDisabled?-1!==e.removals.indexOf("vilynx_disabled")&&(this.logger.info("vilynx_disabled class removed: Enable Gallery item"),this.enableNow()):-1!==e.additions.indexOf("vilynx_disabled")&&(this.logger.info("vilynx_disabled class added: Disable Gallery item"),this.disableNow()))},t.prototype.enableNow=function(){var e=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");this.config.isDisabled=!1,this.watcher.isInViewport&&(r.a.downloadfrequency?(P.addElement(this),P.start()):this.autoplayOrAttachVideoNode()),this.config.autoplay&&I.hideNodes([e,this._externalFadeNode])},t.prototype.disableNow=function(){var e=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");this.config.isDisabled=!0,I.showNodes([e,this._externalFadeNode]),this.watcher.isInViewport&&this.doExitViewport()},t.prototype.stopVideo=function(){var e=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");this.config.isDisabled=!0,this.config.isStopped=!0,this.config.stopnoimage||I.showNodes([e,this._externalFadeNode]);try{this.videoNode.pause(),this._hasSentPlayEvent&&(this._analytics.trackSummaryEnd(this),this._hasSentPlayEvent=!1)}catch(e){this.logger.info("Pause action failed.")}},t.prototype.unStopVideo=function(){this.config.isDisabled=!1,this.config.isStopped=!1,this.setVideoAutoplay()},t.prototype.enableAutoplay=function(){if(this.config.autoplay=!0,this._redirect&&!this.config.redirectautoplay&&(this._wrapperNode.removeChild(this._redirect.redirectDom),this._redirect=null),this.watcher.isInViewport)this.setVideoAutoplay();else if(this._wrapperNode){this.generateVideoUrl(),this.videoNode=this.createVideoDom(),this._wrapperNode.appendChild(this.videoNode),this.resizeVideoNode(),this.videoListeners();var e=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");I.hideNodes([e,this._externalFadeNode])}},t.prototype.disableAutoplay=function(){var e=this;if(this.videoNode){var t=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");if(this.config.autoplay=!1,this.videoNode.loop=!1,this.watcher.isInViewport&&this.videoNode)try{this.videoNode.pause(),this._hasSentPlayEvent&&(this._hasSentPlayEvent=!1,this._analytics.trackSummaryEnd(this))}catch(e){this.logger.info("Pause action failed.")}if(this.resetFallback(),this.config.redirect&&(this._redirect=new Q(this,this._analytics),this._wrapperNode.appendChild(this._redirect.createRedirectDom()),this._onVideoEnd.push(this._redirect.checkAudioPolicy.bind(this._redirect)),this._onVideoCancel.push(this._redirect.hideRedirectWrapper.bind(this._redirect)),this._redirect.setRedirectFontSize(t)),r.a.divignore){var i=this.galleryData.domObject;if(r.a.divignorelevels)for(var o=0;o<parseInt(r.a.divignorelevels,10);o++)i=i.parentNode;this._elementsToIgnore=i.querySelectorAll(r.a.divignore),[].forEach.call(this._elementsToIgnore,function(t){e.ignoreElementListeners(t)})}}},t}(C),H=function(){function e(){}return e.prototype.sendRedirectEvent=function(e){var t=new CustomEvent("gallery_event",{detail:{hash:e}});dispatchEvent(t)},e}(),Q=function(){function e(e,t){this._gallery=e,this._domObject=e.galleryData.domObject,this._analytics=t,this._timeOuts=new S,this._eventsMessenger=new H}return e.prototype.dealloc=function(){this._gallery=void 0,this._analytics=void 0,this._timeOuts=void 0},e.prototype.createRedirectDom=function(){var e=document.createElement("div"),t=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),r=window.getComputedStyle(I.querySelectorInclusive(this._domObject,".vilynx_mainImg")),n=parseFloat(r.height.replace("px",""));return this.redirectDom=e,t.classList.add("redirectCenter"),e.classList.add("redirectWrapper"),this._gallery.config.hidectaicon&&e.classList.add("hideCtaIcon"),e.appendChild(t),i.classList.add("text"),u.a.isMobile?(e.classList.add("cta"),i.innerHTML=this._gallery.config.ctatext):i.innerHTML=this._gallery.config.redirecttext,o.id="counter",o.classList.add("counter"),o.innerHTML="3",t.appendChild(i),t.appendChild(o),t.style.height=n+"px",e},e.prototype.setHeight=function(e){this.redirectDom.querySelector(".redirectCenter").style.height=e+"px"},e.prototype.setRedirectFontSize=function(e){var t=window.getComputedStyle(e),i=parseFloat(t.width.replace("px","")),o=Math.floor(.09*i);if(o>40&&(o=40),this.redirectDom){var r=this.redirectDom.querySelector("#counter"),n=this.redirectDom.querySelector(".redirectCenter"),a=this.redirectDom.querySelector(".redirectCenter .text");n.style.fontSize=o+"px",r.style.fontSize=Math.floor(1.5*o)+"px",r.style.lineHeight=Math.floor(1.7*o)+"px",i<300?(a.style.maxWidth=i+"px",a.style.lineHeight="normal",r.style.maxWidth=i+"px",r.style.fontSize=Math.floor(1.2*o)+"px",r.style.lineHeight=Math.floor(1.5*o)+"px",r.style.marginBottom=Math.floor(1.2*o)+"px",a.style.marginBottom="0px"):(a.style.maxWidth="unset",a.style.marginBottom="10px",r.style.maxWidth="unset",r.style.marginBottom="unset")}},e.prototype.checkAudioPolicy=function(){N.a.doTestSound(this.doRedirectAction.bind(this,!0),this.doRedirectAction.bind(this,!1))},e.prototype.doRedirectAction=function(e){var t=this._gallery.config.redirecttext;e&&this._gallery.config.audiopolicycta?(t=this._gallery.config.ctatext,this.redirectDom.classList.add("cta")):this.redirectDom.classList.remove("cta"),this.redirectDom.querySelector(".redirectCenter .text").innerHTML=t,this.showRedirectWrapper(),e&&this._gallery.config.audiopolicycta||this.countdownTimeouts(e)},e.prototype.showRedirectWrapperCountDown=function(){this.redirectDom.querySelector(".redirectCenter .text").innerHTML=this._gallery.config.redirecttext,this.redirectDom.classList.remove("cta"),this.showRedirectWrapper(),this.countdownTimeouts()},e.prototype.showRedirectWrapper=function(){if(this._gallery.videoNode){var e=this._gallery.galleryData.domObject;if(this._timeOuts=new S,this._gallery.videoNode.duration<1)this._gallery.logger.error("Video shorter than 1 sec, avoiding redirect");else if(e.href||this._gallery.config.redirectwithclick||this._gallery.config.redirectwithvid){if(this._gallery.config.redirectwithvid)if(!1===new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(this._gallery.galleryData.extractedUrl))return void this._gallery.logger.error("vilynx-id is not a valid URL, abort redirect");this.redirectDom.style.visibility="visible",this.redirectDom.style.zIndex="99999999",this.redirectDom.style.opacity="1",this._timeOuts=new S,this.redirecting=!0}else this._gallery.logger.error("No parent anchor found, avoiding redirect")}},e.prototype.countdownTimeouts=function(e){var t=this,i=this.redirectDom.querySelector("#counter"),o=this._gallery.videoNode.duration,a=this._gallery.galleryData.domObject,s=3;o>3?(i.innerHTML="3",this._timeOuts.twoSec=window.setTimeout(function(){i.innerHTML="2"},1e3),this._timeOuts.oneSec=window.setTimeout(function(){i.innerHTML="1"},2e3)):o>2?(i.innerHTML="2",this._timeOuts.oneSec=window.setTimeout(function(){i.innerHTML="1"},1e3),s=2):o>1&&(i.innerHTML="1",s=1),this._timeOuts.zeroSecs=window.setTimeout(function(){if(c.a.isRedirecting=!0,t._analytics.trackVideoPlay(t._gallery,!0),t._gallery.analytics.trackSummaryEnd(t._gallery),t._gallery.hasSentPlayEvent=!1,t._gallery.config.redirectwithclick&&!a)t._gallery.logger.error("No parent anchor found, avoiding redirect with .click()");else if(t._gallery.config.redirectwithclick&&a){t._gallery.logger.debug("Cleaning redirect frame");var i=t._gallery.galleryData.domObject.querySelector(r.a.redirectwithclicktarget);n.a.getOnPreviewRedirect().forEach(function(i){i(t._gallery.galleryData.domObject,e)}),r.a.redirectwithclicktarget&&i?i.click():t._domObject.click(),c.a.isRedirecting=!1}else{t._eventsMessenger.sendRedirectEvent(t._gallery.galleryData.vilynxData.hash),t._gallery.logger.debug("Cleaning redirect frame"),t._gallery instanceof G&&t._gallery.doMouseLeave(!0),t._gallery.analytics.trackVideoPlay(t._gallery,!0);var o=t._domObject.href;t._gallery.config.redirectwithvid&&(o=t._gallery.galleryData.extractedUrl),n.a.getOnPreviewRedirect().forEach(function(i){i(t._gallery.galleryData.domObject,e)}),window.location.href=o}t.redirecting=!1},1e3*s)},e.prototype.hideRedirectWrapper=function(){var e=this,t=this.redirectDom;t.querySelector("#counter").innerHTML="3",t.style.opacity="",t.style.visibility="",t.style.zIndex="",this.redirecting=!1,Object.keys(this._timeOuts).length&&(Object.keys(this._timeOuts).forEach(function(t){e._gallery.logger.debug("Clearing timeout "+t),clearTimeout(e._timeOuts[t])}),this._timeOuts=new S)},e}(),K=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),$=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return K(t,e),t}(z),J=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),X=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return J(t,e),t}(R),Y=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),Z=function(e){function t(t){var i=e.call(this,t)||this;return i._oldClasses=[],i}return Y(t,e),t.prototype.init=function(){var e=this;if(this._nTry=0,this._observers=new $,this._timeouts=new X,this._analytics=new m,this.mouseClickListeners(),this.observeVilynxId(),this.findElementsToFade(),r.a.taptoplay&&this.config.autoplay?this.config.taptoplay=!1:!r.a.taptoplay&&this.config.taptoplay&&(this.config.autoplay=!1),r.a.optimizelyoff||r.a.passivetracking)this.monitorizeOneAutoplay(),this.logger.warn("Optimizely OFF variation");else if(r.a.ingnoreelementheight||0!==this.galleryData.domObject.clientHeight)if(I.querySelectorInclusive(this.galleryData.domObject,".vilynx_img")?this._imgSelectorQuery=".vilynx_img:not(.vilynx_wrapperImg)":this._imgSelectorQuery="img:not(.vilynx_wrapperImg)",r.a.allautoplay)if(u.a.isIos){var t,i,o=void 0,n=void 0;if((i=(t=this.galleryData.domObject.querySelectorAll("img:not(.vilynx_wrapperImg)"))[t.length-1])&&r.a.customimgsrc)o=i,this._oldImageUrl=i[r.a.customimgsrc];else if(i)o=i,this._oldImageUrl=i.src;else{var a=I.getImageCandidates(this.galleryData.domObject,this._imgSelectorQuery),s=void 0;if(!(s=I.findActiveImage(a)))return void this.logger.error("No valid image found");s.classList.add("vilynx_mainImg"),n=I.extractBGImageFromNode(s),this._oldImageUrl=n,o=s}r.a.directurl&&o.addEventListener("error",function(){e.logger.error("Gif url is not working. Removing gallery Item."),e.removeItem()}),this.generateGifUrl(),this.monitorizeGif()}else this.monitorizeMp4();else this.monitorizeOneAutoplay();else this.logger.warn("Element height is 0, Aborting!!!")},t.prototype.addConfigListener=function(){var e=this;this.galleryData.domObject.classList?this._oldClasses=this.galleryData.domObject.classList.value.split(" "):this._oldClasses=[];var t=this.galleryData.domObject;this._observers.configListener=new MutationObserver(function(t){var i=e.extractClassChanges(),o=I.extractAttributeChanges(e.galleryData.domObject,t),r={additions:i.additions.concat(o.additions),changes:o.changes,removals:i.removals.concat(o.removals)};e.manageConfigChanges(r)}),this._observers.configListener.observe(t,{attributeOldValue:!0,attributes:!0,characterData:!1,childList:!1,subtree:!1})},t.prototype.extractClassChanges=function(){var e=this.galleryData.domObject.classList.value.split(" "),t=I.getArrayChanges(this._oldClasses,e);return this._oldClasses=e,t},t.prototype.manageConfigChanges=function(e){if(this.config.isDisabled&&-1!==e.removals.indexOf("vilynx_stop")?(this.logger.info("vilynx_stop class removed: Replaying video"),this.enableNow()):this.config.isDisabled||-1===e.additions.indexOf("vilynx_stop")||(this.logger.info("vilynx_stop class added: Stops video"),this.disableNow()),r.a.disableall?this.config.isDisabled?-1===e.additions.indexOf("vilynx_enabled")&&-1===e.additions.indexOf("teaser_enabled")||(this.logger.info("vilynx_enabled/teaser_enabled class added: Enable Gallery item"),this.enableNow()):-1!==e.removals.indexOf("vilynx_enabled")&&-1!==e.removals.indexOf("teaser_enabled")&&(this.logger.info("vilynx_enabled/teaser_enabled class removed: Disable Gallery item"),this.disableNow()):this.config.isDisabled?-1!==e.removals.indexOf("vilynx_disabled")&&(this.logger.info("vilynx_disabled class removed: Enable Gallery item"),this.enableNow()):-1!==e.additions.indexOf("vilynx_disabled")&&(this.logger.info("vilynx_disabled class added: Disable Gallery item"),this.disableNow()),e.changes.playpriority){var t=parseInt(e.changes.playpriority.newValue,10);isNaN(t)?this.logger.error("vilynx-playpriority value has to be a number"):(this.config.playpriority=t,this.logger.info("playpriority attribute has changed, updating viewportqueue"),w.a.updatePriority(this,t))}this.galleryData.domObject.classList?this._oldClasses=this.galleryData.domObject.classList.value.split(" "):this._oldClasses=[]},t.prototype.enableNow=function(){this.config.isDisabled=!1,this.watcher.isThresholdInViewport&&(r.a.allautoplay?this.initOrReattachGallery(!0):(w.a.addToLoadedQueue(this,!1),w.a.addToViewportQueue(this,!1)))},t.prototype.disableNow=function(){var e=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");this.config.isDisabled=!0,this.showNodes([e]),w.a.removeFromViewportQueue(this),r.a.mobilepreload&&w.a.removeFromLoadedQueue(this)},t.prototype.monitorizeGif=function(){var e=this;(void 0===window.scrollMonitor||!window.scrollMonitor.version||window.scrollMonitor.version<b.version)&&b.reFactory(),this.watcher=window.scrollMonitor.create(this.galleryData.domObject),this.watcher.enterViewport(function(){e.config.isDisabled?e.logger.info("Element is disabled, ignore watcher event"):(e.logger.info("Entering Viewport"),setTimeout(function(){e.watcher.isInViewport&&(e.logger.info("User stops scrolling"),e.showGif())},1e3*e.config.previewdelay+300))}),this.watcher.exitViewport(function(){e.config.isDisabled?e.logger.info("Element is disabled, ignore watcher event"):(e.logger.info("Exiting Viewport"),e.hideGif())})},t.prototype.monitorizeMp4=function(){var e=this;(void 0===window.scrollMonitor||!window.scrollMonitor.version||window.scrollMonitor.version<b.version)&&b.reFactory(),this.watcher=window.scrollMonitor.create(this.galleryData.domObject),this.watcher.enterViewport(function(){e.config.isDisabled?e.logger.info("Element is disabled, ignore watcher event"):(e.logger.info("Entering Viewport"),e.initOrReattachGallery(!0))}),this.watcher.exitViewport(function(){e.config.isDisabled?e.logger.info("Element is disabled, ignore watcher event"):e._wrapperNode&&e.videoNode&&(e.logger.info("Exiting Viewport"),e.cleanVideoNode(!1))})},t.prototype.monitorizeOneAutoplay=function(){var e=this,t=!1,i=this.getFirstScrollableParent(this.galleryData.domObject),o=this.config.topviewportoffset,n=this.config.bottomviewportoffset;!r.a.pulltochange&&!r.a.followscroll||r.a.scrollListenerAdded||(r.a.scrollListenerAdded=!0,w.a.followScrollListener()),(void 0===window.scrollMonitor||!window.scrollMonitor.version||window.scrollMonitor.version<b.version)&&b.reFactory(),!i||"BODY"===i.tagName||i.clientWidth===document.body.clientHeight&&i.clientHeight===document.body.clientHeight?i=void 0:(o=parseInt(i.getAttribute("vilynx_topOffset"),10)||0,n=parseInt(i.getAttribute("vilynx_bottomOffset"),10)||0),this.watcher=window.scrollMonitor.create(this.galleryData.domObject,{bottom:n,top:o},i),r.a.mobilepreload&&!r.a.passivetracking&&(this.watcher.canPreload(function(){e.config.isDisabled||e.videoNode||0===e.galleryData.domObject.offsetHeight||w.a.addToLoadedQueue(e,!1)}),this.watcher.canUnload(function(){e.videoNode&&(e.logger.info("Element is far from viewport, remove it from loaded queue and clean videoNode"),w.a.removeFromLoadedQueue(e))}),this.watcher.enterViewport(function(){e.videoNode||e.config.isDisabled||w.a.addToLoadedQueue(e,!1)})),this.watcher.fullyEnterViewport(function(){if(e.watcher.isInViewport){if(e.config.isDisabled)return void e.logger.info("Element is disabled, ignore watcher event");r.a.passivetracking||(r.a.initmobilequeue&&(r.a.initmobilequeue=!1,t=!0),r.a.mobilepreload&&(e.videoNode||w.a.addToLoadedQueue(e,!1))),e.logger.info("Video added to viewportQueue"),w.a.addToViewportQueue(e,t)}}),this.watcher.partiallyExitViewport(function(){e.config.isDisabled?e.logger.info("Element is disabled, ignore watcher event"):(r.a.passivetracking||(e.config.taptoplay&&(e._tapedElementNotInQueue=!0),e.logger.info("Exiting Viewport")),c.a.scrollDirection=e.watcher.isAboveViewport,w.a.removeFromViewportQueue(e))}),this.watcher.thresholdEnterViewport(function(){e.config.isDisabled?e.logger.info("Element is disabled, ignore watcher event"):e.watcher.isFullyInViewport||(w.a.addToViewportQueue(e,t),e.logger.info("Video added to viewportQueue by thresholdEnterViewport cb()"))}),this.watcher.thresholdExitViewport(function(){e.config.isDisabled?e.logger.info("Element is disabled, ignore watcher event"):(e.logger.info("Exiting Viewport"),c.a.scrollDirection=e.watcher.isAboveViewport,w.a.removeFromViewportQueue(e))})},t.prototype.getFirstScrollableParent=function(e){for(var t=e,i=!1;"BODY"!==t.tagName&&!i;){t=t.parentElement;var o=window.getComputedStyle(t);i=-1!==o.overflowY.indexOf("auto")||-1!==o.overflowY.indexOf("scroll")}return t},t.prototype.initOrReattachGallery=function(e){var t=this.galleryData.domObject.classList.contains("vilynx_registered");if(this.watcher.top<0||0===this.watcher.bottom)this.logger.info("Element not really in viewport");else try{r.a.passivetracking?(this.analytics.trackSummaryPlay(this),this._hasSentPlayEvent=!0):t?t&&!this.videoNode&&(this.logger.info("reAttachVideoNode again"),this.reAttachVideoNode(e)):(this.logger.info("Entering viewport for first time"),this.initGallery(e),this._analytics.trackThumbnailShown(this))}catch(e){this.logger.error("Exception raised while processing the gallery attachVideoNode. Aborting item execution. Stack trace:",e)}},t.prototype.logMessage=function(e){this.logger.info(e)},t.prototype.initGallery=function(e){if(!this.generateVideoUrl())return w.a.removeFromViewportQueue(this),void this.logger.error("Video url couldn't be generated. Gallery item won't be registered");this.galleryData.domObject.classList.add("vilynx_registered"),this.videoNode=this.createVideoDom(),this._wrapperNode=this.createWrapperDom(),this._wrapperNode.appendChild(this.videoNode),this.animateResize(null),this.watcher.watchItem=this._wrapperNode,this.config.mobilecta&&(this._redirect=new Q(this,this._analytics),this._wrapperNode.appendChild(this._redirect.createRedirectDom()),this._onVideoEnd.push(),this._onVideoEnd.push(this._redirect.showRedirectWrapper.bind(this._redirect)),this._onVideoCancel.push(this._redirect.hideRedirectWrapper.bind(this._redirect))),I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg").classList.contains("vilynx_img")?this.observeBackgroundImage():this.observeOriginalImage(),this.resizeVideoNode(),e&&this.showVideoNode(),this.addConfigListener(),this.wrapperImageListeners(),this.videoListeners(),this.responsiveListeners()},t.prototype.findElementsToFade=function(){this._externalFadeNode=null,this.config.externalfading&&(this._externalFadeNode=document.querySelector('[data-vilynx-fadingid="'+this.galleryData.extractedUrl+'"], [vilynx-fadingid="'+this.galleryData.extractedUrl+'"]'),this._externalFadeNode||this.logger.warn("No node found on document with the attr\n                    [data-]vilynx-fadingid="+this.galleryData.extractedUrl))},t.prototype.observeBackgroundImage=function(){var e=this,t=I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg");this._observers.bgObserve=new MutationObserver(function(){if(""!==t.style.backgroundImage){var i=I.extractBGImageFromNode(t),o=e.galleryData.domObject.querySelector(".vilynx_wrapperImg").src;e.logger.info("Div with background now have url, proceed to assign src in wrapperImg"),i!==o&&(e.galleryData.domObject.querySelector(".vilynx_wrapperImg").src=i,e.resizeVideoNode())}}),this._observers.bgObserve.observe(t,{attributes:!0,characterData:!0})},t.prototype.observeOriginalImage=function(){var e=this,t=I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg");t.addEventListener("load",function(){var i=t.currentSrc||t.src;i!==e.galleryData.domObject.querySelector(".vilynx_wrapperImg").src&&(e.galleryData.domObject.querySelector(".vilynx_wrapperImg").src=i,e.resizeVideoNode())})},t.prototype.observeVilynxId=function(){var e=this,t=this.galleryData.domObject,i=["vilynx-id","data-vilynx-id"];this._observers.idObserve=new MutationObserver(function(t){t.forEach(function(t){try{var i=t.target.getAttribute(t.attributeName),o=t.oldValue;if(null!==i&&i!==o){var r=[e.galleryData.domObject];e.logger.info("New data-vilynx-id found, old id: "+o+", new id: "+i),ne.privateScan(null,r,e,null)}}catch(t){e.logger.error("Exception raised on vilynx-id attribute observation. Aborting item  mutation. Stack trace:",t)}})}),r.a.idattribute&&i.push(r.a.idattribute),this._observers.idObserve.observe(t,{attributeFilter:i,attributeOldValue:!0,attributes:!0})},t.prototype.refreshVideoNode=function(){this.generateVideoUrl(),this.logger.info("Refreshing video node"),this.videoNode?r.a.mobilepreload?(w.a.removeFromLoadedQueue(this),w.a.removeFromViewportQueue(this)):this.cleanVideoNode(!1):r.a.allautoplay&&u.a.isIphone&&(this.hideGif(),this.generateGifUrl()),this.watcher&&(r.a.mobilepreload&&this.watcher.isCanPreload&&w.a.addToLoadedQueue(this,!1),this.watcher.isInViewport&&(r.a.allautoplay?u.a.isIphone?this.showGif():this.initOrReattachGallery(!0):w.a.addToViewportQueue(this,!1)))},t.prototype.checkOtherElementszIndex=function(){var e=this,t=this.galleryData.domObject.getElementsByTagName("*");[].forEach.call(t,function(t){var i=window.getComputedStyle(t);1!==t.nodeType||"absolute"!==i.position&&"relative"!==i.position||t.classList.contains("vilynx_registered")||t.classList.contains("supra-wrapper")||t.classList.contains("vilynx_mainImg")||""!==i.zIndex&&"1"!==i.zIndex&&"auto"!==i.zIndex||0===t.querySelectorAll(".vilynx_mainImg").length&&(e.logger.info("Absolute positioned element found, setting zIndex: 2"),t.style.zIndex="2")})},t.prototype.createVideoDom=function(){var e=document.createElement("video"),t=document.createElement("source");return t.src=this.videoData.sources.mp4.url,t.type=this.videoData.sources.mp4.mime,e.appendChild(t),e.resolution=this.videoData.sources.mp4.resolution,e.setAttribute("playsinline","true"),e.muted=!0,this.config.previewdelay||r.a.mobilepreload||e.setAttribute("autoplay","true"),this.config.autoplayonce||e.setAttribute("loop","true"),e.countLoops=0,e.throttle=!1,e.style.visibility="hidden",e},t.prototype.showVideoNode=function(){var e=this;if(!I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg"))return w.a.removeFromViewportQueue(this),void this.logger.error("Invalid image trying to play. Abort!");this.logger.info("Showing video node");var t=function(){if(r.a.allautoplay||w.a.elementHasToken(e)){if(e.videoNode)if(!r.a.allautoplay||e.watcher.isThresholdInViewport){(e.config.previewdelay||r.a.mobilepreload)&&(e.videoNode.parentNode||(e.videoNode=e._wrapperNode.querySelector("video")),e._timeouts.restartTimeout?clearTimeout(e._timeouts.restartTimeout):e.doReset(),e.videoNode.play());var i=e.galleryData.domObject.querySelector(".vilynx_wrapperImg");e.videoNode.style.visibility="visible",e.logger.info("Canplay callback, adding vilynx_fading class"),e.hideNodes([i,e._externalFadeNode]),e.videoNode.removeEventListener("canplaythrough",t),e._timeouts.trackSummaryPlayTimeout&&clearTimeout(e._timeouts.trackSummaryPlayTimeout),e._timeouts.trackSummaryPlayTimeout=window.setTimeout(function(){e.logger.info("Analytics summary_play tracking"),e._hasSentPlayEvent||(e._analytics.trackSummaryPlay(e),e._hasSentPlayEvent=!0),e._timeouts.trackSummaryPlayTimeout=null},e._analytics.summaryPlayTimeOut),e.config.mobilecta&&e.config.redirectafter&&(e._timeouts.redirectafterTimeout=window.setTimeout(function(){e.logger.info("Showing redirectWrapper after "+e.config.redirectafter+" milliseconds"),e._onVideoEnd.forEach(function(e){e()})},e.config.redirectafter))}else e.stopVideoPlaying()}else e.logger.info("Element doesn't have the token. Abort showVideoNode")};this.videoNode?this.videoNode.readyState>3&&r.a.mobilepreload&&!this.config.previewdelay?t():this.config.previewdelay?(setTimeout(function(){e.videoNode&&(e.videoNode.readyState>3||u.a.isIos?t():e.videoNode.addEventListener("canplaythrough",t))},1e3*this.config.previewdelay),this.logger.info("Preview with 'previewdelay' config is going to play in "+this.config.previewdelay+"s")):(r.a.mobilepreload&&(0===this.videoNode.readyState?setTimeout(function(){e.videoNode&&w.a.elementHasToken(e)&&(e.logger.info("readyState 0 -> replaying"),e.videoNode.play())},500):setTimeout(function(){e.videoNode&&e.videoNode.play()},20)),this.videoNode.addEventListener("canplaythrough",t)):this.logger.warn("Video node seems to be undefined, aborting function execution")},t.prototype.resizeVideoNode=function(){var e,t,i,o,r;if(!this.config.isDisabled){try{this.videoNode.childNodes[0]}catch(e){return void this.logger.info("Cant resize video node. The video node seems to not be created")}var n=I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg");if(n){if(e=n.clientWidth,t=n.clientHeight,i=this.galleryData.domObject.querySelector(".vilynx_wrapperImg"),r="",0!==e&&0!==t){if(n.classList.contains("vilynx_img"))""!==n.style.backgroundImage&&(r=I.extractBGImageFromNode(n));else{if(n.naturalWidth<2&&!this.config.autoplay)return;r=n.currentSrc||n.src}r&&i.src!==r&&(i.src=r),this.animateResize(null),u.a.isWindowsMobile&&(e/(o=this.videoData.is169?16/9:4/3)<t?(this.videoNode.style.height=t+"px",this.videoNode.style.width=t*o+"px",this.videoNode.style.left=(e-t*o)/2+"px",this.videoNode.style.top="0"):(this.videoNode.style.height=e/o+"px",this.videoNode.style.width=e+"px",this.videoNode.style.left="0",this.videoNode.style.top=(t-e/o)/2+"px"))}}else this.logger.error("Cant resize video node. No valid image found")}},t.prototype.animateResize=function(e){var t,i=this.reassignTargetImage();if(!i)return this.logger.error("No valid image found"),void this.galleryData.domObject.querySelector(".supra-wrapper").classList.add("vilynx-hide");t=this.galleryData.domObject.querySelector(".vilynx_wrapperImg").getBoundingClientRect(),(!e||e.width!==t.width||e.height!==t.height)&&(e=I.getTargetImgSize(i),this.setWrapperResize(),window.requestAnimationFrame(this.animateResize.bind(this,e)))},t.prototype.setWrapperResize=function(){var e=this.reassignTargetImage();if(!e)return this.logger.error("No valid image found"),void this.galleryData.domObject.querySelector(".supra-wrapper").classList.add("vilynx-hide");this.setWrapperStyles();var t=I.getTargetImgSize(e);this._wrapperNode.style.width=t.width+"px",this._wrapperNode.style.height=t.height+"px",this._redirect&&(this._redirect.setHeight(t.height),this._redirect.setRedirectFontSize(e))},t.prototype.reassignTargetImage=function(){var e,t,i=this,o=I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg");if(!o){if(!(o=this.findMainImg()))return null;this.galleryData.domObject.querySelector(".vilynx_wrapperImg").src=o.src}if(e=o.clientWidth,t=o.clientHeight,0===e||0===t){this.logger.warn("vilynx_mainImg is too small '"+e+"x"+t+"' searching a new image");var r=I.getImageCandidates(this.galleryData.domObject,this._imgSelectorQuery),n=this.galleryData.domObject.querySelector(".vilynx_wrapperImg"),a=void 0;if(!(a=I.findActiveImage(r)))return this._nTry<5&&setTimeout(function(){i._nTry++,i.animateResize(null)},200),null;o.classList.remove("vilynx_mainImg"),a.classList.add("vilynx_mainImg"),n.src=a.src,o=a,this.imageListeners(o),this.logger.warn("Found new valid image updated vilynx_mainImg & src")}return o},t.prototype.setWrapperStyles=function(){if(this.galleryData.domObject.querySelector(".supra-wrapper").classList.contains("vilynx-hide")&&(this.logger.warn("Supra-wrapper was hidden but now is shown again"),this.galleryData.domObject.querySelector(".supra-wrapper").classList.remove("vilynx-hide")),!this.galleryData.domObject.classList.contains("vilynx_mainImg")){var e=I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg"),t=window.getComputedStyle(e);(t.cssFloat||t.cssFloat)&&(this._wrapperNode.style.cssFloat=t.cssFloat||t.cssFloat),t.margin?this._wrapperNode.style.margin=t.margin.replace(",","."):t.margin&&(this._wrapperNode.style.margin=t.margin.replace(",",".")),"none"===window.getComputedStyle(e.parentNode).maxHeight?this._wrapperNode.style.maxHeight="none":this._wrapperNode.style.maxHeight=window.getComputedStyle(e.parentNode).maxHeight}},t.prototype.createWrapperDom=function(){var e,t,i=I.getImageCandidates(this.galleryData.domObject,this._imgSelectorQuery),o=i[0];return o=I.findActiveImage(i)||o,e=document.createElement("div"),o.classList.add("vilynx_mainImg"),t=I.createCopyImage(this.findMainImg()),e.appendChild(t),this.galleryData.domObject.insertBefore(e,this.galleryData.domObject.childNodes[0]),e.classList.add("supra-wrapper"),this.checkOtherElementszIndex(),I.elementNeedsRelative(this.galleryData.domObject)&&(this.galleryData.domObject.style.position="relative"),e},t.prototype.findMainImg=function(){var e,t=I.getImageCandidates(this.galleryData.domObject,this._imgSelectorQuery);return(e=I.findActiveImage(t)||t[0])?(e.classList.add("vilynx_mainImg"),this.config.noimage&&e.classList.add("vilynx-hide"),this.imageListeners(e),e):null},t.prototype.responsiveListeners=function(){var e=this,t=I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg");window.addEventListener("resize",function(){e._deleted||e.requestPreviewResize()}),this.imageListeners(t),window.addEventListener("orientationchange",function(){e.requestPreviewResize()}),this._observers.imgRemovedObserver=new MutationObserver(function(){if(!(t=I.querySelectorInclusive(e.galleryData.domObject,".vilynx_mainImg"))){e.reassignTargetImage()&&e.requestPreviewResize()}}),this._observers.imgRemovedObserver.observe(t.parentNode,{childList:!0}),r.a.resizeonscroll&&window.addEventListener("scroll",function(){e._deleted||e.requestPreviewResize()})},t.prototype.imageListeners=function(e){var t=this;if(!this._observedImage||this._observedImage!==e){var i=new MutationObserver(function(){t.videoNode&&t.requestPreviewResize()});i.observe(e,{attributes:!0,characterData:!0}),this._observers.imageObserver&&this._observers.imageObserver.disconnect(),this._observers.imageObserver=i,this._observedImage=e,e.addEventListener("load",function(){t.logger.info("Image load event fired. Doing resize."),t.setWrapperResize()})}},t.prototype.requestPreviewResize=function(){var e=this;this._timeouts.resizeTimeout&&window.cancelAnimationFrame(this._timeouts.resizeTimeout),this._timeouts.resizeTimeout=window.requestAnimationFrame(function(){e.animateResize(null),e.resizeVideoNode()})},t.prototype.removeItem=function(){var e=this;this.logger.info("Removing Gallery Item..."),this.config.isDisabled=!0,this._deleted=!0,r.a.allautoplay&&u.a.isIphone?this.hideGif():(w.a.removeFromViewportQueue(this),r.a.mobilepreload&&w.a.removeFromLoadedQueue(this),this.galleryData.domObject.querySelector(".supra-wrapper")&&(this.galleryData.domObject.querySelector(".supra-wrapper").classList.add("vilynx-hide"),this.videoNode&&this._wrapperNode.removeChild(this.videoNode))),[].forEach.call(Object.keys(this._observers),function(t){e._observers[t].disconnect()}),[].forEach.call(Object.keys(this._timeouts),function(t){clearTimeout(e._timeouts[t])})},t.prototype.videoListeners=function(){var e=this,t=this.galleryData.domObject.querySelector(".vilynx_wrapperImg"),i=this.videoNode.querySelector("source");i.addEventListener("error",function(t){if(e.videoData.isVertical)return e.config.verticalpreviews=!1,e.generateVideoUrl(),i.src=e.videoData.sources.mp4.url,i.type=e.videoData.sources.mp4.mime,void e.videoNode.load();e.logger.error("Loading video node has produced an error. Stopping Gallery execution."),t.error&&e.logger.info("Error code: "+t.error.toString()),e._deleted||e.removeItem()}),0===this.config.duration&&this.videoNode.addEventListener("loadedmetadata",function(){e.videoNode&&(r.a.summaryplaytimeout>1e3*e.videoNode.duration&&(e._analytics.summaryPlayTimeOut=500,e._timeouts.trackSummaryPlayTimeout&&clearTimeout(e._timeouts.trackSummaryPlayTimeout)),e.logger.info("Video metadata ready, duration is: "+e.videoNode.duration),void 0!==e.videoNode.duration&&(e.config.duration=e.videoNode.duration)),e.watcher.isThresholdInViewport&&e.showVideoNode()}),this.videoNode.addEventListener("timeupdate",function(){if(e.videoNode){var i=1e3*e.videoNode.currentTime;i>10&&(i<100*e.config.duration?e.videoNode.throttle&&(e.videoNode.throttle=!1,e.videoNode.countLoops+=1,e.logger.info("Loop count: "+e.videoNode.countLoops),e.config.mobilecta&&!e.config.redirectafter&&e.videoNode.countLoops===e.config.mobilectaloopcount&&(e.logger.info("Showing redirectWrapper"),e._onVideoEnd.forEach(function(e){e()})),n.a.getOnPreviewLoop().forEach(function(t){t(e.galleryData.domObject,e.getCountLoops())})):e.videoNode.throttle=!0),e.config.autoplayonce&&e.config.fadeinadvance&&I.isNodeVilynxHidden(t)&&i+e.config.fadeinadvance>=1e3*e.videoNode.duration&&(e.logger.info("autoplayonce and fadeinadvance ("+e.config.fadeinadvance+"ms) set, hiding video node."),n.a.getOnPreviewEnd().forEach(function(t){t(e.galleryData.domObject)}),e._timeouts.restartTimeout=window.setTimeout(function(){e.logger.info("Transition end has not been fired. Doing video reset via timeout!"),e.doReset(),e._timeouts.restartTimeout=null},400),e.showNodes([t,e._externalFadeNode]),e.config.mobilecta&&!e.config.redirectafter&&(e.logger.info("Showing redirectWrapper"),e._onVideoEnd.forEach(function(e){e()})))}})},t.prototype.mouseClickListeners=function(){var e=this,t=this.galleryData.domObject;t.addEventListener("click",function(){if(e.config.isDisabled)e.logger.info("Element is disabled, ignore click event");else{if(r.a.passivetracking&&!e._hasSentPlayEvent&&(e._analytics.trackSummaryPlay(e),e._hasSentPlayEvent=!0),e._analytics.trackVideoPlay(e,!1),n.a.getOnPreviewClick().forEach(function(t){t(e.galleryData.domObject)}),r.a.passivetracking&&e._hasSentPlayEvent&&(e._analytics.trackSummaryEnd(e),e._hasSentPlayEvent=!1),e.videoNode&&e.videoNode.currentTime){var t=e.videoNode.currentTime;t=e.videoNode.countLoops*e.config.duration+t,e.logger.info("EngagementTime: "+t+", countLoops: "+e.videoNode.countLoops),e._hasSentPlayEvent&&(e._analytics.trackSummaryEnd(e),e._hasSentPlayEvent=!1)}e.galleryData.vilynxData.embeddings&&e.storeEmbeddingsInLocalStorage()}}),this.config.taptoplay&&(t.addEventListener("touchstart",function(){e.config.isDisabled?e.logger.info("Element is disabled, ignore tap event"):(e.logger.info("Tap to anchor. Showing video node"),e._tapedElementNotInQueue=!w.a.forceToken(e))}),t.addEventListener("touchmove",function(){e._tapedElementNotInQueue&&!e.config.isDisabled&&(e.logger.info("Element not in viewport yet"),e._tapedElementNotInQueue=!w.a.forceToken(e))}),t.addEventListener("touchend",function(){e._tapedElementNotInQueue=!1}))},t.prototype.wrapperImageListeners=function(){var e=this,t=this._wrapperNode.querySelector(".vilynx_wrapperImg");t.addEventListener("transitionend",function(){clearTimeout(e._timeouts.restartTimeout),t.classList.contains("vilynx_fading")||r.a.mobilepreload&&e.doReset()},!1)},t.prototype.doReset=function(){this.videoNode&&this.videoNode.readyState>0&&(this.videoNode.countLoops=0,this.videoNode.throttle=!1,this.config.autoplay&&this.config.autoplayonce?this.videoNode.pause():this.videoNode.currentTime>0&&(this.videoNode.currentTime=0))},t.prototype.stopOrCleanVideoNode=function(){!r.a.passivetracking&&r.a.mobilepreload?this.stopVideoPlaying():this.cleanVideoNode(!1),clearTimeout(this._timeouts.trackSummaryPlayTimeout)},t.prototype.stopVideoPlaying=function(){var e=this;if(r.a.passivetracking&&this._hasSentPlayEvent)return this._analytics.trackSummaryEnd(this),this._hasSentPlayEvent=!1,!0;if(this._wrapperNode&&this.videoNode&&!this.videoNode.paused){var t=this.galleryData.domObject.querySelector(".vilynx_wrapperImg"),i=this.videoNode.currentTime||0;this.logger.info("stop video playing (but the element "+this.logger.debugId+" still loaded)"),this.logger.info("Removing class vilynx_fading"),this.showNodes([t,this._externalFadeNode]),this.videoNode.pause(),this._hasSentPlayEvent&&(this._analytics.trackSummaryEnd(this),this._hasSentPlayEvent=!1),i=this.videoNode.countLoops*this.config.duration+i,this.logger.info("Mobile engagementTime: "+i+", countLoops: "+this.videoNode.countLoops),r.a.mobilepreload&&(clearTimeout(this._timeouts.restartTimeout),this._timeouts.restartTimeout=window.setTimeout(function(){e.doReset(),e._timeouts.restartTimeout=null},400))}r.a.mobilepreload&&this.config.mobilecta&&this._onVideoCancel.forEach(function(e){e()})},t.prototype.cleanVideoNode=function(e){var t=this,i=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");this.stopVideoPlaying(),clearTimeout(this._timeouts.redirectafterTimeout),this._timeouts.cleanVideonodeTimeput||(this._onVideoCancel.forEach(function(e){e()}),this._timeouts.cleanVideonodeTimeput=window.setTimeout(function(){t.logger.info("cleaning video node"),t.videoNode&&t._wrapperNode&&(t.videoNode.pause(),t._wrapperNode.removeChild(t.videoNode)),t.videoNode=null,t.config.mobilecta&&t._onVideoCancel.forEach(function(e){e()}),i&&t.showNodes([i]),e?w.a.playNextWithToken(c.a.scrollDirection):t.watcher.isThresholdInViewport||w.a.removeFromViewportQueue(t),t._timeouts.cleanVideonodeTimeput=void 0},200))},t.prototype.hideNodes=function(e){this.galleryData.domObject.classList.add("vilynx_activeSummary"),I.hideNodes(e)},t.prototype.showNodes=function(e){this.galleryData.domObject.classList.remove("vilynx_activeSummary"),I.showNodes(e)},t.prototype.reAttachVideoNode=function(e){this.generateVideoUrl(),this.videoNode=this.createVideoDom(),void 0===this._wrapperNode&&(this._wrapperNode=this.galleryData.domObject.querySelector(".supra-wrapper")),this._wrapperNode.appendChild(this.videoNode),this.resizeVideoNode(),e&&this.showVideoNode(),this.videoListeners(),this.responsiveListeners()},t.prototype.showGif=function(){var e,t=this.galleryData.domObject.querySelectorAll("img:not(.vilynx_wrapperImg)");if(t)if(e=t[t.length-1])this._oldImageUrl=e.src,r.a.customimgsrc&&e[r.a.customimgsrc]?(this._oldImageUrl=e.src,e[r.a.customimgsrc]=this._gifUrl):e.src=this._gifUrl;else{var i=I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg");this._oldImageUrl=I.extractBGImageFromNode(i),i.style.backgroundImage='url("'+this._gifUrl+'")'}else this.logger.error("No valid image found, gif cannot be shown")},t.prototype.hideGif=function(){var e,t=this.galleryData.domObject.querySelectorAll("img:not(.vilynx_wrapperImg)");if(t)if((e=t[t.length-1])&&r.a.customimgsrc&&e[r.a.customimgsrc])e[r.a.customimgsrc]=this._oldImageUrl;else if(e)e.src=this._oldImageUrl;else{I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg").style.backgroundImage='url("'+this._oldImageUrl+'")'}else this.logger.error("No valid image found, gif cannot be hidden")},t.prototype.generateGifUrl=function(){var e,t=c.a.serverUrl.slice(4),i="";e=r.a.directurl?"direct/"+r.a.publickey+"/"+this.galleryData.vilynxData.externalId:this.galleryData.vilynxData.hash,i=r.a.smallgif?"//public."+t+"/"+e+"/pro69.viwindow_xs.gif":"//public."+t+"/"+e+"/pro69.viwindow.gif",i+="?owner="+r.a.publickey,this._gifUrl=i},t}(C),ee=function(){return function(){}}(),te=function(){return function(){}}(),ie=new(function(){function e(){}return e.prototype.setCurrentItem=function(e){this.currentGalleryItem?(this._moveVideoNode(this.currentGalleryItem,e),this.currentGalleryItem=e):(this._videoDom=this._createVideoDom(e),this.currentGalleryItem=e,this.currentGalleryItem.wrapperNode.appendChild(this._videoDom),this.currentGalleryItem.videoNode=this._videoDom,this.currentGalleryItem.videoListeners())},e.prototype._moveVideoNode=function(e,t){t.wrapperNode.appendChild(this._videoDom),e.removeVideoListeners(),e.videoNode=null,t.videoNode=this._videoDom,t.videoListeners(),this._videoDom.pause(),this._videoDom.setAttribute("src",t.videoData.sources._mp4.url),this._videoDom.load()},e.prototype._createVideoDom=function(e){var t=document.createElement("video"),i=document.createElement("source");return i.src=e.videoData.sources.mp4.url,i.type=e.videoData.sources.mp4.mime,t.appendChild(i),t.poster=e.videoData.posterUrl,t.resolution=e.videoData.sources.mp4.resolution,t.preload="none",t.muted=!e.config.audio,t.countLoops=0,t.throttle=!1,t},e}()),oe=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),re=function(e){function t(t){var i=e.call(this,t)||this;return i._videoListeners={},i}return oe(t,e),t.prototype.init=function(){this._observers=new F,this._timeouts=new U,this._videoListeners.loadedMetadata=this.onLoadedMetadata.bind(this),this._videoListeners.timeUpdate=this.onTimeUpdate.bind(this),this._videoListeners.error=this.onError.bind(this),this._analytics=new m,I.querySelectorInclusive(this.galleryData.domObject,".vilynx_img")?this._imgSelectorQuery=".vilynx_img":this._imgSelectorQuery="img:not(.vilynx_wrapperImg)",this._onVideoEnd=[],this._onVideoCancel=[],this._wrapperNode=null,this.observeVilynxId(),r.a.optimizely&&r.a.optimizelyoff||r.a.passivetracking||this.monitorizeDesktop()},t.prototype.monitorizeDesktop=function(){var e=this;this._externalFadeNode=null,this.config.externalfading&&(this._externalFadeNode=document.querySelector('[data-vilynx-fadingid="'+this.galleryData.extractedUrl+'"], [vilynx-fadingid="'+this.galleryData.extractedUrl+'"]'),this._externalFadeNode||this.logger.warn("No node found on document with the attr [data-]vilynx-fadingid="+this.galleryData.extractedUrl));var t=200;r.a.aggressivelazy&&(t=1e3),(void 0===window.scrollMonitor||!window.scrollMonitor.version||window.scrollMonitor.version<b.version)&&b.reFactory(),this.watcher=window.scrollMonitor.create(this.galleryData.domObject,t),this.watcher.enterViewport(function(){e.config.isDisabled||e.attachVideoNode()}),this.watcher.exitViewport(function(){e.config.isDisabled||(clearTimeout(e._timeouts.waitToLoadTimeout),e._wrapperNode&&e.videoNode&&(e.logger.info("Exiting Viewport"),e.doExitViewport()))})},t.prototype.attachVideoNode=function(){try{var e=this.galleryData.domObject.classList.contains("vilynx_registered");if(this.config.isDisabled)return void this.logger.warn("This element is disabled. Ignore enterViewport event");e?!e||this.videoNode&&!this.videoNode.paused||(this.logger.info("autoplayOrAttachVideoNode again"),this.autoplayOrAttachVideoNode()):(this.logger.info("Entering viewport for first time"),this.initGallery(),this._analytics.trackThumbnailShown(this))}catch(e){this.logger.error("Exception raised while processing the gallery attachVideoNode. Aborting item execution. Stack trace:"),this.logger.error(e)}},t.prototype.initGallery=function(){if(this.galleryData.domObject.classList.add("vilynx_registered"),this._elementsToIgnore=[],r.a.divignore&&!this.config.autoplay){var e=this.galleryData.domObject;if(r.a.divignorelevels)for(var t=0;t<parseInt(r.a.divignorelevels,10);t++)e=e.parentNode;this._elementsToIgnore=e.querySelectorAll(r.a.divignore)}this.generateVideoUrl(),this._wrapperNode=this.createWrapperDom(),this.setWrapperResize(),this.setWrapperResize(),I.elementNeedsRelative(this.galleryData.domObject)&&(this.galleryData.domObject.style.position="relative"),this.config.autoplay&&this.logger.warn("VIZO platform only allows one video a a time, All autoplay is impossible"),this.wrapperImageListeners(),!this.config.redirect||this.config.autoplay&&!this.config.redirectautoplay||(this._redirect=new Q(this,this._analytics),this._wrapperNode.appendChild(this._redirect.createRedirectDom()),this.config.redirectwithclick&&this.config.audiopolicycta?this._onVideoEnd.push(this._redirect.checkAudioPolicy.bind(this._redirect)):this._onVideoEnd.push(this._redirect.showRedirectWrapperCountDown.bind(this._redirect)),this._onVideoCancel.push(this._redirect.hideRedirectWrapper.bind(this._redirect))),I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg").classList.contains("vilynx_img")?this.observeBackgroundImage():this.observeOriginalImage(),this.addConfigListener(),this.resizeVideoNode(),this.responsiveListeners()},t.prototype.doExitViewport=function(){var e=this;if(this.config.autoplay&&!this.config.isDisabled)try{this.videoNode.readyState>0?this.videoNode.pause():setTimeout(function(){e.logger.info("Video ready state is 0. Pause can't be done. Retrying 10ms later"),e.videoNode.pause()},10)}catch(e){this.logger.info("Pause action failed.")}else this.config.isStopped||this.cleanVideoNode()},t.prototype.cleanVideoNode=function(){this._wrapperNode&&this.videoNode&&this.videoNode.parentElement===this._wrapperNode&&(this._wrapperNode.removeChild(this.videoNode),this.videoNode=null)},t.prototype.autoplayOrAttachVideoNode=function(){var e=this;if(this.config.autoplay)try{this.videoNode.play().catch(function(t){e.logger.warn("Play action failed."),e.logger.warn(t)})}catch(e){this.watcher.destroy(),this.logger.warn("This element had a huge issue trying to do the play. Destroying watcher listeners ")}},t.prototype.resizeVideoNode=function(){if(!this.config.isDisabled){try{this.videoNode.childNodes[0]}catch(e){return void this.logger.info("Cant resize video node. The video node seems to not be created")}var e=I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg");if(e){var t,i=e.clientWidth,o=e.clientHeight,r=this.galleryData.domObject.querySelector(".vilynx_wrapperImg"),n="";0!==i&&0!==o&&(e.classList.contains("vilynx_img")?""!==e.style.backgroundImage&&(n=I.extractBGImageFromNode(e)):n=e.currentSrc||e.src,n&&r.src!==n&&(r.src=n),this.setWrapperResize(),i/(t=this.videoData.is169&&!1===this.config.isVertical?16/9:4/3)<o&&!1===this.config.isVertical?(this.videoNode.style.height=o+"px",this.videoNode.style.width=o*t+"px",this.videoNode.style.left=(i-o*t)/2+"px",this.videoNode.style.top="0"):(this.videoNode.style.height=i/t+"px",this.videoNode.style.width=i+"px",this.videoNode.style.left="0",this.videoNode.style.top=(o-i/t)/2+"px",this.config.isVertical&&this.config.videoRatio&&(this.videoNode.style.height=i/this.config.videoRatio+"px",this.videoNode.style.top=Math.round((o-i/this.config.videoRatio)/2)+"px")),this._redirect&&this._redirect.setRedirectFontSize(e))}else this.logger.error("Cant resize video node. No valid image found")}},t.prototype.createWrapperDom=function(){var e,t;return e=document.createElement("div"),t=I.createCopyImage(this.findMainImg()),e.appendChild(t),this.galleryData.domObject.insertBefore(e,this.galleryData.domObject.childNodes[0]),e.classList.add("supra-wrapper"),this.checkOtherElementszIndex(),e},t.prototype.refreshVideoNode=function(){this.enableNow(),this.videoNode&&this.cleanVideoNode(),this.autoplayOrAttachVideoNode()},t.prototype.playVideo=function(e){var t=this;e.parentElement.classList&&e.parentElement.classList.contains("vilynx-hide")&&this.setWrapperResize(),this.resizeVideoNode(),this.videoNode.muted=!this.config.audio,I.hideNodes([e,this._externalFadeNode]),clearTimeout(this._timeouts.restartTimeout),this.logger.info("Video play");try{var i=this.videoNode.play();i&&i.catch(function(i){t.logger.info("An error has been captured while playing video. "+i.name+": "+i.message),t.config.audio&&t.videoNode&&0===i.code&&(t.config.audio=!1,t.playVideo(e))})}catch(e){this.logger.info("Play action failed.")}n.a.getOnPlay().forEach(function(e){e()})},t.prototype.setVideoAutoplay=function(){var e=this;ie.setCurrentItem(this),this.videoNode&&(this.resizeVideoNode(),this.videoNode.loop=!this.config.autoplayonce,this.config.redirectautoplay&&this.videoNode.duration&&!this.config.redirectafter&&(this.config.redirectafter=1e3*this.videoNode.duration),this.videoNode.muted=!0,0===this.videoNode.readyState?setTimeout(function(){e.config.autoplay&&e.doPlay()},50):this.doPlay(),this.logger.info("Autoplay video starts to play"))},t.prototype.responsiveListeners=function(){var e=this,t=I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg");window.addEventListener("resize",function(){e._deleted||e.requestPreviewResize()}),this.imageListeners(t),this._observers.imgRemovedObserver=new MutationObserver(function(){if(!(t=I.querySelectorInclusive(e.galleryData.domObject,".vilynx_mainImg"))){e.reassignTargetImage()&&(e.setWrapperResize(),e.resizeVideoNode())}}),this._observers.imgRemovedObserver.observe(t.parentNode,{childList:!0}),this._observers.supraWrapperRemoved=new MutationObserver(function(){e.galleryData.domObject&&e.galleryData.domObject.querySelector(".supra-wrapper")||(e.logger.error("Supra-wrapper has been removed. Removing Gallery Item"),e.removeItem())}),this._observers.supraWrapperRemoved.observe(this.galleryData.domObject,{childList:!0}),r.a.resizeonscroll&&window.addEventListener("scroll",function(){e._deleted||e.requestPreviewResize()})},t.prototype.setWrapperStyles=function(){if(this.galleryData.domObject.querySelector(".supra-wrapper")&&(this.galleryData.domObject.querySelector(".supra-wrapper").classList.contains("vilynx-hide")&&(this.logger.warn("Supra-wrapper was hidden but now is shown again"),this.galleryData.domObject.querySelector(".supra-wrapper").classList.remove("vilynx-hide"),this.config.autoplay&&this.setVideoAutoplay()),!this.galleryData.domObject.classList.contains("vilynx_mainImg"))){var e=I.querySelectorInclusive(this.galleryData.domObject,".vilynx_mainImg"),t=window.getComputedStyle(e);t.cssFloat&&(this._wrapperNode.style.cssFloat=t.cssFloat),t.marginLeft||t.marginRight||t.marginTop||t.marginBottom?(this._wrapperNode.style.marginLeft=t.marginLeft,this._wrapperNode.style.marginRight=t.marginRight,this._wrapperNode.style.marginTop=t.marginTop,this._wrapperNode.style.marginBottom=t.marginBottom):t.margin&&(this._wrapperNode.style.margin=t.margin.replace(",",".")),this._wrapperNode.style.maxHeight=window.getComputedStyle(e.parentElement).maxHeight}},t.prototype.mouseClickListeners=function(){},t.prototype.onMouseClick=function(e){},t.prototype.onError=function(){if(this.logger.error("An error has been produced loading the video element."),this.videoData.isVertical){var e=this.videoNode.childNodes[0];return this.logger.info("Vertical preview does not exist. Generating non vertical preview again"),this.config.verticalpreviews=!1,this.generateVideoUrl(),e.src=this.videoData.sources.mp4.url,e.type=this.videoData.sources.mp4.mime,this.videoNode.load(),void this.playAndCatch()}},t.prototype.onLoadedMetadata=function(){this.videoNode&&(r.a.summaryplaytimeout>1e3*this.videoNode.duration&&(this._analytics.summaryPlayTimeOut=500),this.logger.info("Video metadata ready, duration is: "+this.videoNode.duration),this.config.duration=this.videoNode.duration,this.config.autoplay&&!this.config.redirectafter&&(this.config.redirectafter=1e3*this.videoNode.duration),this.config.videoRatio=this.videoNode.videoWidth/this.videoNode.videoHeight,this.config.videoRatio<1&&(this.logger.info("Video vertical found!"),this.config.isVertical=!0,this.setWrapperResize(),this.resizeVideoNode()))},t.prototype.onTimeUpdate=function(){var e=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");if(this.videoNode){var t=1e3*this.videoNode.currentTime;t>10&&(t<100*this.config.duration?this.videoNode.throttle&&(this.videoNode.throttle=!1,this.videoNode.countLoops+=1,this.logger.info("Loop count: "+this.videoNode.countLoops)):this.videoNode.throttle=!0),this.config.autoplayonce&&this.config.fadeinadvance&&I.isNodeVilynxHidden(e)&&t+this.config.fadeinadvance>=1e3*this.videoNode.duration&&(this.logger.info("autoplayonce and fadeinadvance ("+this.config.fadeinadvance+"ms) set, hiding video node."),I.showNodes([e,this._externalFadeNode])),this._redirect&&this._redirect.timeToRedirect&&!this._redirect.redirecting&&(this.videoNode.countLoops===this._redirect.loopToRedirect&&t>=this._redirect.timeToRedirect||this.videoNode.countLoops>this._redirect.loopToRedirect)&&(this.logger.info("Redirect after fired at "+1e3*this.videoNode.currentTime+"ms,\n                            Showing redirect wrapper"),this._redirect.timeToRedirect=null,this._onVideoEnd.forEach(function(e){e()}))}},t.prototype.videoListeners=function(){this.videoNode&&(0===this.config.duration&&this.videoNode.addEventListener("loadedmetadata",this._videoListeners.loadedMetadata),this.videoNode.addEventListener("error",this._videoListeners.error),this.videoNode.addEventListener("timeupdate",this._videoListeners.timeUpdate))},t.prototype.removeVideoListeners=function(){this.videoNode&&(this.videoNode.removeEventListener("error",this._videoListeners.error),this.videoNode.removeEventListener("loadedmetadata",this._videoListeners.loadedMetadata),this.videoNode.removeEventListener("timeupdate",this._videoListeners.timeUpdate))},t.prototype.ignoreElementListeners=function(e){},t.prototype.addConfigListener=function(){var e,t,i,o=this;e=this.galleryData.domObject.classList.value,this._oldClasses=e?e.split(" "):null,t=this.galleryData.domObject,i={attributeOldValue:!0,attributes:!0,characterData:!1,childList:!1,subtree:!1},this._observers.configListener=new MutationObserver(function(e){var t=o.extractClassChanges(),i=I.extractAttributeChanges(o.galleryData.domObject,e),r={additions:t.additions.concat(i.additions),removals:t.removals.concat(i.removals)};o.manageConfigChanges(r)}),this._observers.configListener.observe(t,i)},t.prototype.extractClassChanges=function(){var e,t,i;return t=(e=this.galleryData.domObject.classList.value)?e.split(" "):"",i=I.getArrayChanges(this._oldClasses,t),this._oldClasses=t,i},t.prototype.manageConfigChanges=function(e){(e.additions.length||e.removals.length)&&(this.logger.info("Configuration changed:\n                        Additions: "+e.additions+"\n                        Removals: "+e.removals),this.config.autoplay&&-1!==e.removals.indexOf("vilynx_autoplay")?(this.logger.info("vilynx_autoplay class removed: Disable autoplay"),this.disableAutoplay()):this.config.autoplay||-1===e.additions.indexOf("vilynx_autoplay")||(this.logger.info("vilynx_autoplay class added: Enable autoplay"),this.enableAutoplay()),this.config.autoplay&&(!this.config.autoplayonce||this.config.autoplayonce&&!this.isOneLoopAutoplayVideoFinished())&&(this.config.isDisabled&&-1!==e.removals.indexOf("vilynx_stop")?(this.logger.info("vilynx_stop class removed: Replaying video"),this.unStopVideo()):this.config.isDisabled||-1===e.additions.indexOf("vilynx_stop")||(this.logger.info("vilynx_stop class added: Stops video"),this.stopVideo())),this.config.audiohover&&-1!==e.removals.indexOf("vilynx_audiohover")?(this.logger.info("vilynx_audiohover class removed"),this.config.audiohover=!1):this.config.audiohover||-1===e.additions.indexOf("vilynx_audiohover")||(this.logger.info("vilynx_audiohover class added"),this.config.audiohover=!0),r.a.disableall?this.config.isDisabled?-1===e.additions.indexOf("vilynx_enabled")&&-1===e.additions.indexOf("teaser_enabled")||(this.logger.info("vilynx_enabled/teaser_enabled class added: Enable Gallery item"),this.enableNow()):-1===e.removals.indexOf("vilynx_enabled")&&-1===e.removals.indexOf("teaser_enabled")||(this.logger.info("vilynx_enabled/teaser_enabled class removed: Disable Gallery item"),this.disableNow()):this.config.isDisabled?-1!==e.removals.indexOf("vilynx_disabled")&&(this.logger.info("vilynx_disabled class removed: Enable Gallery item"),this.enableNow()):-1!==e.additions.indexOf("vilynx_disabled")&&(this.logger.info("vilynx_disabled class added: Disable Gallery item"),this.disableNow()))},t.prototype.enableNow=function(){var e=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");this.config.isDisabled=!1,this.watcher.isInViewport&&this.autoplayOrAttachVideoNode(),this.config.autoplay&&I.hideNodes([e,this._externalFadeNode])},t.prototype.enableAutoplay=function(){if(this.config.autoplay=!0,this._redirect&&!this.config.redirectautoplay&&(this._wrapperNode.removeChild(this._redirect.redirectDom),this._redirect=null),this.watcher.isInViewport)this.setVideoAutoplay();else if(this._wrapperNode){this.generateVideoUrl(),ie.setCurrentItem(this),this.resizeVideoNode();var e=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");I.hideNodes([e,this._externalFadeNode])}},t.prototype.disableAutoplay=function(){var e=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");if(this.config.autoplay=!1,I.showNodes([e,this._externalFadeNode]),this.config.redirect&&(this._redirect=new Q(this,this._analytics),this._wrapperNode.appendChild(this._redirect.createRedirectDom()),this.config.redirectwithclick&&this.config.audiopolicycta?this._onVideoEnd.push(this._redirect.checkAudioPolicy.bind(this._redirect)):this._onVideoEnd.push(this._redirect.showRedirectWrapperCountDown.bind(this._redirect)),this._onVideoCancel.push(this._redirect.hideRedirectWrapper.bind(this._redirect)),this._redirect.setRedirectFontSize(e)),r.a.divignore){var t=this.galleryData.domObject;if(r.a.divignorelevels)for(var i=0;i<parseInt(r.a.divignorelevels,10);i++)t=t.parentNode;this._elementsToIgnore=t.querySelectorAll(r.a.divignore)}},Object.defineProperty(t.prototype,"wrapperNode",{get:function(){return this._wrapperNode},set:function(e){this._wrapperNode=e},enumerable:!0,configurable:!0}),t}(G),ne=new(function(){function e(){this._browser=u.a,this._logger=new s.a("[vlx_dbg]"),this._domElementsArray=[],this._preparedDomElementsArray=[],this._finderTimeout=!0,this._mixPanel=!1}return e.prototype.softScan=function(e){var t=this,i=[];[].forEach.call(e,function(e){var o=[];e&&e.tagName?e.classList.contains("vilynx_registered")||e.classList.contains("supra-wrapper")?t._logger.warn("This new node is a gallery registered element (target have class vilynx_registered, supra-wrapper): "+e):e.classList.contains("vilynx_disabled")||e.classList.contains("vilynxignore")||e.closest(".vilynxignore")?t._logger.warn("This new node is a disabled element hasclass vilynx_disabled OR vilynxignore): "+e):(e.matches(t._selectorQuery)&&o.push(e),o=o.concat([].slice.call(e.querySelectorAll(t._selectorQuery))),[].forEach.call(o,function(e){var t=d.findElementWithBg(e),o=[].slice.call(e.querySelectorAll("img"));!e.closest(".vilynxignore")&&(o&&o.some(function(e){return!e.matches(r.a.imgignore)})||t)&&i.push(e)})):t._logger.warn("This new node is not a valid element (tag have not a name): "+e)}),e=[],0!==i.length&&(this._logger.info("New soft scan invoked"),this._logger.info(i),this.privateScan(null,i,null,null))},e.prototype.privateScan=function(e,t,i,o){var n,a=this;if(o&&(this._selectorQuery=o),e?(this._logger.info('Starting Scan with query: "'+this._selectorQuery+'" over the element '+e.nodeName),n=e.querySelectorAll(this._selectorQuery),[].forEach.call(n,function(e){var t=d.findElementWithBg(e),i=[].slice.call(e.querySelectorAll("img")),o=new te;e.closest(".vilynxignore")||!(i&&i.some(function(e){return!e.matches(r.a.imgignore)})||t)||a._domElementsArray.some(function(t){return t.domObject===e})||(o.domObject=e,r.a.directurl&&(o.vilynxData=new ee,o.vilynxData.externalId=d.exctractIdAttribute(e)),a._domElementsArray.push(o))})):t&&(this._logger.info("Pushing "+t.length+" elements to the extractor"),[].forEach.call(t,function(e){var t=new te;t.domObject=e,t.galleryItem=i,r.a.directurl&&(t.vilynxData=new ee,t.vilynxData.externalId=d.exctractIdAttribute(e)),a._domElementsArray.some(function(e){return e.domObject===t.domObject})||a._domElementsArray.push(t)})),this._logger.info("----- SCAN RESULT ------"),this._logger.info("Found "+this._domElementsArray.length+" elements"),this._logger.info("/----- SCAN RESULT ------/"),0!==this._domElementsArray.length)if(r.a.directurl)for(var s=this._domElementsArray.length-1;s>=0;s--)this.createGalleryItem(this._domElementsArray[s]),this._domElementsArray.splice(s,1);else this._finderTimeout&&(this._finderTimeout=!1,this.getHashesDebounce())},e.prototype.getHashesDebounce=function(){var e=this,t=setTimeout(function(){e.prepareGetHashes(),e._finderTimeout=!0,clearTimeout(t)},250)},e.prototype.prepareGetHashes=function(){var e=this;this.extractor(),0===this._preparedDomElementsArray.length?this._logger.info("All valid domElements were removed by extractor. Prevent call to get_hashes"):(this._logger.info("Call to get_hashes with "+this._preparedDomElementsArray.length+" elements"),this.getHashes(function(t){var i=e._parseApiResponse(t);e._preparedDomElementsArray.forEach(function(e){i.forEach(function(t){t.url!==e.extractedUrl&&t.url.slice(0,-1)!==e.extractedUrl&&t.url!==e.extractedUrl.slice(0,-1)||(e.vilynxData=t)})});for(var o=e._preparedDomElementsArray.length-1;o>=0;o--){var r=e._preparedDomElementsArray[o];r.vilynxData&&e.createGalleryItem(r),e._preparedDomElementsArray.splice(o,1)}},0))},e.prototype.createGalleryItem=function(e){if(e.galleryItem)e.galleryItem.galleryData.vilynxData=e.vilynxData,e.galleryItem.refreshVideoNode();else try{var t=void 0;(t=u.a.isMobile?new Z(e):r.a.viziodevice?new re(e):new G(e)).init(),n.a.galleryItems.push(t)}catch(e){this._logger.error("Exception raised while processing the gallery item. Aborting item execution. Stack trace:"),this._logger.error(e)}},e.prototype.extractor=function(){var e=new RegExp(r.a.urlregexp),t=window.location.host+window.location.pathname;!r.a.ignorecurrenturl||void 0!==this._currentUrl&&t.match(this._currentUrl)||(this._currentUrl=new RegExp("^(http:|https:)?(//)?("+t.replace(new RegExp("/$"),"")+")(/)?$"));for(var i=this._domElementsArray.length-1;i>=0;i--){var o=this._domElementsArray[i];if(void 0===o.extractedUrl){var n,a=o.domObject,s=void 0;(n=d.exctractIdAttribute(a))?s=n:!r.a.ignorehref&&"a"===a.localName&&a.attributes.href&&(s=a.href),r.a.urlregexp&&s&&(s=s.replace(e,"")),r.a.ignorecurrenturl&&s&&s.match(this._currentUrl)&&(this._logger.warn("url matches with current url. Removing from array"),s=""),s?(o.extractedUrl=s,this._preparedDomElementsArray.push(o)):(this._logger.warn("Can't find URL for dom node. Removing from array"),this._logger.warn(a)),this._domElementsArray.splice(i,1)}}this._logger.info("Extractor job done. Got "+this._preparedDomElementsArray.length+" Items"),this._logger.debug(this._preparedDomElementsArray)},e.prototype.getHashes=function(e,t){var i=this,o=this._buildGetHashesRequest(),r=o.endpoint,n=o.params;(new l).post(r,"",n).then(function(t){e(t)}).catch(function(o){i._preparedDomElementsArray=[],o&&((t+=1)<=c.a.maxRetries?(i._logger.warn("Error executing XHR to  get_hashes, retry in "+c.a.retryTime+" ( Retry "+t+" of "+c.a.maxRetries+" )"),setTimeout(function(){i.getHashes(e,t)},c.a.retryTime)):i._logger.error("FUBAR: Can't  get video hashes. Aborting"))})},e.prototype._parseApiResponse=function(e){var t=JSON.parse(e);return r.a.personalizedpreviews?Object.keys(t).map(function(e){return{embeddings:t[e].embeddings,hash:t[e].content_hash,modelHash:t[e].model_hash,timestamp:t[e].last_processed,url:e}}):t.hashes.map(function(e){return{hash:e.hash[0],timestamp:e.timestamp[0],title:e.title||"",url:e.url[0]}})},e.prototype._buildGetHashesRequest=function(){var e=r.a.personalizedpreviews,t={endpoint:"",params:{}};return e?(t.endpoint="https://"+c.a.serverUrl+"/api2.0/contents/preview",t.params={external_ids:JSON.stringify(this._preparedDomElementsArray.map(function(e){return e.extractedUrl})),user_hash:r.a.publickey}):(t.endpoint="//"+c.a.serverUrl+"/get_hashes.php",t.params={owner:r.a.publickey,title:"",url:""},this._preparedDomElementsArray.forEach(function(e){t.params.url+=e.extractedUrl+","})),t},e}()),ae=function(){return function(){}}(),se=function(){function e(){this._logger=new s.a("[vlx_dbg]"),this._logger.debug("Listener class initialized"),this._finder=ne,this._validItemsQuerySelector=this.buildValidItemsSelector(),ne.privateScan(document,null,null,this._validItemsQuerySelector),this._mutationTarget=document.querySelector("body"),this._mutationObserverSettings=new ae,this._mutationObserverSettings.childList=!0,this._mutationObserverSettings.attributes=!1,this._mutationObserverSettings.characterData=!1,this._mutationObserverSettings.subtree=!0,this._mutationObserverSettings.attributeOldValue=!1,this._ignoreElementsQuery=".supra-wrapper",r.a.ignoreparentelement&&d.validateQuery(r.a.ignoreparentelement)&&(this._ignoreElementsQuery+=", "+r.a.ignoreparentelement),this.addEs6DomChangesListener(),this.vilynxEnabledListener(),this.vilynxConfigListener()}return e.prototype.buildValidItemsSelector=function(){var e,t=":not(.vilynxignore):not(.vilynx_registered):not(.vilynx_disabled)",i="[vilynx-id]"+t+", [data-vilynx-id]"+t;return r.a.idattribute&&(i+=", ["+r.a.idattribute+"]"+t),e="a"+t+", "+i,r.a.directurl&&r.a.disableall?(e=".vilynx_enabled[vilynx-id]"+t+", .teaser_enabled[vilynx-id]"+t+", .vilynx_enabled[data-vilynx-id]"+t+", .teaser_enabled[data-vilynx-id]"+t,r.a.idattribute&&(e+=", .vilynx_enabled["+r.a.idattribute+"]"+t+", .teaser_enabled["+r.a.idattribute+"]"+t)):r.a.directurl?e=i:r.a.disableall&&(e=".vilynx_enabled"+t+", .teaser_enabled"+t),e},e.prototype.addEs6DomChangesListener=function(){var e=this;this._logger.debug("Adding ES6 MutationObserver"),new MutationObserver(function(t){var i=[],o=[];t.forEach(function(t){Array.prototype.slice.call(t.addedNodes).forEach(function(t){if((t.classList&&t.classList.contains("vilynx_enabled")||t.childElementCount)&&!t.closest(e._ignoreElementsQuery)&&(i.push(t),t.querySelectorAll(".vilynx_enabled").length>0||t.classList.contains("vilynx_enabled"))){if(t.classList.contains("vilynx_enabled"))o.push(t);else{var r=Array.prototype.slice.call(t.querySelectorAll(".vilynx_enabled"));o=o.concat(r)}e.vilynxEnabledListener(o)}})}),e._finder.softScan(i)}).observe(this._mutationTarget,this._mutationObserverSettings)},e.prototype.vilynxEnabledListener=function(e){var t,i=this,o=[];t=void 0!==e?e:document.querySelectorAll(".vilynx_enabled:not(.vilynxignore):not(.vilynx_registered):not(.vilynx_disabled)"),Array.prototype.forEach.call(t,function(e){var t=!e.getAttribute("vilynx-id")&&!e.getAttribute("data-vilynx-id")&&(!r.a.idattribute||!e.getAttribute(r.a.idattribute))||e.attributes.getNamedItem("href"),n=[].slice.call(e.querySelectorAll("img")),a=!(n.length&&n.some(function(e){return!e.matches(r.a.imgignore)})||d.findElementWithBg(e));if(e&&(t||a)&&e.classList&&!e.classList.contains("vilynx_observe")){var s=new MutationObserver(function(){var t=[];e.classList&&!e.classList.contains("vilynx_registered")&&(t.push(e),i._finder.softScan(t),i._logger.debug("vilynx_observe element configuration has changed. Adding it to the finder."))}),l=new ae;l.childList=!1,l.subtree=!1,l.attributes=!0,l.characterData=!1,t&&(o.push("vilynx-id","data-vilynx-id","href"),r.a.idattribute&&o.push(r.a.idattribute)),a&&(o.push("style"),l.subtree=!0,l.childList=!0),l.attributeFilter=o,s.observe(e,l),e.classList.add("vilynx_observe")}})},e.prototype.vilynxConfigListener=function(){var e=this,t=c.a.scriptTag;new MutationObserver(function(i){i.forEach(function(i){var o,n=i.attributeName,a=t.getAttributeNode(n);a&&(n=n.replace("data-",""),void 0===r.a[n]?e._logger.warn("Config register not found: "+n):("true"===(o=a.nodeValue)?o=!0:"false"===o&&(o=!1),r.a[n]=o,e._logger.debug("Config element changed after loaded: "+n)))})}).observe(t,{attributes:!0,characterData:!1,childList:!1,subtree:!1})},e}();t.a=se},function(e,t,i){"use strict";var o,r=i(9),n=i(2);i(19);!function(e){e[e.greater=0]="greater",e[e.lower=1]="lower",e[e.equal=2]="equal"}(o||(o={}));var a,s,l,c,d,u=function(){function e(){}return e.checkVersion=function(e,t){for(var i=e.split("."),r=t.split("."),n=0;n<r.length;){if(i[n]<r[n])return o.lower;if(i[n]>r[n])return o.greater;n+=1}return o.equal},e}(),h=i(5),p=i(10),g=i(11),f=new(function(){function e(){this._isPluginReady=!1,this._apiBasePath="https://dagda.vilynx.com",this._pluginVersion="2.5.0-1",this._pluginName="dagda",this._uuid=p.a.get("vlx_uuid",h.a.plain)||Object(g.b)(),p.a.set("vlx_uuid",this._uuid,h.a.plain)}return Object.defineProperty(e.prototype,"isPluginReady",{get:function(){return this._isPluginReady},set:function(e){this._isPluginReady=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"apiBasePath",{get:function(){return this._apiBasePath},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pluginVersion",{get:function(){return this._pluginVersion},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pluginName",{get:function(){return this._pluginName},enumerable:!0,configurable:!0}),e}()),y=i(4);!function(e){e.mediaPlay="mediaPlay",e.mediaPause="mediaPause",e.mediaEnd="mediaEnd",e.mediaUpdate="mediaUpdate"}(a||(a={})),function(e){e.articleOpen="articleOpen",e.articleScroll="articleScroll"}(s||(s={})),function(e){e.mediaEvent="mediaEvent",e.textEvent="textEvent",e.galleryEvent="galleryEvent",e.recoEvent="recoEvent",e.hitEvent="hitEvent",e.loadEvent="loadEvent"}(l||(l={})),function(e){e.notSent="notSent",e.sending="sending",e.sent="sent"}(c||(c={})),function(e){e.pageLoad="pageLoad",e.spaNavigation="spaNavigation"}(d||(d={}));var v,m=i(8);!function(e){e.enterViewport="enterViewport",e.mouseOver="mouseOver",e.click="click"}(v||(v={}));var _,b,w=function(){return function(e){}}(),O=new(function(){function e(){this._legacyMode=!0,this._logger=new n.a("[DAGDA_BEACON-"+f.pluginVersion+"]"),navigator&&navigator.sendBeacon&&(this._legacyMode=!1)}return e.prototype.send=function(e){return this._logger.debug("Making send events request."),this._legacyMode?this._gifSend(e):this._beaconSend(e)},e.prototype._beaconSend=function(e){return new Promise(function(t,i){navigator.sendBeacon(f.apiBasePath+"/b",'{"e":"'+e+'"}')?t():i()})},e.prototype._gifSend=function(e){return new Promise(function(t,i){var o=new Image;o.src=f.apiBasePath+"/b.gif?e="+e,o.style.display="none",o.style.visibility="hidden",o.addEventListener("load",t),o.addEventListener("error",i),document.body.appendChild(o)})},e}()),E=new(function(){function e(){}return e.prototype.toSnake=function(e){return this._convertTo(e,!0)},e.prototype.toCamel=function(e){return this._convertTo(e,!1)},e.prototype._convertTo=function(e,t){if("string"==typeof e)return t?this._buildKeySnake(e):this._buildKeyCamel(e);if(Array.isArray(e))return t?e.map(this.toSnake,this):e.map(this.toCamel,this);if(e&&"object"==typeof e){var i={};for(var o in e){if(Object.hasOwnProperty.call(e,o))i[t?this._buildKeySnake(o):this._buildKeyCamel(o)]=t?this.toSnake(e[o]):this.toCamel(e[o])}return i}return e},e.prototype._buildKeyCamel=function(e){return e.replace(/_./g,function(e){return e.slice(1,2).toUpperCase()})},e.prototype._buildKeySnake=function(e){return e.replace(/(?!^)([A-Z])/g,function(e){return"_"+e.toLowerCase()}).toLowerCase()},e}()),x=function(){function e(e){if(this._sendAlone=!1,this._sendStatus=c.notSent,!e)throw new w("Event is required, none found on first parameter");this._evId=e._evId||Object(g.a)(8),this.url=e.url||window.location.href,this.originUrl=e.originUrl||document.referrer,this.publicKey=e.publicKey||y.a.publickey,this.eventTime=e.eventTime||+new Date}return e.prototype.canSend=function(){return this._sendStatus===c.notSent},e.prototype.isSent=function(){this._sendStatus=c.sent},e.prototype.getMeta=function(){return{GUID:this._evId,UA:navigator.userAgent,UUID:f.uuid,screen_size:window.screen.availHeight+"x"+window.screen.availWidth}},e.prototype.send=function(){var e=this;this.sending(),this._sendAlone=!0;var t=btoa(JSON.stringify(this));return O.send(t).then(function(){e.isSent()})},e.prototype.sending=function(){this._sendStatus=c.sending},e.prototype.checkHasAllPropertiesOf=function(e){e.eventCategory=e.category,delete e.category;var t=Object.keys(this);Object.keys(e).map(function(e){return"event_id"===e?"_evId":E.toCamel(e)}).forEach(function(e){if(!t.includes(e))throw new w("Current dagda version does not support all the event fields passed to the constructor")})},e}(),T=(_=function(e,t){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),I=function(e){function t(t){var i=this;if(!t)throw new w("Event is required, none found on first parameter");return(i=e.call(this,t)||this).eventCategory=l.mediaEvent,i.eventType=t.eventType,i.elementId=t.elementId,i.currentTime=t.currentTime,i}return T(t,e),t.prototype.toJSON=function(){var e={category:E.toSnake(this.eventCategory),current_time:E.toSnake(this.currentTime),element_id:this.elementId,event_id:this._evId,event_time:this.eventTime,event_type:E.toSnake(this.eventType),origin_url:this.originUrl,public_key:this.publicKey,url:this.url};return this._sendAlone?{_meta_:this.getMeta(),event:e}:e},t.prototype._guaranteeMediaEvent=function(e){if(e.eventType in a==!1)throw new w('"event.eventType" must be one of the following: ('+Object.getOwnPropertyNames(a)+") ");if("string"!=typeof e.elementId)throw new w('"event.elementId" must be a string and a valid GUID.');if(isNaN(e.currentTime))throw new w('"event.currentTime" must be valid number.');if(e.url&&"string"!=typeof e.url)throw new w('"event.url" must be valid string.');return!0},t}(x),N=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),S=function(e){function t(t){var i=this;if(!t)throw new w("Event is required, none found on first parameter");return(i=e.call(this,t)||this).eventCategory=l.galleryEvent,i.eventType=t.eventType,t.actionId&&(i.actionId=t.actionId),i.previewHash=t.previewHash,i.currentTime=t.currentTime,i.isRedirect=t.isRedirect||!1,i.resolution=t.resolution,i.passiveTracking=t.passiveTracking,i._guaranteeGalleryEvent(t),i}return N(t,e),t.prototype.toJSON=function(){var e={action_id:this.actionId,category:E.toSnake(this.eventCategory),current_time:this.currentTime,event_id:this._evId,event_time:this.eventTime,event_type:E.toSnake(this.eventType),origin_url:this.originUrl,passive_tracking:this.passiveTracking,preview_hash:this.previewHash,public_key:this.publicKey,resolution:this.resolution,url:this.url};return this.eventType===m.a.summaryClick&&(e.is_redirect=this.isRedirect),this._sendAlone?{_meta_:this.getMeta(),event:e}:e},t.prototype._guaranteeGalleryEvent=function(e){if(e.eventType in m.a==!1)throw new w('"event.eventType" must be one of the following: ('+Object.getOwnPropertyNames(m.a)+") ");if("string"!=typeof e.previewHash)throw new w('"event.elementGuid" must be a string and a valid GUID.');if(isNaN(e.currentTime))throw new w('"event.currentTime" must be valid number.');if(e.url&&"string"!=typeof e.url)throw new w('"event.url" must be valid string.');if(e.isRedirect&&"boolean"!=typeof e.isRedirect)throw new w('"event.isRedirect" must be valid boolean.');if(e.resolution in m.b==!1)throw new w('"event.resolution" must be one of the following: ('+Object.getOwnPropertyNames(m.b)+") ");return!0},t}(x),P=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),D=function(e){function t(t){var i=e.call(this,t)||this;return t.actionId&&(i.actionId=t.actionId),i.eventCategory=l.recoEvent,i.eventType=t.eventType,i.elemHash=t.elemHash,i._guaranteeRecoEvent(t),i}return P(t,e),t.prototype.toJSON=function(){var e={action_id:this.actionId,category:E.toSnake(this.eventCategory),elem_hash:this.elemHash,event_id:this._evId,event_time:this.eventTime,event_type:E.toSnake(this.eventType),origin_url:this.originUrl,public_key:this.publicKey,url:this.url};return this._sendAlone?{_meta_:this.getMeta(),event:e}:e},t.prototype._guaranteeRecoEvent=function(e){if(e.eventType in v==!1)throw new w('"event.eventType" must be one of the following: ('+Object.getOwnPropertyNames(v)+")");if("string"!=typeof e.elemHash)throw new w('"event.elemHash" must be a string and a valid GUID.');return!0},t}(x),A=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),L=function(e){function t(t){var i=this;if(!t)throw new w("Event is required, none found on first parameter");return(i=e.call(this,t)||this).eventCategory=l.textEvent,i.elementId=t.elementId,i.eventType=t.eventType,i.scrollPercentage=t.scrollPercentage,i._guaranteeTextEvent(t),i}return A(t,e),t.prototype.toJSON=function(){var e={category:E.toSnake(this.eventCategory),element_id:this.elementId,event_id:this._evId,event_time:this.eventTime,event_type:E.toSnake(this.eventType),origin_url:this.originUrl,public_key:this.publicKey,scroll_percentage:this.scrollPercentage,url:this.url};return this._sendAlone?{_meta_:this.getMeta(),event:e}:e},t.prototype._guaranteeTextEvent=function(e){if(e.eventType in s==!1)throw new w('"event.eventType" must be one of the following: ('+Object.getOwnPropertyNames(s)+")");if("string"!=typeof e.elementId)throw new w('"event.elementGuid" must be a string and a valid GUID.');if(isNaN(e.scrollPercentage))throw new w('"event.scrollPercentage" must be a number between 0 and 100.');return!0},t}(x),k=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),j=function(e){function t(t){var i=this;if(!t)throw new w("Event is required, none found on first parameter");return(i=e.call(this,t)||this).eventCategory=l.hitEvent,i.passiveTracking=t.passiveTracking,i.eventType=t.eventType,i._guaranteeHitEvent(t),i}return k(t,e),t.prototype.toJSON=function(){var e={category:E.toSnake(this.eventCategory),event_id:this._evId,event_time:this.eventTime,event_type:E.toSnake(this.eventType),origin_url:this.originUrl,passive_tracking:this.passiveTracking,public_key:this.publicKey,url:this.url};return this._sendAlone?{_meta_:this.getMeta(),event:e}:e},t.prototype._guaranteeHitEvent=function(e){if(e.eventType in d==!1)throw new w('"event.eventType" must be one of the following: ('+Object.getOwnPropertyNames(d)+") ");return!0},t}(x),V=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),C=function(e){function t(t){var i=this;if(!t)throw new w("Event is required, none found on first parameter");return(i=e.call(this,t)||this).pluginName=t.pluginName,i.pluginVersion=t.pluginVersion,i.eventCategory=l.loadEvent,i._guaranteeLoadEvent(t),i}return V(t,e),t.prototype.toJSON=function(){var e={category:E.toSnake(this.eventCategory),event_id:this._evId,event_time:this.eventTime,origin_url:this.originUrl,plugin_name:this.pluginName,plugin_version:this.pluginVersion,public_key:this.publicKey,url:this.url};return this._sendAlone?{_meta_:this.getMeta(),event:e}:e},t.prototype._guaranteeLoadEvent=function(e){if(e.url&&"string"!=typeof e.url)throw new w('"event.url" must be valid string.');return!0},t}(x),M=new(function(){function e(){this.ua=navigator.userAgent.toLowerCase(),this.isMozilla=this._dr("firefox"),this.isWebkit=this._dr("webkit"),this.isOpera=this._dr("opera"),this.isMsie=this._dr("msie|trident|edge"),this.isIe=this._dr("trident"),this.isEdge=this._dr("edge"),this.isIe10=this._dr("msie"),this.isChrome=this._dr("chrome"),this.isAndroid=this._dr("android"),this.isIos=this._dr("iphone|ipad|ipod"),this.isIpad=this._dr("ipad"),this.isAndroidTablet=this.isAndroid&&this._dr("^mobile"),this.isTablet=this.isIpad||this.isAndroidTablet,this.isIphone=this._dr("iphone"),this.isOperaMini=this._dr("opera mini"),this.isWindowsMobile=this._dr("iemobile"),this.isKindle=this._dr("kindle|silk|kftt|kfot|kfjwa|kfjwi"),this.isMobile=this.isAndroid||this.isIos||this.isIphone||this.isOperaMini||this.isWindowsMobile||this.isKindle,this.isOldIphone=this.isIphone&&window.screen.height/window.screen.width==1.5&&window.devicePixelRatio<=2,this.isSafari=this._checkIsSafari()}return e.prototype._dr=function(e){return new RegExp(e).test(this.ua)},e.prototype._checkIsSafari=function(){var e;return!!this._dr("^((?!chrome).)*safari")&&(e=this.ua.search("version/"),parseInt(this.ua.substr(e+8,3),10))},e}()),R=function(){return function(e,t,i,o,r,n){this.GUID=e,this.UA=t,this.UUID=i,this.group_length=o,this.screen_size=n}}(),q=function(){function e(e,t){this.groupLength=0,this._logger=new n.a("[DAGDA_EV_Group-"+f.pluginVersion+"]"),this.events=e,this.groupLength=this.events.length,this.creationTime=+new Date,this._guid=Object(g.a)(6),e.forEach(function(e){return e.sending()}),this._logger.info("New group created",this),this._meta_=t||this._defaultMeta()}return e.prototype.toJSON=function(){var e={};return this.events.forEach(function(t){try{e[t.eventCategory].push(t)}catch(i){e[t.eventCategory]=[t]}}),{_meta_:this._meta_,events:this.events}},e.prototype.sendGroup=function(){var e=btoa(JSON.stringify(this));return this._logger.info("Sending new event group",this.toJSON()),O.send(e)},e.prototype._defaultMeta=function(){return new R(this._guid,navigator.userAgent,f.uuid,this.groupLength,y.a.publickey,window.screen.availHeight+"x"+window.screen.availWidth)},e}(),U=function(){function e(){this._logger=new n.a("[EventsStorage-"+f.pluginVersion+"]")}return e.prototype.storeEvents=function(e){if(e.length){var t=new q(e);p.a.set("dgd_unsent",JSON.stringify(t),h.a.base64)}},e.prototype.restoreEvents=function(){var e=this;return new Promise(function(t,i){var o=p.a.get("dgd_unsent",h.a.base64),r=[];if(o){var n=JSON.parse(o).events;n&&(r=n.map(function(t){var o;try{o=e.rawToEvent(t)}catch(o){e._logger.error("Exception parsing event",t,o),i()}return o}).filter(function(e){return null!==e}))}t(r)})},e.prototype.clearUnsent=function(){p.a.remove("dgd_unsent")},e.prototype.rawToEvent=function(e){var t,i;switch(e.category){case"hit_event":t={eventId:e._evId,eventTime:e.event_time,eventType:E.toCamel(e.event_type),originUrl:e.origin_url,passiveTracking:e.passive_tracking,publicKey:e.public_key,url:e.url},i=new j(t);break;case"load_event":t={eventId:e._evId,eventTime:e.event_time,originUrl:e.origin_url,pluginName:e.plugin_name,pluginVersion:e.plugin_version,publicKey:e.public_key,url:e.url},i=new C(t);break;case"text_event":t={currentTime:e.current_time,elementId:e.element_id,eventId:e._evId,eventTime:e.event_time,eventType:E.toCamel(e.event_type),originUrl:e.origin_url,publicKey:e.public_key,scrollPercentage:e.scroll_percentage,url:e.url},i=new L(t);break;case"reco_event":t={actionId:e.action_id,elemHash:e.elem_hash,eventId:e._evId,eventTime:e.event_time,eventType:E.toCamel(e.event_type),originUrl:e.origin_url,publicKey:e.public_key,url:e.url},i=new D(t);break;case"gallery_event":t={actionId:e.action_id,currentTime:e.current_time,eventId:e._evId,eventTime:e.event_time,eventType:E.toCamel(e.event_type),isRedirect:e.is_redirect,originUrl:e.origin_url,passiveTracking:e.passive_tracking,previewHash:e.preview_hash,publicKey:e.public_key,resolution:e.resolution,url:e.url},i=new S(t);break;case"media_event":t={currentTime:e.current_time,elementId:e.element_id,eventId:e._evId,eventTime:e.event_time,eventType:E.toCamel(e.event_type),originUrl:e.origin_url,publicKey:e.public_key,url:e.url},i=new I(t);break;default:return this._logger.error("Raw event can't be parsed.",e),null}return i.checkHasAllPropertiesOf(e),i},e}(),z=function(){function e(){var e=this;this.events=[],this.initEvents=[],this._unsentEvents=0,this._logger=new n.a("[DAGDA_Session-"+f.pluginVersion+"]"),0!==y.a.sendDelay?(this._logger.info("Timeout to send events set to "+y.a.sendDebounce),this._eventsStorage=new U,this._eventsStorage.restoreEvents().then(function(t){e._logger.debug(t.length+" events were successfully restored."),e.events=e.events.concat(t),e.sendEvents(),e._eventsStorage.clearUnsent(),window.setTimeout(function(){e._sendEventsInterval=window.setInterval(function(){e.sendEvents().then(function(){}).catch(function(){e._logger.info("No events to send")})},y.a.sendDelay)},y.a.sendDebounce)}).catch(function(){e._logger.debug("Events could not be restored, just starting schedule without them."),window.setTimeout(function(){e._sendEventsInterval=window.setInterval(function(){e.sendEvents().then(function(){}).catch(function(){e._logger.info("No events to send")})},y.a.sendDelay)},y.a.sendDebounce)})):this._logger.info("Send delay is set to 0, dagda session is useless"),this.addUnloadListeners()}return e.prototype.push=function(e){this._logger.info("New event Added",e),this._groupEventByActionId(e),this.events.push(e),this._unsentEvents+=1},e.prototype.sendEvents=function(){var e=this,t=this.getEventsReadyToSend();return t.splice(20,t.length),new Promise(function(i,o){if(t.length>0){var r=new q(t);r.sendGroup().then(function(){r=void 0,t.forEach(function(e){return e.isSent()}),e._eventsStorage.clearUnsent(),i()}).catch(function(){e._logger.warn("Failed to send "+t.length+". Restoring event status"),t.forEach(function(e){return e.canSend()})})}else i()})},e.prototype.addEventsFromOldDagda=function(e){var t,i=this;this._logger.info("Adding events from old Dagda");try{t=JSON.parse(e.events)}catch(e){this._logger.error("There was an error parsing the events from an old Dagda instance.")}t&&(t.forEach(function(e){var t;try{t=i._eventsStorage.rawToEvent(e)}catch(t){i._logger.error("Exception parsing event",e,t)}t&&(i.events.some(function(e){return i._areSameEvent(e,t)})||(i._logger.debug("It does not exist an event equal to "+t+". Pushing it."),i.push(t)))}),this._logger.debug("Added "+t.length+" events from old Dagda."))},e.prototype._areSameEvent=function(e,t){return e instanceof S&&t instanceof S?this._areSameBaseEvent(e,t)&&e.previewHash===t.previewHash&&e.currentTime===t.currentTime&&e.eventType===t.eventType:e instanceof D&&t instanceof D?this._areSameBaseEvent(e,t)&&e.elemHash===t.elemHash&&e.eventType===t.eventType:this._areSameBaseEvent(e,t)&&e.constructor===t.constructor},e.prototype._areSameBaseEvent=function(e,t){return e.eventCategory===t.eventCategory&&e.publicKey===t.publicKey&&e.url===t.url&&Math.floor(e.eventTime/y.a.groupSameEventsThreshold)===Math.floor(t.eventTime/y.a.groupSameEventsThreshold)},e.prototype.stopSendingEvents=function(){this._logger.debug("Stopping send events interval"),clearInterval(this._sendEventsInterval)},e.prototype.clearEventsArray=function(){this._logger.debug("Clearing events array."),this.events=null},e.prototype.unloadFn=function(){this._logger.debug("Storing unsent events to LocalStorage"),this._storeUnsent()},e.prototype.addUnloadListeners=function(){this._logger.debug("Adding page unload listeners"),this._bindedUnloadFn=this.unloadFn.bind(this),M.isIos?window.addEventListener("pagehide",this._bindedUnloadFn,!1):window.addEventListener("beforeunload",this._bindedUnloadFn,!1)},e.prototype.removeUnloadListeners=function(){this._logger.debug("Removing page unload listeners"),M.isIos?window.removeEventListener("pagehide",this._bindedUnloadFn,!1):window.removeEventListener("beforeunload",this._bindedUnloadFn,!1)},e.prototype._groupEventByActionId=function(e){var t=this;this.events.forEach(function(i){var o=t._getRecoAndGalleryEvent(i,e),r=o[0],n=o[1];if(![r,n].some(function(e){return void 0===e})&&void 0===n.actionId&&void 0===r.actionId&&n.eventType===m.a.summaryClick&&r.eventType===v.click&&Math.floor(i.eventTime/y.a.groupByActionIdThreshold)===Math.floor(e.eventTime/y.a.groupByActionIdThreshold)){var a=Object(g.a)(8);r.actionId=a,n.actionId=a}})},e.prototype._getRecoAndGalleryEvent=function(e,t){return e.eventCategory===l.recoEvent&&t.eventCategory===l.galleryEvent?[e,t]:e.eventCategory===l.galleryEvent&&t.eventCategory===l.recoEvent?[t,e]:[void 0,void 0]},e.prototype.getAllPendingEvents=function(){return[].concat(this.events.filter(function(e){return e.canSend()})).concat(this.initEvents.filter(function(e){return e.canSend()}))},e.prototype.getEventsReadyToSend=function(){var e=this.events?this.events.filter(function(e){return e.canSend()}):[];return e.length&&this.initEvents.length&&(e=e.concat(this.initEvents.filter(function(e){return e.canSend()}))),e},e.prototype._storeUnsent=function(){var e=this.getEventsReadyToSend();this._eventsStorage.storeEvents(e)},e}(),B=function(){function e(e,t){this._eventName=e,this._eventHandler=t}return e.prototype.activate=function(){addEventListener(this._eventName,this._eventHandler)},e.prototype.deactivate=function(){removeEventListener(this._eventName,this._eventHandler)},e}();!function(e){e.galleryEvent="dgd_track_gallery_event",e.recoEvent="dgd_track_reco_event",e.mediaEvent="dgd_track_media_event",e.textEvent="dgd_track_text_event"}(b||(b={}));var F=function(){function e(e){this._logger=new n.a("[SPA_LISTENER]"),this._locationChangeListenerInterval=null,this._dagdaSession=e}return e.prototype.startListening=function(){var e=this;this._previousLocation=this._getCleanedUrl(),this._locationChangeListenerInterval=window.setInterval(function(){var t=e._getCleanedUrl();if(t!==e._previousLocation){e._logger.info("Location changed from "+e._previousLocation+" to "+window.location.href);var i=new j({eventType:d.spaNavigation,passiveTracking:y.a.passiveTracking});e._dagdaSession.push(i),e._previousLocation=t}},y.a.spaNavigationInterval)},e.prototype.stopListening=function(){window.clearInterval(this._locationChangeListenerInterval),this._locationChangeListenerInterval=null},e.prototype._getCleanedUrl=function(){return window.location.protocol+"//"+window.location.hostname+window.location.pathname},e}(),W=function(){function e(e,t){this._isActive=!0,this._logger=new n.a("[DAGDA-"+f.pluginVersion+"]"),this._dagdaSession=new z,t&&(y.a.publickey=t.publicKey,y.a.passiveTracking=t.passiveTracking,y.a.spaNavigation=t.spaNavigation,r.a.logLevel=t.logLevel||r.a.logLevel),this._configureSPANavigationListener();var i=new C(e);e.pluginName===f.pluginName?this._dagdaSession.events.push(i):this._dagdaSession.initEvents.push(i),window.vilynx=window.vilynx||{},window.vilynx.dagda=window.vilynx.dagda||{};var a=!1;if(this._defineProperties(),this._initializeCustomEventsListeners(),window.vilynx.dagda.version){if(a=!0,u.checkVersion(window.vilynx.dagda.version,f.pluginVersion)===o.greater)return this._logger.info("A previous Dagda, with newer version was on the page."),void this._newDagadVersionInstantiatedListener(null);var s=new Event("new_dagda_version");window.vilynx.dagda.version=f.pluginVersion,this._logger.info("Instantianing a new version of Dagda"),addEventListener("old_dagda_events",this._oldDagdaEventsListener.bind(this)),this._logger.info("Sending new_dagda_version event to old dagda"),dispatchEvent(s)}else{this._logger.info("There was not a previous Dagda version. Setting it and sending HitEvent.");var l=new j({eventType:d.pageLoad,passiveTracking:y.a.passiveTracking,publicKey:y.a.publickey});addEventListener("old_dagda_events",this._oldDagdaEventsListener.bind(this)),this._dagdaSession.initEvents.push(l),window.vilynx.dagda.version=f.pluginVersion}addEventListener("new_dagda_version",this._newDagadVersionInstantiatedListener.bind(this)),this._addCustomEventsListeners(),this._logger.info("Dagda class initialized"),window.vilynx.dagda.t&&!a||(window.vilynx.dagda.mediaTrack=this.mediaTrack,window.vilynx.dagda.textTrack=this.textTrack,window.vilynx.dagda.t=+new Date,y.a.godMode&&(window.vilynx.dagda.galleryTrack=this.galleryTrack,window.vilynx.dagda.recoTrack=this.recoTrack)),this._clearCache()}return e.prototype._configureSPANavigationListener=function(){y.a.spaNavigation&&(this._SPANavigationListener=new F(this._dagdaSession),this._SPANavigationListener.startListening())},e.prototype._oldDagdaEventsListener=function(e){this._logger.info("Receiving events from older Dagda version."),this._dagdaSession.addEventsFromOldDagda(e.detail)},e.prototype._newDagadVersionInstantiatedListener=function(e){this._logger.info("Received instantiaton message from a newer Dagda. Unloading current one."),this._isActive=!1;var t=this._dagdaSession.getAllPendingEvents(),i=JSON.stringify(t),o=new CustomEvent("old_dagda_events",{detail:{events:i}});this._logger.debug("Sending "+t.length+" events to new Dagda"),this._removeCustomEventsListeners(),dispatchEvent(o),this._dagdaSession.removeUnloadListeners(),this._dagdaSession.stopSendingEvents(),this._dagdaSession.clearEventsArray(),removeEventListener("new_dagda_version",this._newDagadVersionInstantiatedListener)},e.prototype._initializeCustomEventsListeners=function(){this._customEventslisteners=[new B(b.galleryEvent,this._trackGalleryEventHandler.bind(this)),new B(b.recoEvent,this._trackRecoEventHandler.bind(this)),new B(b.mediaEvent,this._trackMediaEventHandler.bind(this)),new B(b.textEvent,this._trackTextEventHandler.bind(this))]},e.prototype._addCustomEventsListeners=function(){this._logger.info("Adding listeners for dagda events"),this._customEventslisteners.forEach(function(e){e.activate()})},e.prototype._removeCustomEventsListeners=function(){this._logger.info("Removing listeners for dagda events"),this._customEventslisteners.forEach(function(e){e.deactivate()})},e.prototype._trackGalleryEventHandler=function(e){this._logger.info("Received GalleryEvent on a CustomEvent"),this.galleryTrack(e.detail.eventInterface)},e.prototype._trackRecoEventHandler=function(e){this._logger.info("Received RecoEvent on a CustomEvent"),this.recoTrack(e.detail.eventInterface)},e.prototype._trackMediaEventHandler=function(e){this._logger.info("Received MediaEvent on a CustomEvent"),this.mediaTrack(e.detail.eventInterface)},e.prototype._trackTextEventHandler=function(e){this._logger.info("Received TextEvent on a CustomEvent"),this.textTrack(e.detail.eventInterface)},e.prototype._defineProperties=function(){var e=this;this.mediaTrack=function(t){if(e._isActive){e._logger.debug("Current version of Dagda is active, adding MediaEvent to DagdaSession");var i=new I(t);0===y.a.sendDelay?i.send():e._dagdaSession.push(i)}else e._broadcastEvent(b.mediaEvent,t)},this.textTrack=function(t){if(e._isActive){e._logger.debug("Current version of Dagda is active, adding TextEvent to DagdaSession");var i=new L(t);e._logger.info("New Text Event created",t,i),0===y.a.sendDelay?i.send():e._dagdaSession.push(i)}else e._broadcastEvent(b.textEvent,t)},this.galleryTrack=function(t){if(e._isActive){e._logger.debug("Current version of Dagda is active, adding GalleryEvent to DagdaSession");var i=new S(t);e._logger.info("New Gallery event created",t,i),0===y.a.sendDelay?i.send():e._dagdaSession.push(i)}else e._broadcastEvent(b.galleryEvent,t)},this.recoTrack=function(t){if(e._isActive){e._logger.debug("Current version of Dagda is active, adding recoEvent to DagdaSession");var i=new D(t);e._logger.info("New Text Event created",t,i),0===y.a.sendDelay?i.send():e._dagdaSession.push(i)}else e._broadcastEvent(b.recoEvent,t)}},e.prototype._broadcastEvent=function(e,t){this._logger.debug("Broadcasting event to "+e+".");var i=new CustomEvent(e,{detail:{eventInterface:t}});dispatchEvent(i)},e.prototype._clearCache=function(){var e=this,t=window.vilynx.dagda.chM||[],i=window.vilynx.dagda.chT||[];t.forEach(function(t){try{var i=new I(t);e._logger.info("New Media Event created from cache",i),e._dagdaSession.push(i)}catch(i){e._logger.error("The cached event "+t+" is not a valid mediaEvent",i)}}),t=[],i.forEach(function(t){try{var i=new L(t);e._logger.info("New Text Event created from cache",i),e._dagdaSession.push(i)}catch(i){e._logger.error("The cached event "+t+" is not a valid textEvent",i)}}),i=[],0===y.a.sendDelay&&this._dagdaSession.sendEvents()},e}(),G=i(3),H=i(0);i.d(t,"a",function(){return Q});var Q=function(){function e(){}return e.instance=function(){return H.a.analytics&&!this._dagda&&(y.a.setValue("sendDelay","5000"),this._dagda=new W({pluginName:"gallery",pluginVersion:G.a.galleryVersion},{logLevel:r.a.logLevel,passiveTracking:H.a.passivetracking,publicKey:H.a.publickey})),this._dagda},e}()},function(e,t,i){(function(t,i){e.exports=function(){"use strict";function e(e){return"function"==typeof e}function o(){var e=setTimeout;return function(){return e(r,1)}}function r(){for(var e=0;e<_;e+=2){var t=S[e],i=S[e+1];t(i),S[e]=void 0,S[e+1]=void 0}_=0}function n(e,t){var i=this,o=new this.constructor(s);void 0===o[D]&&v(o);var r=i._state;if(r){var n=arguments[r-1];O(function(){return y(r,o,n,i._result)})}else g(i,o,e,t);return o}function a(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(s);return d(t,e),t}function s(){}function l(e){try{return e.then}catch(e){return j.error=e,j}}function c(t,i,o){i.constructor===t.constructor&&o===n&&i.constructor.resolve===a?function(e,t){t._state===L?h(e,t._result):t._state===k?p(e,t._result):g(t,void 0,function(t){return d(e,t)},function(t){return p(e,t)})}(t,i):o===j?(p(t,j.error),j.error=null):void 0===o?h(t,i):e(o)?function(e,t,i){O(function(e){var o=!1,r=function(e,t,i,o){try{e.call(t,i,o)}catch(e){return e}}(i,t,function(i){o||(o=!0,t!==i?d(e,i):h(e,i))},function(t){o||(o=!0,p(e,t))},e._label);!o&&r&&(o=!0,p(e,r))},e)}(t,i,o):h(t,i)}function d(e,t){e===t?p(e,new TypeError("You cannot resolve a promise with itself")):function(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}(t)?c(e,t,l(t)):h(e,t)}function u(e){e._onerror&&e._onerror(e._result),f(e)}function h(e,t){e._state===A&&(e._result=t,e._state=L,0!==e._subscribers.length&&O(f,e))}function p(e,t){e._state===A&&(e._state=k,e._result=t,O(u,e))}function g(e,t,i,o){var r=e._subscribers,n=r.length;e._onerror=null,r[n]=t,r[n+L]=i,r[n+k]=o,0===n&&e._state&&O(f,e)}function f(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var o=void 0,r=void 0,n=e._result,a=0;a<t.length;a+=3)o=t[a],r=t[a+i],o?y(i,o,r,n):r(n);e._subscribers.length=0}}function y(t,i,o,r){var n=e(o),a=void 0,s=void 0,l=void 0,c=void 0;if(n){if((a=function(e,t){try{return e(t)}catch(e){return j.error=e,j}}(o,r))===j?(c=!0,s=a.error,a.error=null):l=!0,i===a)return void p(i,new TypeError("A promises callback cannot return that same promise."))}else a=r,l=!0;i._state!==A||(n&&l?d(i,a):c?p(i,s):t===L?h(i,a):t===k&&p(i,a))}function v(e){e[D]=V++,e._state=void 0,e._result=void 0,e._subscribers=[]}var m=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},_=0,b=void 0,w=void 0,O=function(e,t){S[_]=e,S[_+1]=t,2===(_+=2)&&(w?w(r):P())},E="undefined"!=typeof window?window:void 0,x=E||{},T=x.MutationObserver||x.WebKitMutationObserver,I="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),N="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,S=new Array(1e3),P=void 0;P=I?function(){return t.nextTick(r)}:T?function(){var e=0,t=new T(r),i=document.createTextNode("");return t.observe(i,{characterData:!0}),function(){i.data=e=++e%2}}():N?function(){var e=new MessageChannel;return e.port1.onmessage=r,function(){return e.port2.postMessage(0)}}():void 0===E?function(){try{var e=Function("return this")().require("vertx");return void 0!==(b=e.runOnLoop||e.runOnContext)?function(){b(r)}:o()}catch(e){return o()}}():o();var D=Math.random().toString(36).substring(2),A=void 0,L=1,k=2,j={error:null},V=0,C=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(s),this.promise[D]||v(this.promise),m(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?h(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&h(this.promise,this._result))):p(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===A&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,o=i.resolve;if(o===a){var r=l(e);if(r===n&&e._state!==A)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(i===M){var d=new i(s);c(d,e,r),this._willSettleAt(d,t)}else this._willSettleAt(new i(function(t){return t(e)}),t)}else this._willSettleAt(o(e),t)},e.prototype._settledAt=function(e,t,i){var o=this.promise;o._state===A&&(this._remaining--,e===k?p(o,i):this._result[t]=i),0===this._remaining&&h(o,this._result)},e.prototype._willSettleAt=function(e,t){var i=this;g(e,void 0,function(e){return i._settledAt(L,t,e)},function(e){return i._settledAt(k,t,e)})},e}(),M=function(){function e(t){this[D]=V++,this._result=this._state=void 0,this._subscribers=[],s!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){d(e,t)},function(t){p(e,t)})}catch(t){p(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this.constructor;return this.then(function(i){return t.resolve(e()).then(function(){return i})},function(i){return t.resolve(e()).then(function(){throw i})})},e}();return M.prototype.then=n,M.all=function(e){return new C(this,e).promise},M.race=function(e){var t=this;return new t(m(e)?function(i,o){for(var r=e.length,n=0;n<r;n++)t.resolve(e[n]).then(i,o)}:function(e,t){return t(new TypeError("You must pass an array to race."))})},M.resolve=a,M.reject=function(e){var t=new this(s);return p(t,e),t},M._setScheduler=function(e){w=e},M._setAsap=function(e){O=e},M._asap=O,M.polyfill=function(){var e=void 0;if(void 0!==i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var o=null;try{o=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===o&&!t.cast)return}e.Promise=M},M.Promise=M,M.polyfill(),M}()}).call(this,i(22),i(23))},function(e,t,i){"use strict";i.d(t,"a",function(){return u});var o=i(2),r=i(11),n=i(0),a=i(3),s=i(9),l=i(12),c=i(1),d=i(4),u=new(function(){function e(){this._configLoaded=!1,this._logger=new o.a("[Config Loader]"),this.configLoaded=this._getConfigFromDOM('script[src*="gallery/vpg"], script[data-gallery-local]')}return e.prototype._getConfigFromDOM=function(e){var t=this,i=document.querySelector(e);if(null===i)return this._logger.critical("FUBAR: Can't find script tag"),!1;var u=Object(r.c)(i),h=void 0!==u&&Object.keys(u).length>0;return a.a.scriptTag=i,n.a.debug||(n.a.debug=!!localStorage.getItem("vilynx_gallery_debug"),n.a.debug&&(s.a.logLevel=l.a.develop,this._updateLogger(),this._logger.info("Gallery debug enabled by localStorage"))),i?(Object.keys(i.attributes).forEach(function(e){var o=i.attributes[e],r=o.name,a=o.value;h||(r=r.replace("data-","")),void 0===n.a[r]?t._logger.warn("Config register not found: "+r):("number"==typeof n.a[r]?a=parseFloat(o.value):"boolean"==typeof n.a[r]&&("true"===(a=o.value).toLowerCase()?a=!0:"false"===a.toLowerCase()&&(a=!1)),n.a[r]=a,t._logger.debug("Config element loaded: "+r))}),u&&Object.keys(u).forEach(function(e){var i,o=e;void 0===n.a[o]?t._logger.warn("Config register not found: "+o):("true"===(i=u[e]).toLowerCase()?i=!0:"false"===i.toLowerCase()&&(i=!1),n.a[o]=i,t._logger.debug("Config element loaded: "+o))}),n.a.debug&&(s.a.logLevel=l.a.develop,this._updateLogger(),this._logger=new o.a("[Config Loader]")),n.a.publickey?c.a.isMobile&&n.a.nomobile||c.a.isTablet&&n.a.notablet?(this._logger.info("Vilynx Gallery deactivated in mobile"),!1):c.a.isOldIphone?(this._logger.info("Vilynx Gallery disabled on iPhone 4 and lower"),!1):c.a.isIe10?(this._logger.info("Vilynx Gallery disabled on IE10 and lower"),!1):(c.a.isVizio&&null===n.a.viziodevice&&(n.a.viziodevice=!0),this._logger.info("Config loaded"),d.a.publickey=n.a.publickey,a.a.loaded=!0,!0):(this._logger.critical("FUBAR: Can't find userid. Aborting"),!1)):(this._logger.warn("Vilynx Script not detected"),!1)},e.prototype._updateLogger=function(){this._logger=new o.a("[Config Loader]")},Object.defineProperty(e.prototype,"configLoaded",{get:function(){return this._configLoaded},set:function(e){this._configLoaded=e},enumerable:!0,configurable:!0}),e}())},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _config_configLoader__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(20),_modules_helpers_exposed__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7),_modules_domObserve__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(17),_config_globalConfig__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(0),_config_privateConfig__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(3),_vilynx_frontend_core_Logger__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(2),_modules_helpers_browser__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(1),_styles_vpg_less__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(24),_styles_vpg_less__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_styles_vpg_less__WEBPACK_IMPORTED_MODULE_7__),_vilynx_frontend_core_localstorage__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(10),_vilynx_frontend_core_random__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(16),_polyfills_path__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(29),_polyfills_path__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_polyfills_path__WEBPACK_IMPORTED_MODULE_10__),_polyfills_assign__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(30),_polyfills_assign__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_polyfills_assign__WEBPACK_IMPORTED_MODULE_11__),_polyfills_closest__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(31),_polyfills_closest__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_polyfills_closest__WEBPACK_IMPORTED_MODULE_12__),_polyfills_matches__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(32),_polyfills_matches__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_polyfills_matches__WEBPACK_IMPORTED_MODULE_13__),_modules_helpers_viewportQueue__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(6),_vilynx_frontend_core_enums_storage__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(5),_GalleryABStatus__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(14),_modules_analytics_dagda__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(18),Bootstrap=function(){function Bootstrap(){var e=this;if(this._logger=new _vilynx_frontend_core_Logger__WEBPACK_IMPORTED_MODULE_5__.a("[Bootstrap]"),this._addTurboLinkListener(),_config_configLoader__WEBPACK_IMPORTED_MODULE_0__.a.configLoaded){var t="complete"===document.readyState||"interactive"===document.readyState;this._configureABTesting()?(this._logger.info("User is on A/B group or A/B testing is disabled. Loading gallery."),t?this.initGallery():document.addEventListener("DOMContentLoaded",function(){e.initGallery()})):this._logger.info("User is out of A/B testing, Gallery will not be loaded")}else this._logger.critical("Cannot load Vilynx Gallery config, unable to initialize.")}return Bootstrap.prototype.initGallery=function(){var _this=this;if(_config_globalConfig__WEBPACK_IMPORTED_MODULE_3__.a.disablestorage||this.insertVilynxIFrame(),_config_globalConfig__WEBPACK_IMPORTED_MODULE_3__.a.analytics&&_modules_analytics_dagda__WEBPACK_IMPORTED_MODULE_17__.a.instance(),_modules_helpers_browser__WEBPACK_IMPORTED_MODULE_6__.a.isTablet&&(_config_privateConfig__WEBPACK_IMPORTED_MODULE_4__.a.tapToPlay=!0),_config_globalConfig__WEBPACK_IMPORTED_MODULE_3__.a.ongalleryload)setTimeout(function(){try{eval(_config_globalConfig__WEBPACK_IMPORTED_MODULE_3__.a.ongalleryload)()}catch(e){_this._logger.error("Error executing ongalleryload callback")}var observe=new _modules_domObserve__WEBPACK_IMPORTED_MODULE_2__.a},500);else var observe=new _modules_domObserve__WEBPACK_IMPORTED_MODULE_2__.a},Bootstrap.prototype.insertVilynxIFrame=function(){var e=document.createElement("iframe");return e.style.display="none",e.src=_config_privateConfig__WEBPACK_IMPORTED_MODULE_4__.a.iframeUrl,window.addEventListener("message",function(e){"https://static.vilynx.com"!==e.origin&&"https://static.test.vilynx.com"!==e.origin||(_config_privateConfig__WEBPACK_IMPORTED_MODULE_4__.a.vilynxUID=e.data)},!1),document.querySelector("body").appendChild(e),!0},Bootstrap.prototype._addTurboLinkListener=function(){var e=this;document.addEventListener("turbolinks:load",function(){e._clearGalleryItems()})},Bootstrap.prototype._clearGalleryItems=function(){_modules_helpers_viewportQueue__WEBPACK_IMPORTED_MODULE_14__.a.clearQueues(),window.vilynx.gallery.galleryItems.forEach(function(e){e.removeItem(),e=void 0}),window.vilynx.gallery.galleryItems=[],window.vilynx.gallery.reObserve()},Bootstrap.prototype._configureABTesting=function(){var e,t,i;if(0===_config_globalConfig__WEBPACK_IMPORTED_MODULE_3__.a.abtestingpercentage)return!0;_config_globalConfig__WEBPACK_IMPORTED_MODULE_3__.a.passivetracking&&this._logger.warn("Setting passive tracking will override A/B testing which is also configured.");var o=_vilynx_frontend_core_localstorage__WEBPACK_IMPORTED_MODULE_8__.a.get("vlx_gallery_AB",_vilynx_frontend_core_enums_storage__WEBPACK_IMPORTED_MODULE_15__.a.plain);if(o)switch(t=parseInt(o,10)){case _GalleryABStatus__WEBPACK_IMPORTED_MODULE_16__.a.outOfAB:return!1;case _GalleryABStatus__WEBPACK_IMPORTED_MODULE_16__.a.galleryActive:return!0;case _GalleryABStatus__WEBPACK_IMPORTED_MODULE_16__.a.galleryPassive:return _config_globalConfig__WEBPACK_IMPORTED_MODULE_3__.a.passivetracking=!0,!0}var r=_vilynx_frontend_core_random__WEBPACK_IMPORTED_MODULE_9__.a.chance(_config_globalConfig__WEBPACK_IMPORTED_MODULE_3__.a.abtestingpercentage),n=_vilynx_frontend_core_random__WEBPACK_IMPORTED_MODULE_9__.a.chance(50);return i=r&&n,e=r,_config_globalConfig__WEBPACK_IMPORTED_MODULE_3__.a.passivetracking=i,t=e?i?_GalleryABStatus__WEBPACK_IMPORTED_MODULE_16__.a.galleryPassive:_GalleryABStatus__WEBPACK_IMPORTED_MODULE_16__.a.galleryActive:_GalleryABStatus__WEBPACK_IMPORTED_MODULE_16__.a.outOfAB,_vilynx_frontend_core_localstorage__WEBPACK_IMPORTED_MODULE_8__.a.set("vlx_gallery_AB",t.toString(),_vilynx_frontend_core_enums_storage__WEBPACK_IMPORTED_MODULE_15__.a.plain),e},Bootstrap}(),bootstrap=new Bootstrap;window.vilynx?window.vilynx.gallery=_modules_helpers_exposed__WEBPACK_IMPORTED_MODULE_1__.a:window.vilynx={gallery:_modules_helpers_exposed__WEBPACK_IMPORTED_MODULE_1__.a}},function(e,t){var i,o,r=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(i===setTimeout)return setTimeout(e,0);if((i===n||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:n}catch(e){i=n}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(e){o=a}}();var l,c=[],d=!1,u=-1;function h(){d&&l&&(d=!1,l.length?c=l.concat(c):u=-1,c.length&&p())}function p(){if(!d){var e=s(h);d=!0;for(var t=c.length;t;){for(l=c,c=[];++u<t;)l&&l[u].run();u=-1,t=c.length}l=null,d=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function f(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];c.push(new g(e,t)),1!==c.length||d||s(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){var o=i(25);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};i(27)(o,r);o.locals&&(e.exports=o.locals)},function(e,t,i){(e.exports=i(26)(!1)).push([e.i,".vilynx_fading:not([vilynx-fadingid]):not([data-vilynx-fadingid]) {\n  opacity: 1 !important;\n  visibility: visible;\n}\n.vilynx_registered .vilynx_wrapperImg {\n  height: 100%;\n  width: 100%;\n  transition: opacity 0.35s linear;\n  position: relative;\n  z-index: 1;\n  object-fit: cover;\n}\n.vilynx_registered .vilynx_wrapperImg.vilynx-hide {\n  opacity: 0;\n  visibility: hidden;\n}\n.vilynx_registered .vilynx_wrapperImg.vilynx_fading {\n  opacity: 0 !important;\n}\n.vilynx_registered div:not(vilynx_img).vilynx_fading:not([vilynx-fadingid]):not([data-vilynx-fadingid]) {\n  opacity: 1 !important;\n  visibility: visible;\n}\n.vilynx_registered .supra-wrapper video {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: -5;\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n.vilynx_registered .supra-wrapper {\n  overflow: hidden;\n  position: absolute;\n  z-index: 1;\n  width: 100%;\n}\n.vilynx_registered .supra-wrapper.vilynx-hide {\n  opacity: 0;\n  visibility: hidden;\n}\n.vilynx_registered.vilynx_disabled .supra-wrapper {\n  opacity: 0;\n  visibility: hidden;\n}\n.vilynx_registered .redirectWrapper {\n  display: table;\n  position: absolute;\n  left: 0;\n  top: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  height: 100% !important;\n  width: 100%;\n  text-align: center;\n  z-index: 1000;\n  opacity: 0;\n  visibility: hidden;\n  transition: opacity 0.35s linear !important;\n}\n.vilynx_registered .redirectWrapper .redirectCenter {\n  display: table-cell;\n  vertical-align: middle;\n}\n.vilynx_registered .redirectWrapper .redirectCenter .text {\n  max-width: 100%;\n  margin-bottom: 10px;\n  font-family: sans-serif;\n  color: white;\n}\n.vilynx_registered .redirectWrapper .redirectCenter .counter {\n  max-width: 100%;\n  font-family: sans-serif;\n  color: white;\n}\n.vilynx_registered .redirectWrapper.cta.hideCtaIcon .counter {\n  display: none;\n}\n.vilynx_registered .redirectWrapper.cta .redirectCenter .text {\n  margin-bottom: 8px;\n  font-weight: 100;\n}\n.vilynx_registered .redirectWrapper.cta .counter {\n  position: relative;\n  display: block;\n  content: '';\n  width: 35px;\n  height: 35px;\n  border-radius: 50%;\n  border: 2px solid #FFF;\n  text-indent: -1000px;\n  left: 50%;\n  margin-left: -20px;\n}\n.vilynx_registered .redirectWrapper.cta .counter:before {\n  display: block;\n  content: '';\n  position: absolute;\n  width: 0;\n  height: 0;\n  border-top: 10px solid transparent;\n  border-bottom: 10px solid transparent;\n  border-left: 18px solid white;\n  left: 50%;\n  margin-left: -7px;\n  top: 50%;\n  margin-top: -10px;\n}\n.vilynx_gif {\n  display: block;\n  position: absolute;\n  top: 0;\n  width: 100%;\n  z-index: 20;\n}\n[data-vilynx-fadingid],\n[vilynx-fadingid] {\n  transition: opacity 0.35s linear;\n}\n.vilynx_fading[data-vilynx-fadingid],\n.vilynx_fading[vilynx-fadingid] {\n  opacity: 0;\n}\n@media only screen and (max-device-width: 736px) {\n  .vilynx_registered img {\n    transition: none;\n  }\n}\n",""])},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var i=function(e,t){var i=e[1]||"",o=e[3];if(!o)return i;if(t&&"function"==typeof btoa){var r=(a=o,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),n=o.sources.map(function(e){return"/*# sourceURL="+o.sourceRoot+e+" */"});return[i].concat(n).concat([r]).join("\n")}var a;return[i].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+i+"}":i}).join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var o={},r=0;r<this.length;r++){var n=this[r][0];"number"==typeof n&&(o[n]=!0)}for(r=0;r<e.length;r++){var a=e[r];"number"==typeof a[0]&&o[a[0]]||(i&&!a[2]?a[2]=i:i&&(a[2]="("+a[2]+") and ("+i+")"),t.push(a))}},t}},function(e,t,i){var o,r,n={},a=(o=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=o.apply(this,arguments)),r}),s=function(e){var t={};return function(e,i){if("function"==typeof e)return e();if(void 0===t[e]){var o=function(e,t){return t?t.querySelector(e):document.querySelector(e)}.call(this,e,i);if(window.HTMLIFrameElement&&o instanceof window.HTMLIFrameElement)try{o=o.contentDocument.head}catch(e){o=null}t[e]=o}return t[e]}}(),l=null,c=0,d=[],u=i(28);function h(e,t){for(var i=0;i<e.length;i++){var o=e[i],r=n[o.id];if(r){r.refs++;for(var a=0;a<r.parts.length;a++)r.parts[a](o.parts[a]);for(;a<o.parts.length;a++)r.parts.push(m(o.parts[a],t))}else{var s=[];for(a=0;a<o.parts.length;a++)s.push(m(o.parts[a],t));n[o.id]={id:o.id,refs:1,parts:s}}}}function p(e,t){for(var i=[],o={},r=0;r<e.length;r++){var n=e[r],a=t.base?n[0]+t.base:n[0],s={css:n[1],media:n[2],sourceMap:n[3]};o[a]?o[a].parts.push(s):i.push(o[a]={id:a,parts:[s]})}return i}function g(e,t){var i=s(e.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var o=d[d.length-1];if("top"===e.insertAt)o?o.nextSibling?i.insertBefore(t,o.nextSibling):i.appendChild(t):i.insertBefore(t,i.firstChild),d.push(t);else if("bottom"===e.insertAt)i.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=s(e.insertAt.before,i);i.insertBefore(t,r)}}function f(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=d.indexOf(e);t>=0&&d.splice(t,1)}function y(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var o=function(){0;return i.nc}();o&&(e.attrs.nonce=o)}return v(t,e.attrs),g(e,t),t}function v(e,t){Object.keys(t).forEach(function(i){e.setAttribute(i,t[i])})}function m(e,t){var i,o,r,n;if(t.transform&&e.css){if(!(n="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=n}if(t.singleton){var a=c++;i=l||(l=y(t)),o=w.bind(null,i,a,!1),r=w.bind(null,i,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",v(t,e.attrs),g(e,t),t}(t),o=function(e,t,i){var o=i.css,r=i.sourceMap,n=void 0===t.convertToAbsoluteUrls&&r;(t.convertToAbsoluteUrls||n)&&(o=u(o));r&&(o+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var a=new Blob([o],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}.bind(null,i,t),r=function(){f(i),i.href&&URL.revokeObjectURL(i.href)}):(i=y(t),o=function(e,t){var i=t.css,o=t.media;o&&e.setAttribute("media",o);if(e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}.bind(null,i),r=function(){f(i)});return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else r()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=a()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var i=p(e,t);return h(i,t),function(e){for(var o=[],r=0;r<i.length;r++){var a=i[r];(s=n[a.id]).refs--,o.push(s)}e&&h(p(e,t),t);for(r=0;r<o.length;r++){var s;if(0===(s=o[r]).refs){for(var l=0;l<s.parts.length;l++)s.parts[l]();delete n[s.id]}}}};var _,b=(_=[],function(e,t){return _[e]=t,_.filter(Boolean).join("\n")});function w(e,t,i,o){var r=i?"":o.css;if(e.styleSheet)e.styleSheet.cssText=b(t,r);else{var n=document.createTextNode(r),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(n,a[t]):e.appendChild(n)}}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var i=t.protocol+"//"+t.host,o=i+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var r,n=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(n)?e:(r=0===n.indexOf("//")?n:0===n.indexOf("/")?i+n:o+n.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")})}},function(e,t){"path"in Event.prototype||Object.defineProperty(Event.prototype,"path",{get:function(){for(var e=[],t=this.target;t;)e.push(t),t=t.parentElement;return-1===e.indexOf(window)&&-1===e.indexOf(document)&&e.push(document),-1===e.indexOf(window)&&e.push(window),e}})},function(e,t){"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),o=1;o<arguments.length;o++){var r=arguments[o];if(null!=r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i[n]=r[n])}return i},writable:!0,configurable:!0})},function(e,t){window.Element&&!Element.prototype.closest&&(Element.prototype.closest=function(e){var t,i=(this.document||this.ownerDocument).querySelectorAll(e),o=this;do{for(t=i.length;--t>=0&&i.item(t)!==o;);}while(t<0&&(o=o.parentElement));return o})},function(e,t){if(Element&&!Element.prototype.matches){var i=Element.prototype;i.matches=i.matchesSelector||i.msMatchesSelector||i.webkitMatchesSelector}}]);